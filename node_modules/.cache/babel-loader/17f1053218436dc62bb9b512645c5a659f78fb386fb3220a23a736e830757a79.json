{"ast":null,"code":"\"use strict\";\n\nrequire(\"core-js/modules/es.array.push.js\");\nconst os = require(\"os\");\nconst path = require(\"path\");\nconst url = require(\"url\");\nconst util = require(\"util\");\nconst fs = require(\"graceful-fs\");\nconst ipaddr = require(\"ipaddr.js\");\nconst defaultGateway = require(\"default-gateway\");\nconst express = require(\"express\");\nconst {\n  validate\n} = require(\"schema-utils\");\nconst schema = require(\"./options.json\");\n\n/** @typedef {import(\"schema-utils/declarations/validate\").Schema} Schema */\n/** @typedef {import(\"webpack\").Compiler} Compiler */\n/** @typedef {import(\"webpack\").MultiCompiler} MultiCompiler */\n/** @typedef {import(\"webpack\").Configuration} WebpackConfiguration */\n/** @typedef {import(\"webpack\").StatsOptions} StatsOptions */\n/** @typedef {import(\"webpack\").StatsCompilation} StatsCompilation */\n/** @typedef {import(\"webpack\").Stats} Stats */\n/** @typedef {import(\"webpack\").MultiStats} MultiStats */\n/** @typedef {import(\"os\").NetworkInterfaceInfo} NetworkInterfaceInfo */\n/** @typedef {import(\"express\").Request} Request */\n/** @typedef {import(\"express\").Response} Response */\n/** @typedef {import(\"express\").NextFunction} NextFunction */\n/** @typedef {import(\"express\").RequestHandler} ExpressRequestHandler */\n/** @typedef {import(\"express\").ErrorRequestHandler} ExpressErrorRequestHandler */\n/** @typedef {import(\"chokidar\").WatchOptions} WatchOptions */\n/** @typedef {import(\"chokidar\").FSWatcher} FSWatcher */\n/** @typedef {import(\"connect-history-api-fallback\").Options} ConnectHistoryApiFallbackOptions */\n/** @typedef {import(\"bonjour-service\").Bonjour} Bonjour */\n/** @typedef {import(\"bonjour-service\").Service} BonjourOptions */\n/** @typedef {import(\"http-proxy-middleware\").RequestHandler} RequestHandler */\n/** @typedef {import(\"http-proxy-middleware\").Options} HttpProxyMiddlewareOptions */\n/** @typedef {import(\"http-proxy-middleware\").Filter} HttpProxyMiddlewareOptionsFilter */\n/** @typedef {import(\"serve-index\").Options} ServeIndexOptions */\n/** @typedef {import(\"serve-static\").ServeStaticOptions} ServeStaticOptions */\n/** @typedef {import(\"ipaddr.js\").IPv4} IPv4 */\n/** @typedef {import(\"ipaddr.js\").IPv6} IPv6 */\n/** @typedef {import(\"net\").Socket} Socket */\n/** @typedef {import(\"http\").IncomingMessage} IncomingMessage */\n/** @typedef {import(\"open\").Options} OpenOptions */\n\n/** @typedef {import(\"https\").ServerOptions & { spdy?: { plain?: boolean | undefined, ssl?: boolean | undefined, 'x-forwarded-for'?: string | undefined, protocol?: string | undefined, protocols?: string[] | undefined }}} ServerOptions */\n\n/**\n * @template Request, Response\n * @typedef {import(\"webpack-dev-middleware\").Options<Request, Response>} DevMiddlewareOptions\n */\n\n/**\n * @template Request, Response\n * @typedef {import(\"webpack-dev-middleware\").Context<Request, Response>} DevMiddlewareContext\n */\n\n/**\n * @typedef {\"local-ip\" | \"local-ipv4\" | \"local-ipv6\" | string} Host\n */\n\n/**\n * @typedef {number | string | \"auto\"} Port\n */\n\n/**\n * @typedef {Object} WatchFiles\n * @property {string | string[]} paths\n * @property {WatchOptions & { aggregateTimeout?: number, ignored?: WatchOptions[\"ignored\"], poll?: number | boolean }} [options]\n */\n\n/**\n * @typedef {Object} Static\n * @property {string} [directory]\n * @property {string | string[]} [publicPath]\n * @property {boolean | ServeIndexOptions} [serveIndex]\n * @property {ServeStaticOptions} [staticOptions]\n * @property {boolean | WatchOptions & { aggregateTimeout?: number, ignored?: WatchOptions[\"ignored\"], poll?: number | boolean }} [watch]\n */\n\n/**\n * @typedef {Object} NormalizedStatic\n * @property {string} directory\n * @property {string[]} publicPath\n * @property {false | ServeIndexOptions} serveIndex\n * @property {ServeStaticOptions} staticOptions\n * @property {false | WatchOptions} watch\n */\n\n/**\n * @typedef {Object} ServerConfiguration\n * @property {\"http\" | \"https\" | \"spdy\" | string} [type]\n * @property {ServerOptions} [options]\n */\n\n/**\n * @typedef {Object} WebSocketServerConfiguration\n * @property {\"sockjs\" | \"ws\" | string | Function} [type]\n * @property {Record<string, any>} [options]\n */\n\n/**\n * @typedef {(import(\"ws\").WebSocket | import(\"sockjs\").Connection & { send: import(\"ws\").WebSocket[\"send\"], terminate: import(\"ws\").WebSocket[\"terminate\"], ping: import(\"ws\").WebSocket[\"ping\"] }) & { isAlive?: boolean }} ClientConnection\n */\n\n/**\n * @typedef {import(\"ws\").WebSocketServer | import(\"sockjs\").Server & { close: import(\"ws\").WebSocketServer[\"close\"] }} WebSocketServer\n */\n\n/**\n * @typedef {{ implementation: WebSocketServer, clients: ClientConnection[] }} WebSocketServerImplementation\n */\n\n/**\n * @callback ByPass\n * @param {Request} req\n * @param {Response} res\n * @param {ProxyConfigArrayItem} proxyConfig\n */\n\n/**\n * @typedef {{ path?: HttpProxyMiddlewareOptionsFilter | undefined, context?: HttpProxyMiddlewareOptionsFilter | undefined } & { bypass?: ByPass } & HttpProxyMiddlewareOptions } ProxyConfigArrayItem\n */\n\n/**\n * @typedef {(ProxyConfigArrayItem | ((req?: Request | undefined, res?: Response | undefined, next?: NextFunction | undefined) => ProxyConfigArrayItem))[]} ProxyConfigArray\n */\n\n/**\n * @typedef {{ [url: string]: string | ProxyConfigArrayItem }} ProxyConfigMap\n */\n\n/**\n * @typedef {Object} OpenApp\n * @property {string} [name]\n * @property {string[]} [arguments]\n */\n\n/**\n * @typedef {Object} Open\n * @property {string | string[] | OpenApp} [app]\n * @property {string | string[]} [target]\n */\n\n/**\n * @typedef {Object} NormalizedOpen\n * @property {string} target\n * @property {import(\"open\").Options} options\n */\n\n/**\n * @typedef {Object} WebSocketURL\n * @property {string} [hostname]\n * @property {string} [password]\n * @property {string} [pathname]\n * @property {number | string} [port]\n * @property {string} [protocol]\n * @property {string} [username]\n */\n\n/**\n * @typedef {Object} ClientConfiguration\n * @property {\"log\" | \"info\" | \"warn\" | \"error\" | \"none\" | \"verbose\"} [logging]\n * @property {boolean  | { warnings?: boolean, errors?: boolean }} [overlay]\n * @property {boolean} [progress]\n * @property {boolean | number} [reconnect]\n * @property {\"ws\" | \"sockjs\" | string} [webSocketTransport]\n * @property {string | WebSocketURL} [webSocketURL]\n */\n\n/**\n * @typedef {Array<{ key: string; value: string }> | Record<string, string | string[]>} Headers\n */\n\n/**\n * @typedef {{ name?: string, path?: string, middleware: ExpressRequestHandler | ExpressErrorRequestHandler } | ExpressRequestHandler | ExpressErrorRequestHandler} Middleware\n */\n\n/**\n * @typedef {Object} Configuration\n * @property {boolean | string} [ipc]\n * @property {Host} [host]\n * @property {Port} [port]\n * @property {boolean | \"only\"} [hot]\n * @property {boolean} [liveReload]\n * @property {DevMiddlewareOptions<Request, Response>} [devMiddleware]\n * @property {boolean} [compress]\n * @property {boolean} [magicHtml]\n * @property {\"auto\" | \"all\" | string | string[]} [allowedHosts]\n * @property {boolean | ConnectHistoryApiFallbackOptions} [historyApiFallback]\n * @property {boolean} [setupExitSignals]\n * @property {boolean | Record<string, never> | BonjourOptions} [bonjour]\n * @property {string | string[] | WatchFiles | Array<string | WatchFiles>} [watchFiles]\n * @property {boolean | string | Static | Array<string | Static>} [static]\n * @property {boolean | ServerOptions} [https]\n * @property {boolean} [http2]\n * @property {\"http\" | \"https\" | \"spdy\" | string | ServerConfiguration} [server]\n * @property {boolean | \"sockjs\" | \"ws\" | string | WebSocketServerConfiguration} [webSocketServer]\n * @property {ProxyConfigMap | ProxyConfigArrayItem | ProxyConfigArray} [proxy]\n * @property {boolean | string | Open | Array<string | Open>} [open]\n * @property {boolean} [setupExitSignals]\n * @property {boolean | ClientConfiguration} [client]\n * @property {Headers | ((req: Request, res: Response, context: DevMiddlewareContext<Request, Response>) => Headers)} [headers]\n * @property {(devServer: Server) => void} [onAfterSetupMiddleware]\n * @property {(devServer: Server) => void} [onBeforeSetupMiddleware]\n * @property {(devServer: Server) => void} [onListening]\n * @property {(middlewares: Middleware[], devServer: Server) => Middleware[]} [setupMiddlewares]\n */\n\nif (!process.env.WEBPACK_SERVE) {\n  // TODO fix me in the next major release\n  // @ts-ignore\n  process.env.WEBPACK_SERVE = true;\n}\nclass Server {\n  /**\n   * @param {Configuration | Compiler | MultiCompiler} options\n   * @param {Compiler | MultiCompiler | Configuration} compiler\n   */\n  constructor(options = {}, compiler) {\n    // TODO: remove this after plugin support is published\n    if ( /** @type {Compiler | MultiCompiler} */options.hooks) {\n      util.deprecate(() => {}, \"Using 'compiler' as the first argument is deprecated. Please use 'options' as the first argument and 'compiler' as the second argument.\", \"DEP_WEBPACK_DEV_SERVER_CONSTRUCTOR\")();\n      [options = {}, compiler] = [compiler, options];\n    }\n    validate( /** @type {Schema} */schema, options, {\n      name: \"Dev Server\",\n      baseDataPath: \"options\"\n    });\n    this.compiler = /** @type {Compiler | MultiCompiler} */compiler;\n    /**\n     * @type {ReturnType<Compiler[\"getInfrastructureLogger\"]>}\n     * */\n    this.logger = this.compiler.getInfrastructureLogger(\"webpack-dev-server\");\n    this.options = /** @type {Configuration} */options;\n    /**\n     * @type {FSWatcher[]}\n     */\n    this.staticWatchers = [];\n    /**\n     * @private\n     * @type {{ name: string | symbol, listener: (...args: any[]) => void}[] }}\n     */\n    this.listeners = [];\n    // Keep track of websocket proxies for external websocket upgrade.\n    /**\n     * @private\n     * @type {RequestHandler[]}\n     */\n    this.webSocketProxies = [];\n    /**\n     * @type {Socket[]}\n     */\n    this.sockets = [];\n    /**\n     * @private\n     * @type {string | undefined}\n     */\n    // eslint-disable-next-line no-undefined\n    this.currentHash = undefined;\n  }\n\n  // TODO compatibility with webpack v4, remove it after drop\n  static get cli() {\n    return {\n      get getArguments() {\n        return () => require(\"../bin/cli-flags\");\n      },\n      get processArguments() {\n        return require(\"../bin/process-arguments\");\n      }\n    };\n  }\n  static get schema() {\n    return schema;\n  }\n\n  /**\n   * @private\n   * @returns {StatsOptions}\n   * @constructor\n   */\n  static get DEFAULT_STATS() {\n    return {\n      all: false,\n      hash: true,\n      warnings: true,\n      errors: true,\n      errorDetails: false\n    };\n  }\n\n  /**\n   * @param {string} URL\n   * @returns {boolean}\n   */\n  static isAbsoluteURL(URL) {\n    // Don't match Windows paths `c:\\`\n    if (/^[a-zA-Z]:\\\\/.test(URL)) {\n      return false;\n    }\n\n    // Scheme: https://tools.ietf.org/html/rfc3986#section-3.1\n    // Absolute URL: https://tools.ietf.org/html/rfc3986#section-4.3\n    return /^[a-zA-Z][a-zA-Z\\d+\\-.]*:/.test(URL);\n  }\n\n  /**\n   * @param {string} gateway\n   * @returns {string | undefined}\n   */\n  static findIp(gateway) {\n    const gatewayIp = ipaddr.parse(gateway);\n\n    // Look for the matching interface in all local interfaces.\n    for (const addresses of Object.values(os.networkInterfaces())) {\n      for (const {\n        cidr\n      } of /** @type {NetworkInterfaceInfo[]} */\n      addresses) {\n        const net = ipaddr.parseCIDR( /** @type {string} */cidr);\n        if (net[0] && net[0].kind() === gatewayIp.kind() && gatewayIp.match(net)) {\n          return net[0].toString();\n        }\n      }\n    }\n  }\n\n  /**\n   * @param {\"v4\" | \"v6\"} family\n   * @returns {Promise<string | undefined>}\n   */\n  static async internalIP(family) {\n    try {\n      const {\n        gateway\n      } = await defaultGateway[family]();\n      return Server.findIp(gateway);\n    } catch {\n      // ignore\n    }\n  }\n\n  /**\n   * @param {\"v4\" | \"v6\"} family\n   * @returns {string | undefined}\n   */\n  static internalIPSync(family) {\n    try {\n      const {\n        gateway\n      } = defaultGateway[family].sync();\n      return Server.findIp(gateway);\n    } catch {\n      // ignore\n    }\n  }\n\n  /**\n   * @param {Host} hostname\n   * @returns {Promise<string>}\n   */\n  static async getHostname(hostname) {\n    if (hostname === \"local-ip\") {\n      return (await Server.internalIP(\"v4\")) || (await Server.internalIP(\"v6\")) || \"0.0.0.0\";\n    } else if (hostname === \"local-ipv4\") {\n      return (await Server.internalIP(\"v4\")) || \"0.0.0.0\";\n    } else if (hostname === \"local-ipv6\") {\n      return (await Server.internalIP(\"v6\")) || \"::\";\n    }\n    return hostname;\n  }\n\n  /**\n   * @param {Port} port\n   * @param {string} host\n   * @returns {Promise<number | string>}\n   */\n  static async getFreePort(port, host) {\n    if (typeof port !== \"undefined\" && port !== null && port !== \"auto\") {\n      return port;\n    }\n    const pRetry = require(\"p-retry\");\n    const getPort = require(\"./getPort\");\n    const basePort = typeof process.env.WEBPACK_DEV_SERVER_BASE_PORT !== \"undefined\" ? parseInt(process.env.WEBPACK_DEV_SERVER_BASE_PORT, 10) : 8080;\n\n    // Try to find unused port and listen on it for 3 times,\n    // if port is not specified in options.\n    const defaultPortRetry = typeof process.env.WEBPACK_DEV_SERVER_PORT_RETRY !== \"undefined\" ? parseInt(process.env.WEBPACK_DEV_SERVER_PORT_RETRY, 10) : 3;\n    return pRetry(() => getPort(basePort, host), {\n      retries: defaultPortRetry\n    });\n  }\n\n  /**\n   * @returns {string}\n   */\n  static findCacheDir() {\n    const cwd = process.cwd();\n\n    /**\n     * @type {string | undefined}\n     */\n    let dir = cwd;\n    for (;;) {\n      try {\n        if (fs.statSync(path.join(dir, \"package.json\")).isFile()) break;\n        // eslint-disable-next-line no-empty\n      } catch (e) {}\n      const parent = path.dirname(dir);\n      if (dir === parent) {\n        // eslint-disable-next-line no-undefined\n        dir = undefined;\n        break;\n      }\n      dir = parent;\n    }\n    if (!dir) {\n      return path.resolve(cwd, \".cache/webpack-dev-server\");\n    } else if (process.versions.pnp === \"1\") {\n      return path.resolve(dir, \".pnp/.cache/webpack-dev-server\");\n    } else if (process.versions.pnp === \"3\") {\n      return path.resolve(dir, \".yarn/.cache/webpack-dev-server\");\n    }\n    return path.resolve(dir, \"node_modules/.cache/webpack-dev-server\");\n  }\n\n  /**\n   * @private\n   * @param {Compiler} compiler\n   * @returns bool\n   */\n  static isWebTarget(compiler) {\n    // TODO improve for the next major version - we should store `web` and other targets in `compiler.options.environment`\n    if (compiler.options.externalsPresets && compiler.options.externalsPresets.web) {\n      return true;\n    }\n    if (compiler.options.resolve.conditionNames && compiler.options.resolve.conditionNames.includes(\"browser\")) {\n      return true;\n    }\n    const webTargets = [\"web\", \"webworker\", \"electron-preload\", \"electron-renderer\", \"node-webkit\",\n    // eslint-disable-next-line no-undefined\n    undefined, null];\n    if (Array.isArray(compiler.options.target)) {\n      return compiler.options.target.some(r => webTargets.includes(r));\n    }\n    return webTargets.includes( /** @type {string} */compiler.options.target);\n  }\n\n  /**\n   * @private\n   * @param {Compiler} compiler\n   */\n  addAdditionalEntries(compiler) {\n    /**\n     * @type {string[]}\n     */\n    const additionalEntries = [];\n    const isWebTarget = Server.isWebTarget(compiler);\n\n    // TODO maybe empty client\n    if (this.options.client && isWebTarget) {\n      let webSocketURLStr = \"\";\n      if (this.options.webSocketServer) {\n        const webSocketURL = /** @type {WebSocketURL} */\n\n        /** @type {ClientConfiguration} */\n        this.options.client.webSocketURL;\n        const webSocketServer = /** @type {{ type: WebSocketServerConfiguration[\"type\"], options: NonNullable<WebSocketServerConfiguration[\"options\"]> }} */\n        this.options.webSocketServer;\n        const searchParams = new URLSearchParams();\n\n        /** @type {string} */\n        let protocol;\n\n        // We are proxying dev server and need to specify custom `hostname`\n        if (typeof webSocketURL.protocol !== \"undefined\") {\n          protocol = webSocketURL.protocol;\n        } else {\n          protocol = /** @type {ServerConfiguration} */\n          this.options.server.type === \"http\" ? \"ws:\" : \"wss:\";\n        }\n        searchParams.set(\"protocol\", protocol);\n        if (typeof webSocketURL.username !== \"undefined\") {\n          searchParams.set(\"username\", webSocketURL.username);\n        }\n        if (typeof webSocketURL.password !== \"undefined\") {\n          searchParams.set(\"password\", webSocketURL.password);\n        }\n\n        /** @type {string} */\n        let hostname;\n\n        // SockJS is not supported server mode, so `hostname` and `port` can't specified, let's ignore them\n        // TODO show warning about this\n        const isSockJSType = webSocketServer.type === \"sockjs\";\n\n        // We are proxying dev server and need to specify custom `hostname`\n        if (typeof webSocketURL.hostname !== \"undefined\") {\n          hostname = webSocketURL.hostname;\n        }\n        // Web socket server works on custom `hostname`, only for `ws` because `sock-js` is not support custom `hostname`\n        else if (typeof webSocketServer.options.host !== \"undefined\" && !isSockJSType) {\n          hostname = webSocketServer.options.host;\n        }\n        // The `host` option is specified\n        else if (typeof this.options.host !== \"undefined\") {\n          hostname = this.options.host;\n        }\n        // The `port` option is not specified\n        else {\n          hostname = \"0.0.0.0\";\n        }\n        searchParams.set(\"hostname\", hostname);\n\n        /** @type {number | string} */\n        let port;\n\n        // We are proxying dev server and need to specify custom `port`\n        if (typeof webSocketURL.port !== \"undefined\") {\n          port = webSocketURL.port;\n        }\n        // Web socket server works on custom `port`, only for `ws` because `sock-js` is not support custom `port`\n        else if (typeof webSocketServer.options.port !== \"undefined\" && !isSockJSType) {\n          port = webSocketServer.options.port;\n        }\n        // The `port` option is specified\n        else if (typeof this.options.port === \"number\") {\n          port = this.options.port;\n        }\n        // The `port` option is specified using `string`\n        else if (typeof this.options.port === \"string\" && this.options.port !== \"auto\") {\n          port = Number(this.options.port);\n        }\n        // The `port` option is not specified or set to `auto`\n        else {\n          port = \"0\";\n        }\n        searchParams.set(\"port\", String(port));\n\n        /** @type {string} */\n        let pathname = \"\";\n\n        // We are proxying dev server and need to specify custom `pathname`\n        if (typeof webSocketURL.pathname !== \"undefined\") {\n          pathname = webSocketURL.pathname;\n        }\n        // Web socket server works on custom `path`\n        else if (typeof webSocketServer.options.prefix !== \"undefined\" || typeof webSocketServer.options.path !== \"undefined\") {\n          pathname = webSocketServer.options.prefix || webSocketServer.options.path;\n        }\n        searchParams.set(\"pathname\", pathname);\n        const client = /** @type {ClientConfiguration} */this.options.client;\n        if (typeof client.logging !== \"undefined\") {\n          searchParams.set(\"logging\", client.logging);\n        }\n        if (typeof client.progress !== \"undefined\") {\n          searchParams.set(\"progress\", String(client.progress));\n        }\n        if (typeof client.overlay !== \"undefined\") {\n          searchParams.set(\"overlay\", typeof client.overlay === \"boolean\" ? String(client.overlay) : JSON.stringify(client.overlay));\n        }\n        if (typeof client.reconnect !== \"undefined\") {\n          searchParams.set(\"reconnect\", typeof client.reconnect === \"number\" ? String(client.reconnect) : \"10\");\n        }\n        if (typeof this.options.hot !== \"undefined\") {\n          searchParams.set(\"hot\", String(this.options.hot));\n        }\n        if (typeof this.options.liveReload !== \"undefined\") {\n          searchParams.set(\"live-reload\", String(this.options.liveReload));\n        }\n        webSocketURLStr = searchParams.toString();\n      }\n      additionalEntries.push(`${require.resolve(\"../client/index.js\")}?${webSocketURLStr}`);\n    }\n    if (this.options.hot === \"only\") {\n      additionalEntries.push(require.resolve(\"webpack/hot/only-dev-server\"));\n    } else if (this.options.hot) {\n      additionalEntries.push(require.resolve(\"webpack/hot/dev-server\"));\n    }\n    const webpack = compiler.webpack || require(\"webpack\");\n\n    // use a hook to add entries if available\n    if (typeof webpack.EntryPlugin !== \"undefined\") {\n      for (const additionalEntry of additionalEntries) {\n        new webpack.EntryPlugin(compiler.context, additionalEntry, {\n          // eslint-disable-next-line no-undefined\n          name: undefined\n        }).apply(compiler);\n      }\n    }\n    // TODO remove after drop webpack v4 support\n    else {\n      /**\n       * prependEntry Method for webpack 4\n       * @param {any} originalEntry\n       * @param {any} newAdditionalEntries\n       * @returns {any}\n       */\n      const prependEntry = (originalEntry, newAdditionalEntries) => {\n        if (typeof originalEntry === \"function\") {\n          return () => Promise.resolve(originalEntry()).then(entry => prependEntry(entry, newAdditionalEntries));\n        }\n        if (typeof originalEntry === \"object\" && !Array.isArray(originalEntry)) {\n          /** @type {Object<string,string>} */\n          const clone = {};\n          Object.keys(originalEntry).forEach(key => {\n            // entry[key] should be a string here\n            const entryDescription = originalEntry[key];\n            clone[key] = prependEntry(entryDescription, newAdditionalEntries);\n          });\n          return clone;\n        }\n\n        // in this case, entry is a string or an array.\n        // make sure that we do not add duplicates.\n        /** @type {any} */\n        const entriesClone = additionalEntries.slice(0);\n        [].concat(originalEntry).forEach(newEntry => {\n          if (!entriesClone.includes(newEntry)) {\n            entriesClone.push(newEntry);\n          }\n        });\n        return entriesClone;\n      };\n      compiler.options.entry = prependEntry(compiler.options.entry || \"./src\", additionalEntries);\n      compiler.hooks.entryOption.call( /** @type {string} */compiler.options.context, compiler.options.entry);\n    }\n  }\n\n  /**\n   * @private\n   * @returns {Compiler[\"options\"]}\n   */\n  getCompilerOptions() {\n    if (typeof /** @type {MultiCompiler} */this.compiler.compilers !== \"undefined\") {\n      if ( /** @type {MultiCompiler} */this.compiler.compilers.length === 1) {\n        return (/** @type {MultiCompiler} */\n          this.compiler.compilers[0].options\n        );\n      }\n\n      // Configuration with the `devServer` options\n      const compilerWithDevServer = /** @type {MultiCompiler} */\n      this.compiler.compilers.find(config => config.options.devServer);\n      if (compilerWithDevServer) {\n        return compilerWithDevServer.options;\n      }\n\n      // Configuration with `web` preset\n      const compilerWithWebPreset = /** @type {MultiCompiler} */\n      this.compiler.compilers.find(config => config.options.externalsPresets && config.options.externalsPresets.web || [\"web\", \"webworker\", \"electron-preload\", \"electron-renderer\", \"node-webkit\",\n      // eslint-disable-next-line no-undefined\n      undefined, null].includes( /** @type {string} */config.options.target));\n      if (compilerWithWebPreset) {\n        return compilerWithWebPreset.options;\n      }\n\n      // Fallback\n      return (/** @type {MultiCompiler} */this.compiler.compilers[0].options\n      );\n    }\n    return (/** @type {Compiler} */this.compiler.options\n    );\n  }\n\n  /**\n   * @private\n   * @returns {Promise<void>}\n   */\n  async normalizeOptions() {\n    const {\n      options\n    } = this;\n    const compilerOptions = this.getCompilerOptions();\n    // TODO remove `{}` after drop webpack v4 support\n    const compilerWatchOptions = compilerOptions.watchOptions || {};\n    /**\n     * @param {WatchOptions & { aggregateTimeout?: number, ignored?: WatchOptions[\"ignored\"], poll?: number | boolean }} watchOptions\n     * @returns {WatchOptions}\n     */\n    const getWatchOptions = (watchOptions = {}) => {\n      const getPolling = () => {\n        if (typeof watchOptions.usePolling !== \"undefined\") {\n          return watchOptions.usePolling;\n        }\n        if (typeof watchOptions.poll !== \"undefined\") {\n          return Boolean(watchOptions.poll);\n        }\n        if (typeof compilerWatchOptions.poll !== \"undefined\") {\n          return Boolean(compilerWatchOptions.poll);\n        }\n        return false;\n      };\n      const getInterval = () => {\n        if (typeof watchOptions.interval !== \"undefined\") {\n          return watchOptions.interval;\n        }\n        if (typeof watchOptions.poll === \"number\") {\n          return watchOptions.poll;\n        }\n        if (typeof compilerWatchOptions.poll === \"number\") {\n          return compilerWatchOptions.poll;\n        }\n      };\n      const usePolling = getPolling();\n      const interval = getInterval();\n      const {\n        poll,\n        ...rest\n      } = watchOptions;\n      return {\n        ignoreInitial: true,\n        persistent: true,\n        followSymlinks: false,\n        atomic: false,\n        alwaysStat: true,\n        ignorePermissionErrors: true,\n        // Respect options from compiler watchOptions\n        usePolling,\n        interval,\n        ignored: watchOptions.ignored,\n        // TODO: we respect these options for all watch options and allow developers to pass them to chokidar, but chokidar doesn't have these options maybe we need revisit that in future\n        ...rest\n      };\n    };\n    /**\n     * @param {string | Static | undefined} [optionsForStatic]\n     * @returns {NormalizedStatic}\n     */\n    const getStaticItem = optionsForStatic => {\n      const getDefaultStaticOptions = () => {\n        return {\n          directory: path.join(process.cwd(), \"public\"),\n          staticOptions: {},\n          publicPath: [\"/\"],\n          serveIndex: {\n            icons: true\n          },\n          watch: getWatchOptions()\n        };\n      };\n\n      /** @type {NormalizedStatic} */\n      let item;\n      if (typeof optionsForStatic === \"undefined\") {\n        item = getDefaultStaticOptions();\n      } else if (typeof optionsForStatic === \"string\") {\n        item = {\n          ...getDefaultStaticOptions(),\n          directory: optionsForStatic\n        };\n      } else {\n        const def = getDefaultStaticOptions();\n        item = {\n          directory: typeof optionsForStatic.directory !== \"undefined\" ? optionsForStatic.directory : def.directory,\n          // TODO: do merge in the next major release\n          staticOptions: typeof optionsForStatic.staticOptions !== \"undefined\" ? optionsForStatic.staticOptions : def.staticOptions,\n          publicPath:\n          // eslint-disable-next-line no-nested-ternary\n          typeof optionsForStatic.publicPath !== \"undefined\" ? Array.isArray(optionsForStatic.publicPath) ? optionsForStatic.publicPath : [optionsForStatic.publicPath] : def.publicPath,\n          // TODO: do merge in the next major release\n          serveIndex:\n          // eslint-disable-next-line no-nested-ternary\n          typeof optionsForStatic.serveIndex !== \"undefined\" ? typeof optionsForStatic.serveIndex === \"boolean\" && optionsForStatic.serveIndex ? def.serveIndex : optionsForStatic.serveIndex : def.serveIndex,\n          watch:\n          // eslint-disable-next-line no-nested-ternary\n          typeof optionsForStatic.watch !== \"undefined\" ?\n          // eslint-disable-next-line no-nested-ternary\n          typeof optionsForStatic.watch === \"boolean\" ? optionsForStatic.watch ? def.watch : false : getWatchOptions(optionsForStatic.watch) : def.watch\n        };\n      }\n      if (Server.isAbsoluteURL(item.directory)) {\n        throw new Error(\"Using a URL as static.directory is not supported\");\n      }\n      return item;\n    };\n    if (typeof options.allowedHosts === \"undefined\") {\n      // AllowedHosts allows some default hosts picked from `options.host` or `webSocketURL.hostname` and `localhost`\n      options.allowedHosts = \"auto\";\n    }\n    // We store allowedHosts as array when supplied as string\n    else if (typeof options.allowedHosts === \"string\" && options.allowedHosts !== \"auto\" && options.allowedHosts !== \"all\") {\n      options.allowedHosts = [options.allowedHosts];\n    }\n    // CLI pass options as array, we should normalize them\n    else if (Array.isArray(options.allowedHosts) && options.allowedHosts.includes(\"all\")) {\n      options.allowedHosts = \"all\";\n    }\n    if (typeof options.bonjour === \"undefined\") {\n      options.bonjour = false;\n    } else if (typeof options.bonjour === \"boolean\") {\n      options.bonjour = options.bonjour ? {} : false;\n    }\n    if (typeof options.client === \"undefined\" || typeof options.client === \"object\" && options.client !== null) {\n      if (!options.client) {\n        options.client = {};\n      }\n      if (typeof options.client.webSocketURL === \"undefined\") {\n        options.client.webSocketURL = {};\n      } else if (typeof options.client.webSocketURL === \"string\") {\n        const parsedURL = new URL(options.client.webSocketURL);\n        options.client.webSocketURL = {\n          protocol: parsedURL.protocol,\n          hostname: parsedURL.hostname,\n          port: parsedURL.port.length > 0 ? Number(parsedURL.port) : \"\",\n          pathname: parsedURL.pathname,\n          username: parsedURL.username,\n          password: parsedURL.password\n        };\n      } else if (typeof options.client.webSocketURL.port === \"string\") {\n        options.client.webSocketURL.port = Number(options.client.webSocketURL.port);\n      }\n\n      // Enable client overlay by default\n      if (typeof options.client.overlay === \"undefined\") {\n        options.client.overlay = true;\n      } else if (typeof options.client.overlay !== \"boolean\") {\n        options.client.overlay = {\n          errors: true,\n          warnings: true,\n          ...options.client.overlay\n        };\n      }\n      if (typeof options.client.reconnect === \"undefined\") {\n        options.client.reconnect = 10;\n      } else if (options.client.reconnect === true) {\n        options.client.reconnect = Infinity;\n      } else if (options.client.reconnect === false) {\n        options.client.reconnect = 0;\n      }\n\n      // Respect infrastructureLogging.level\n      if (typeof options.client.logging === \"undefined\") {\n        options.client.logging = compilerOptions.infrastructureLogging ? compilerOptions.infrastructureLogging.level : \"info\";\n      }\n    }\n    if (typeof options.compress === \"undefined\") {\n      options.compress = true;\n    }\n    if (typeof options.devMiddleware === \"undefined\") {\n      options.devMiddleware = {};\n    }\n\n    // No need to normalize `headers`\n\n    if (typeof options.historyApiFallback === \"undefined\") {\n      options.historyApiFallback = false;\n    } else if (typeof options.historyApiFallback === \"boolean\" && options.historyApiFallback) {\n      options.historyApiFallback = {};\n    }\n\n    // No need to normalize `host`\n\n    options.hot = typeof options.hot === \"boolean\" || options.hot === \"only\" ? options.hot : true;\n    const isHTTPs = Boolean(options.https);\n    const isSPDY = Boolean(options.http2);\n    if (isHTTPs) {\n      // TODO: remove in the next major release\n      util.deprecate(() => {}, \"'https' option is deprecated. Please use the 'server' option.\", \"DEP_WEBPACK_DEV_SERVER_HTTPS\")();\n    }\n    if (isSPDY) {\n      // TODO: remove in the next major release\n      util.deprecate(() => {}, \"'http2' option is deprecated. Please use the 'server' option.\", \"DEP_WEBPACK_DEV_SERVER_HTTP2\")();\n    }\n    options.server = {\n      type:\n      // eslint-disable-next-line no-nested-ternary\n      typeof options.server === \"string\" ? options.server :\n      // eslint-disable-next-line no-nested-ternary\n      typeof (options.server || {}).type === \"string\" ? /** @type {ServerConfiguration} */options.server.type || \"http\" :\n      // eslint-disable-next-line no-nested-ternary\n      isSPDY ? \"spdy\" : isHTTPs ? \"https\" : \"http\",\n      options: {\n        ... /** @type {ServerOptions} */options.https,\n        ... /** @type {ServerConfiguration} */(options.server || {}).options\n      }\n    };\n    if (options.server.type === \"spdy\" && typeof /** @type {ServerOptions} */options.server.options.spdy === \"undefined\") {\n      /** @type {ServerOptions} */\n      options.server.options.spdy = {\n        protocols: [\"h2\", \"http/1.1\"]\n      };\n    }\n    if (options.server.type === \"https\" || options.server.type === \"spdy\") {\n      if (typeof /** @type {ServerOptions} */options.server.options.requestCert === \"undefined\") {\n        /** @type {ServerOptions} */\n        options.server.options.requestCert = false;\n      }\n      const httpsProperties = /** @type {Array<keyof ServerOptions>} */\n      [\"cacert\", \"ca\", \"cert\", \"crl\", \"key\", \"pfx\"];\n      for (const property of httpsProperties) {\n        if (typeof /** @type {ServerOptions} */options.server.options[property] === \"undefined\") {\n          // eslint-disable-next-line no-continue\n          continue;\n        }\n\n        // @ts-ignore\n        if (property === \"cacert\") {\n          // TODO remove the `cacert` option in favor `ca` in the next major release\n          util.deprecate(() => {}, \"The 'cacert' option is deprecated. Please use the 'ca' option.\", \"DEP_WEBPACK_DEV_SERVER_CACERT\")();\n        }\n\n        /** @type {any} */\n        const value = /** @type {ServerOptions} */\n        options.server.options[property];\n        /**\n         * @param {string | Buffer | undefined} item\n         * @returns {string | Buffer | undefined}\n         */\n        const readFile = item => {\n          if (Buffer.isBuffer(item) || typeof item === \"object\" && item !== null && !Array.isArray(item)) {\n            return item;\n          }\n          if (item) {\n            let stats = null;\n            try {\n              stats = fs.lstatSync(fs.realpathSync(item)).isFile();\n            } catch (error) {\n              // Ignore error\n            }\n\n            // It is file\n            return stats ? fs.readFileSync(item) : item;\n          }\n        };\n\n        /** @type {any} */\n        options.server.options[property] = Array.isArray(value) ? value.map(item => readFile(item)) : readFile(value);\n      }\n      let fakeCert;\n      if (! /** @type {ServerOptions} */options.server.options.key || ! /** @type {ServerOptions} */options.server.options.cert) {\n        const certificateDir = Server.findCacheDir();\n        const certificatePath = path.join(certificateDir, \"server.pem\");\n        let certificateExists;\n        try {\n          const certificate = await fs.promises.stat(certificatePath);\n          certificateExists = certificate.isFile();\n        } catch {\n          certificateExists = false;\n        }\n        if (certificateExists) {\n          const certificateTtl = 1000 * 60 * 60 * 24;\n          const certificateStat = await fs.promises.stat(certificatePath);\n          const now = Number(new Date());\n\n          // cert is more than 30 days old, kill it with fire\n          if ((now - Number(certificateStat.ctime)) / certificateTtl > 30) {\n            const {\n              promisify\n            } = require(\"util\");\n            const rimraf = require(\"rimraf\");\n            const del = promisify(rimraf);\n            this.logger.info(\"SSL certificate is more than 30 days old. Removing...\");\n            await del(certificatePath);\n            certificateExists = false;\n          }\n        }\n        if (!certificateExists) {\n          this.logger.info(\"Generating SSL certificate...\");\n\n          // @ts-ignore\n          const selfsigned = require(\"selfsigned\");\n          const attributes = [{\n            name: \"commonName\",\n            value: \"localhost\"\n          }];\n          const pems = selfsigned.generate(attributes, {\n            algorithm: \"sha256\",\n            days: 30,\n            keySize: 2048,\n            extensions: [{\n              name: \"basicConstraints\",\n              cA: true\n            }, {\n              name: \"keyUsage\",\n              keyCertSign: true,\n              digitalSignature: true,\n              nonRepudiation: true,\n              keyEncipherment: true,\n              dataEncipherment: true\n            }, {\n              name: \"extKeyUsage\",\n              serverAuth: true,\n              clientAuth: true,\n              codeSigning: true,\n              timeStamping: true\n            }, {\n              name: \"subjectAltName\",\n              altNames: [{\n                // type 2 is DNS\n                type: 2,\n                value: \"localhost\"\n              }, {\n                type: 2,\n                value: \"localhost.localdomain\"\n              }, {\n                type: 2,\n                value: \"lvh.me\"\n              }, {\n                type: 2,\n                value: \"*.lvh.me\"\n              }, {\n                type: 2,\n                value: \"[::1]\"\n              }, {\n                // type 7 is IP\n                type: 7,\n                ip: \"127.0.0.1\"\n              }, {\n                type: 7,\n                ip: \"fe80::1\"\n              }]\n            }]\n          });\n          await fs.promises.mkdir(certificateDir, {\n            recursive: true\n          });\n          await fs.promises.writeFile(certificatePath, pems.private + pems.cert, {\n            encoding: \"utf8\"\n          });\n        }\n        fakeCert = await fs.promises.readFile(certificatePath);\n        this.logger.info(`SSL certificate: ${certificatePath}`);\n      }\n      if ( /** @type {ServerOptions & { cacert?: ServerOptions[\"ca\"] }} */options.server.options.cacert) {\n        if ( /** @type {ServerOptions} */options.server.options.ca) {\n          this.logger.warn(\"Do not specify 'ca' and 'cacert' options together, the 'ca' option will be used.\");\n        } else {\n          /** @type {ServerOptions} */\n          options.server.options.ca = /** @type {ServerOptions & { cacert?: ServerOptions[\"ca\"] }} */\n          options.server.options.cacert;\n        }\n        delete /** @type {ServerOptions & { cacert?: ServerOptions[\"ca\"] }} */options.server.options.cacert;\n      }\n\n      /** @type {ServerOptions} */\n      options.server.options.key = /** @type {ServerOptions} */\n      options.server.options.key || fakeCert;\n      /** @type {ServerOptions} */\n      options.server.options.cert = /** @type {ServerOptions} */\n      options.server.options.cert || fakeCert;\n    }\n    if (typeof options.ipc === \"boolean\") {\n      const isWindows = process.platform === \"win32\";\n      const pipePrefix = isWindows ? \"\\\\\\\\.\\\\pipe\\\\\" : os.tmpdir();\n      const pipeName = \"webpack-dev-server.sock\";\n      options.ipc = path.join(pipePrefix, pipeName);\n    }\n    options.liveReload = typeof options.liveReload !== \"undefined\" ? options.liveReload : true;\n    options.magicHtml = typeof options.magicHtml !== \"undefined\" ? options.magicHtml : true;\n\n    // https://github.com/webpack/webpack-dev-server/issues/1990\n    const defaultOpenOptions = {\n      wait: false\n    };\n    /**\n     * @param {any} target\n     * @returns {NormalizedOpen[]}\n     */\n    // TODO: remove --open-app in favor of --open-app-name\n    const getOpenItemsFromObject = ({\n      target,\n      ...rest\n    }) => {\n      const normalizedOptions = {\n        ...defaultOpenOptions,\n        ...rest\n      };\n      if (typeof normalizedOptions.app === \"string\") {\n        normalizedOptions.app = {\n          name: normalizedOptions.app\n        };\n      }\n      const normalizedTarget = typeof target === \"undefined\" ? \"<url>\" : target;\n      if (Array.isArray(normalizedTarget)) {\n        return normalizedTarget.map(singleTarget => {\n          return {\n            target: singleTarget,\n            options: normalizedOptions\n          };\n        });\n      }\n      return [{\n        target: normalizedTarget,\n        options: normalizedOptions\n      }];\n    };\n    if (typeof options.open === \"undefined\") {\n      /** @type {NormalizedOpen[]} */\n      options.open = [];\n    } else if (typeof options.open === \"boolean\") {\n      /** @type {NormalizedOpen[]} */\n      options.open = options.open ? [{\n        target: \"<url>\",\n        options: /** @type {OpenOptions} */defaultOpenOptions\n      }] : [];\n    } else if (typeof options.open === \"string\") {\n      /** @type {NormalizedOpen[]} */\n      options.open = [{\n        target: options.open,\n        options: defaultOpenOptions\n      }];\n    } else if (Array.isArray(options.open)) {\n      /**\n       * @type {NormalizedOpen[]}\n       */\n      const result = [];\n      options.open.forEach(item => {\n        if (typeof item === \"string\") {\n          result.push({\n            target: item,\n            options: defaultOpenOptions\n          });\n          return;\n        }\n        result.push(...getOpenItemsFromObject(item));\n      });\n\n      /** @type {NormalizedOpen[]} */\n      options.open = result;\n    } else {\n      /** @type {NormalizedOpen[]} */\n      options.open = [...getOpenItemsFromObject(options.open)];\n    }\n    if (options.onAfterSetupMiddleware) {\n      // TODO: remove in the next major release\n      util.deprecate(() => {}, \"'onAfterSetupMiddleware' option is deprecated. Please use the 'setupMiddlewares' option.\", `DEP_WEBPACK_DEV_SERVER_ON_AFTER_SETUP_MIDDLEWARE`)();\n    }\n    if (options.onBeforeSetupMiddleware) {\n      // TODO: remove in the next major release\n      util.deprecate(() => {}, \"'onBeforeSetupMiddleware' option is deprecated. Please use the 'setupMiddlewares' option.\", `DEP_WEBPACK_DEV_SERVER_ON_BEFORE_SETUP_MIDDLEWARE`)();\n    }\n    if (typeof options.port === \"string\" && options.port !== \"auto\") {\n      options.port = Number(options.port);\n    }\n\n    /**\n     * Assume a proxy configuration specified as:\n     * proxy: {\n     *   'context': { options }\n     * }\n     * OR\n     * proxy: {\n     *   'context': 'target'\n     * }\n     */\n    if (typeof options.proxy !== \"undefined\") {\n      // TODO remove in the next major release, only accept `Array`\n      if (!Array.isArray(options.proxy)) {\n        if (Object.prototype.hasOwnProperty.call(options.proxy, \"target\") || Object.prototype.hasOwnProperty.call(options.proxy, \"router\")) {\n          /** @type {ProxyConfigArray} */\n          options.proxy = [/** @type {ProxyConfigMap} */options.proxy];\n        } else {\n          /** @type {ProxyConfigArray} */\n          options.proxy = Object.keys(options.proxy).map(\n          /**\n           * @param {string} context\n           * @returns {HttpProxyMiddlewareOptions}\n           */\n          context => {\n            let proxyOptions;\n            // For backwards compatibility reasons.\n            const correctedContext = context.replace(/^\\*$/, \"**\").replace(/\\/\\*$/, \"\");\n            if (typeof /** @type {ProxyConfigMap} */options.proxy[context] === \"string\") {\n              proxyOptions = {\n                context: correctedContext,\n                target: /** @type {ProxyConfigMap} */\n                options.proxy[context]\n              };\n            } else {\n              proxyOptions = {\n                // @ts-ignore\n                ... /** @type {ProxyConfigMap} */options.proxy[context]\n              };\n              proxyOptions.context = correctedContext;\n            }\n            return proxyOptions;\n          });\n        }\n      }\n\n      /** @type {ProxyConfigArray} */\n      options.proxy = /** @type {ProxyConfigArray} */\n      options.proxy.map(item => {\n        if (typeof item === \"function\") {\n          return item;\n        }\n\n        /**\n         * @param {\"info\" | \"warn\" | \"error\" | \"debug\" | \"silent\" | undefined | \"none\" | \"log\" | \"verbose\"} level\n         * @returns {\"info\" | \"warn\" | \"error\" | \"debug\" | \"silent\" | undefined}\n         */\n        const getLogLevelForProxy = level => {\n          if (level === \"none\") {\n            return \"silent\";\n          }\n          if (level === \"log\") {\n            return \"info\";\n          }\n          if (level === \"verbose\") {\n            return \"debug\";\n          }\n          return level;\n        };\n        if (typeof item.logLevel === \"undefined\") {\n          item.logLevel = getLogLevelForProxy(compilerOptions.infrastructureLogging ? compilerOptions.infrastructureLogging.level : \"info\");\n        }\n        if (typeof item.logProvider === \"undefined\") {\n          item.logProvider = () => this.logger;\n        }\n        return item;\n      });\n    }\n    if (typeof options.setupExitSignals === \"undefined\") {\n      options.setupExitSignals = true;\n    }\n    if (typeof options.static === \"undefined\") {\n      options.static = [getStaticItem()];\n    } else if (typeof options.static === \"boolean\") {\n      options.static = options.static ? [getStaticItem()] : false;\n    } else if (typeof options.static === \"string\") {\n      options.static = [getStaticItem(options.static)];\n    } else if (Array.isArray(options.static)) {\n      options.static = options.static.map(item => getStaticItem(item));\n    } else {\n      options.static = [getStaticItem(options.static)];\n    }\n    if (typeof options.watchFiles === \"string\") {\n      options.watchFiles = [{\n        paths: options.watchFiles,\n        options: getWatchOptions()\n      }];\n    } else if (typeof options.watchFiles === \"object\" && options.watchFiles !== null && !Array.isArray(options.watchFiles)) {\n      options.watchFiles = [{\n        paths: options.watchFiles.paths,\n        options: getWatchOptions(options.watchFiles.options || {})\n      }];\n    } else if (Array.isArray(options.watchFiles)) {\n      options.watchFiles = options.watchFiles.map(item => {\n        if (typeof item === \"string\") {\n          return {\n            paths: item,\n            options: getWatchOptions()\n          };\n        }\n        return {\n          paths: item.paths,\n          options: getWatchOptions(item.options || {})\n        };\n      });\n    } else {\n      options.watchFiles = [];\n    }\n    const defaultWebSocketServerType = \"ws\";\n    const defaultWebSocketServerOptions = {\n      path: \"/ws\"\n    };\n    if (typeof options.webSocketServer === \"undefined\") {\n      options.webSocketServer = {\n        type: defaultWebSocketServerType,\n        options: defaultWebSocketServerOptions\n      };\n    } else if (typeof options.webSocketServer === \"boolean\" && !options.webSocketServer) {\n      options.webSocketServer = false;\n    } else if (typeof options.webSocketServer === \"string\" || typeof options.webSocketServer === \"function\") {\n      options.webSocketServer = {\n        type: options.webSocketServer,\n        options: defaultWebSocketServerOptions\n      };\n    } else {\n      options.webSocketServer = {\n        type: /** @type {WebSocketServerConfiguration} */\n        options.webSocketServer.type || defaultWebSocketServerType,\n        options: {\n          ...defaultWebSocketServerOptions,\n          ... /** @type {WebSocketServerConfiguration} */\n          options.webSocketServer.options\n        }\n      };\n      const webSocketServer = /** @type {{ type: WebSocketServerConfiguration[\"type\"], options: NonNullable<WebSocketServerConfiguration[\"options\"]> }} */\n      options.webSocketServer;\n      if (typeof webSocketServer.options.port === \"string\") {\n        webSocketServer.options.port = Number(webSocketServer.options.port);\n      }\n    }\n  }\n\n  /**\n   * @private\n   * @returns {string}\n   */\n  getClientTransport() {\n    let clientImplementation;\n    let clientImplementationFound = true;\n    const isKnownWebSocketServerImplementation = this.options.webSocketServer && typeof /** @type {WebSocketServerConfiguration} */\n    this.options.webSocketServer.type === \"string\" && (\n    // @ts-ignore\n    this.options.webSocketServer.type === \"ws\" || /** @type {WebSocketServerConfiguration} */\n    this.options.webSocketServer.type === \"sockjs\");\n    let clientTransport;\n    if (this.options.client) {\n      if (typeof /** @type {ClientConfiguration} */\n      this.options.client.webSocketTransport !== \"undefined\") {\n        clientTransport = /** @type {ClientConfiguration} */\n        this.options.client.webSocketTransport;\n      } else if (isKnownWebSocketServerImplementation) {\n        clientTransport = /** @type {WebSocketServerConfiguration} */\n        this.options.webSocketServer.type;\n      } else {\n        clientTransport = \"ws\";\n      }\n    } else {\n      clientTransport = \"ws\";\n    }\n    switch (typeof clientTransport) {\n      case \"string\":\n        // could be 'sockjs', 'ws', or a path that should be required\n        if (clientTransport === \"sockjs\") {\n          clientImplementation = require.resolve(\"../client/clients/SockJSClient\");\n        } else if (clientTransport === \"ws\") {\n          clientImplementation = require.resolve(\"../client/clients/WebSocketClient\");\n        } else {\n          try {\n            clientImplementation = require.resolve(clientTransport);\n          } catch (e) {\n            clientImplementationFound = false;\n          }\n        }\n        break;\n      default:\n        clientImplementationFound = false;\n    }\n    if (!clientImplementationFound) {\n      throw new Error(`${!isKnownWebSocketServerImplementation ? \"When you use custom web socket implementation you must explicitly specify client.webSocketTransport. \" : \"\"}client.webSocketTransport must be a string denoting a default implementation (e.g. 'sockjs', 'ws') or a full path to a JS file via require.resolve(...) which exports a class `);\n    }\n    return (/** @type {string} */clientImplementation\n    );\n  }\n\n  /**\n   * @private\n   * @returns {string}\n   */\n  getServerTransport() {\n    let implementation;\n    let implementationFound = true;\n    switch (typeof /** @type {WebSocketServerConfiguration} */\n    this.options.webSocketServer.type) {\n      case \"string\":\n        // Could be 'sockjs', in the future 'ws', or a path that should be required\n        if ( /** @type {WebSocketServerConfiguration} */this.options.webSocketServer.type === \"sockjs\") {\n          implementation = require(\"./servers/SockJSServer\");\n        } else if ( /** @type {WebSocketServerConfiguration} */this.options.webSocketServer.type === \"ws\") {\n          implementation = require(\"./servers/WebsocketServer\");\n        } else {\n          try {\n            // eslint-disable-next-line import/no-dynamic-require\n            implementation = require( /** @type {WebSocketServerConfiguration} */this.options.webSocketServer.type);\n          } catch (error) {\n            implementationFound = false;\n          }\n        }\n        break;\n      case \"function\":\n        implementation = /** @type {WebSocketServerConfiguration} */this.options.webSocketServer.type;\n        break;\n      default:\n        implementationFound = false;\n    }\n    if (!implementationFound) {\n      throw new Error(\"webSocketServer (webSocketServer.type) must be a string denoting a default implementation (e.g. 'ws', 'sockjs'), a full path to \" + \"a JS file which exports a class extending BaseServer (webpack-dev-server/lib/servers/BaseServer.js) \" + \"via require.resolve(...), or the class itself which extends BaseServer\");\n    }\n    return implementation;\n  }\n\n  /**\n   * @private\n   * @returns {void}\n   */\n  setupProgressPlugin() {\n    const {\n      ProgressPlugin\n    } = /** @type {MultiCompiler}*/\n    this.compiler.compilers ? /** @type {MultiCompiler}*/this.compiler.compilers[0].webpack : /** @type {Compiler}*/this.compiler.webpack ||\n    // TODO remove me after drop webpack v4\n    require(\"webpack\");\n    new ProgressPlugin(\n    /**\n     * @param {number} percent\n     * @param {string} msg\n     * @param {string} addInfo\n     * @param {string} pluginName\n     */\n    (percent, msg, addInfo, pluginName) => {\n      percent = Math.floor(percent * 100);\n      if (percent === 100) {\n        msg = \"Compilation completed\";\n      }\n      if (addInfo) {\n        msg = `${msg} (${addInfo})`;\n      }\n      if (this.webSocketServer) {\n        this.sendMessage(this.webSocketServer.clients, \"progress-update\", {\n          percent,\n          msg,\n          pluginName\n        });\n      }\n      if (this.server) {\n        this.server.emit(\"progress-update\", {\n          percent,\n          msg,\n          pluginName\n        });\n      }\n    }).apply(this.compiler);\n  }\n\n  /**\n   * @private\n   * @returns {Promise<void>}\n   */\n  async initialize() {\n    if (this.options.webSocketServer) {\n      const compilers = /** @type {MultiCompiler} */\n      this.compiler.compilers || [this.compiler];\n      compilers.forEach(compiler => {\n        this.addAdditionalEntries(compiler);\n        const webpack = compiler.webpack || require(\"webpack\");\n        new webpack.ProvidePlugin({\n          __webpack_dev_server_client__: this.getClientTransport()\n        }).apply(compiler);\n\n        // TODO remove after drop webpack v4 support\n        compiler.options.plugins = compiler.options.plugins || [];\n        if (this.options.hot) {\n          const HMRPluginExists = compiler.options.plugins.find(p => p.constructor === webpack.HotModuleReplacementPlugin);\n          if (HMRPluginExists) {\n            this.logger.warn(`\"hot: true\" automatically applies HMR plugin, you don't have to add it manually to your webpack configuration.`);\n          } else {\n            // Apply the HMR plugin\n            const plugin = new webpack.HotModuleReplacementPlugin();\n            plugin.apply(compiler);\n          }\n        }\n      });\n      if (this.options.client && /** @type {ClientConfiguration} */this.options.client.progress) {\n        this.setupProgressPlugin();\n      }\n    }\n    this.setupHooks();\n    this.setupApp();\n    this.setupHostHeaderCheck();\n    this.setupDevMiddleware();\n    // Should be after `webpack-dev-middleware`, otherwise other middlewares might rewrite response\n    this.setupBuiltInRoutes();\n    this.setupWatchFiles();\n    this.setupWatchStaticFiles();\n    this.setupMiddlewares();\n    this.createServer();\n    if (this.options.setupExitSignals) {\n      const signals = [\"SIGINT\", \"SIGTERM\"];\n      let needForceShutdown = false;\n      signals.forEach(signal => {\n        const listener = () => {\n          if (needForceShutdown) {\n            process.exit();\n          }\n          this.logger.info(\"Gracefully shutting down. To force exit, press ^C again. Please wait...\");\n          needForceShutdown = true;\n          this.stopCallback(() => {\n            if (typeof this.compiler.close === \"function\") {\n              this.compiler.close(() => {\n                process.exit();\n              });\n            } else {\n              process.exit();\n            }\n          });\n        };\n        this.listeners.push({\n          name: signal,\n          listener\n        });\n        process.on(signal, listener);\n      });\n    }\n\n    // Proxy WebSocket without the initial http request\n    // https://github.com/chimurai/http-proxy-middleware#external-websocket-upgrade\n    /** @type {RequestHandler[]} */\n    this.webSocketProxies.forEach(webSocketProxy => {\n      /** @type {import(\"http\").Server} */\n      this.server.on(\"upgrade\", /** @type {RequestHandler & { upgrade: NonNullable<RequestHandler[\"upgrade\"]> }} */\n      webSocketProxy.upgrade);\n    }, this);\n  }\n\n  /**\n   * @private\n   * @returns {void}\n   */\n  setupApp() {\n    /** @type {import(\"express\").Application | undefined}*/\n    // eslint-disable-next-line new-cap\n    this.app = new /** @type {any} */express();\n  }\n\n  /**\n   * @private\n   * @param {Stats | MultiStats} statsObj\n   * @returns {StatsCompilation}\n   */\n  getStats(statsObj) {\n    const stats = Server.DEFAULT_STATS;\n    const compilerOptions = this.getCompilerOptions();\n\n    // @ts-ignore\n    if (compilerOptions.stats && compilerOptions.stats.warningsFilter) {\n      // @ts-ignore\n      stats.warningsFilter = compilerOptions.stats.warningsFilter;\n    }\n    return statsObj.toJson(stats);\n  }\n\n  /**\n   * @private\n   * @returns {void}\n   */\n  setupHooks() {\n    this.compiler.hooks.invalid.tap(\"webpack-dev-server\", () => {\n      if (this.webSocketServer) {\n        this.sendMessage(this.webSocketServer.clients, \"invalid\");\n      }\n    });\n    this.compiler.hooks.done.tap(\"webpack-dev-server\",\n    /**\n     * @param {Stats | MultiStats} stats\n     */\n    stats => {\n      if (this.webSocketServer) {\n        this.sendStats(this.webSocketServer.clients, this.getStats(stats));\n      }\n\n      /**\n       * @private\n       * @type {Stats | MultiStats}\n       */\n      this.stats = stats;\n    });\n  }\n\n  /**\n   * @private\n   * @returns {void}\n   */\n  setupHostHeaderCheck() {\n    /** @type {import(\"express\").Application} */\n    this.app.all(\"*\",\n    /**\n     * @param {Request} req\n     * @param {Response} res\n     * @param {NextFunction} next\n     * @returns {void}\n     */\n    (req, res, next) => {\n      if (this.checkHeader( /** @type {{ [key: string]: string | undefined }} */\n      req.headers, \"host\")) {\n        return next();\n      }\n      res.send(\"Invalid Host header\");\n    });\n  }\n\n  /**\n   * @private\n   * @returns {void}\n   */\n  setupDevMiddleware() {\n    const webpackDevMiddleware = require(\"webpack-dev-middleware\");\n\n    // middleware for serving webpack bundle\n    this.middleware = webpackDevMiddleware(this.compiler, this.options.devMiddleware);\n  }\n\n  /**\n   * @private\n   * @returns {void}\n   */\n  setupBuiltInRoutes() {\n    const {\n      app,\n      middleware\n    } = this;\n\n    /** @type {import(\"express\").Application} */\n    app.get(\"/__webpack_dev_server__/sockjs.bundle.js\",\n    /**\n     * @param {Request} req\n     * @param {Response} res\n     * @returns {void}\n     */\n    (req, res) => {\n      res.setHeader(\"Content-Type\", \"application/javascript\");\n      const clientPath = path.join(__dirname, \"..\", \"client\");\n      res.sendFile(path.join(clientPath, \"modules/sockjs-client/index.js\"));\n    });\n\n    /** @type {import(\"express\").Application} */\n    app.get(\"/webpack-dev-server/invalidate\",\n    /**\n     * @param {Request} _req\n     * @param {Response} res\n     * @returns {void}\n     */\n    (_req, res) => {\n      this.invalidate();\n      res.end();\n    });\n\n    /** @type {import(\"express\").Application} */\n    app.get(\"/webpack-dev-server/open-editor\", (req, res) => {\n      const fileName = req.query.fileName;\n      if (typeof fileName === \"string\") {\n        // @ts-ignore\n        const launchEditor = require(\"launch-editor\");\n        launchEditor(fileName);\n      }\n      res.end();\n    });\n\n    /** @type {import(\"express\").Application} */\n    app.get(\"/webpack-dev-server\",\n    /**\n     * @param {Request} req\n     * @param {Response} res\n     * @returns {void}\n     */\n    (req, res) => {\n      /** @type {import(\"webpack-dev-middleware\").API<Request, Response>}*/\n      middleware.waitUntilValid(stats => {\n        res.setHeader(\"Content-Type\", \"text/html\");\n        res.write('<!DOCTYPE html><html><head><meta charset=\"utf-8\"/></head><body>');\n        const statsForPrint = typeof /** @type {MultiStats} */stats.stats !== \"undefined\" ? /** @type {MultiStats} */stats.toJson().children : [/** @type {Stats} */stats.toJson()];\n        res.write(`<h1>Assets Report:</h1>`);\n\n        /**\n         * @type {StatsCompilation[]}\n         */\n        statsForPrint.forEach((item, index) => {\n          res.write(\"<div>\");\n          const name =\n          // eslint-disable-next-line no-nested-ternary\n          typeof item.name !== \"undefined\" ? item.name : /** @type {MultiStats} */stats.stats ? `unnamed[${index}]` : \"unnamed\";\n          res.write(`<h2>Compilation: ${name}</h2>`);\n          res.write(\"<ul>\");\n          const publicPath = item.publicPath === \"auto\" ? \"\" : item.publicPath;\n          for (const asset of /** @type {NonNullable<StatsCompilation[\"assets\"]>} */\n          item.assets) {\n            const assetName = asset.name;\n            const assetURL = `${publicPath}${assetName}`;\n            res.write(`<li>\n              <strong><a href=\"${assetURL}\" target=\"_blank\">${assetName}</a></strong>\n            </li>`);\n          }\n          res.write(\"</ul>\");\n          res.write(\"</div>\");\n        });\n        res.end(\"</body></html>\");\n      });\n    });\n  }\n\n  /**\n   * @private\n   * @returns {void}\n   */\n  setupWatchStaticFiles() {\n    if ( /** @type {NormalizedStatic[]} */this.options.static.length > 0) {\n      /** @type {NormalizedStatic[]} */\n      this.options.static.forEach(staticOption => {\n        if (staticOption.watch) {\n          this.watchFiles(staticOption.directory, staticOption.watch);\n        }\n      });\n    }\n  }\n\n  /**\n   * @private\n   * @returns {void}\n   */\n  setupWatchFiles() {\n    const {\n      watchFiles\n    } = this.options;\n    if ( /** @type {WatchFiles[]} */watchFiles.length > 0) {\n      /** @type {WatchFiles[]} */\n      watchFiles.forEach(item => {\n        this.watchFiles(item.paths, item.options);\n      });\n    }\n  }\n\n  /**\n   * @private\n   * @returns {void}\n   */\n  setupMiddlewares() {\n    /**\n     * @type {Array<Middleware>}\n     */\n    let middlewares = [];\n\n    // compress is placed last and uses unshift so that it will be the first middleware used\n    if (this.options.compress) {\n      const compression = require(\"compression\");\n      middlewares.push({\n        name: \"compression\",\n        middleware: compression()\n      });\n    }\n    if (typeof this.options.onBeforeSetupMiddleware === \"function\") {\n      this.options.onBeforeSetupMiddleware(this);\n    }\n    if (typeof this.options.headers !== \"undefined\") {\n      middlewares.push({\n        name: \"set-headers\",\n        path: \"*\",\n        middleware: this.setHeaders.bind(this)\n      });\n    }\n    middlewares.push({\n      name: \"webpack-dev-middleware\",\n      middleware: /** @type {import(\"webpack-dev-middleware\").Middleware<Request, Response>}*/\n      this.middleware\n    });\n    if (this.options.proxy) {\n      const {\n        createProxyMiddleware\n      } = require(\"http-proxy-middleware\");\n\n      /**\n       * @param {ProxyConfigArrayItem} proxyConfig\n       * @returns {RequestHandler | undefined}\n       */\n      const getProxyMiddleware = proxyConfig => {\n        // It is possible to use the `bypass` method without a `target` or `router`.\n        // However, the proxy middleware has no use in this case, and will fail to instantiate.\n        if (proxyConfig.target) {\n          const context = proxyConfig.context || proxyConfig.path;\n          return createProxyMiddleware( /** @type {string} */context, proxyConfig);\n        }\n        if (proxyConfig.router) {\n          return createProxyMiddleware(proxyConfig);\n        }\n      };\n\n      /**\n       * Assume a proxy configuration specified as:\n       * proxy: [\n       *   {\n       *     context: \"value\",\n       *     ...options,\n       *   },\n       *   // or:\n       *   function() {\n       *     return {\n       *       context: \"context\",\n       *       ...options,\n       *     };\n       *   }\n       * ]\n       */\n      /** @type {ProxyConfigArray} */\n      this.options.proxy.forEach(proxyConfigOrCallback => {\n        /**\n         * @type {RequestHandler}\n         */\n        let proxyMiddleware;\n        let proxyConfig = typeof proxyConfigOrCallback === \"function\" ? proxyConfigOrCallback() : proxyConfigOrCallback;\n        proxyMiddleware = /** @type {RequestHandler} */\n        getProxyMiddleware(proxyConfig);\n        if (proxyConfig.ws) {\n          this.webSocketProxies.push(proxyMiddleware);\n        }\n\n        /**\n         * @param {Request} req\n         * @param {Response} res\n         * @param {NextFunction} next\n         * @returns {Promise<void>}\n         */\n        const handler = async (req, res, next) => {\n          if (typeof proxyConfigOrCallback === \"function\") {\n            const newProxyConfig = proxyConfigOrCallback(req, res, next);\n            if (newProxyConfig !== proxyConfig) {\n              proxyConfig = newProxyConfig;\n              proxyMiddleware = /** @type {RequestHandler} */\n              getProxyMiddleware(proxyConfig);\n            }\n          }\n\n          // - Check if we have a bypass function defined\n          // - In case the bypass function is defined we'll retrieve the\n          // bypassUrl from it otherwise bypassUrl would be null\n          // TODO remove in the next major in favor `context` and `router` options\n          const isByPassFuncDefined = typeof proxyConfig.bypass === \"function\";\n          const bypassUrl = isByPassFuncDefined ? await (/** @type {ByPass} */proxyConfig.bypass(req, res, proxyConfig)\n          ) : null;\n          if (typeof bypassUrl === \"boolean\") {\n            // skip the proxy\n            // @ts-ignore\n            req.url = null;\n            next();\n          } else if (typeof bypassUrl === \"string\") {\n            // byPass to that url\n            req.url = bypassUrl;\n            next();\n          } else if (proxyMiddleware) {\n            return proxyMiddleware(req, res, next);\n          } else {\n            next();\n          }\n        };\n        middlewares.push({\n          name: \"http-proxy-middleware\",\n          middleware: handler\n        });\n        // Also forward error requests to the proxy so it can handle them.\n        middlewares.push({\n          name: \"http-proxy-middleware-error-handler\",\n          middleware:\n          /**\n           * @param {Error} error\n           * @param {Request} req\n           * @param {Response} res\n           * @param {NextFunction} next\n           * @returns {any}\n           */\n          (error, req, res, next) => handler(req, res, next)\n        });\n      });\n      middlewares.push({\n        name: \"webpack-dev-middleware\",\n        middleware: /** @type {import(\"webpack-dev-middleware\").Middleware<Request, Response>}*/\n        this.middleware\n      });\n    }\n    if ( /** @type {NormalizedStatic[]} */this.options.static.length > 0) {\n      /** @type {NormalizedStatic[]} */\n      this.options.static.forEach(staticOption => {\n        staticOption.publicPath.forEach(publicPath => {\n          middlewares.push({\n            name: \"express-static\",\n            path: publicPath,\n            middleware: express.static(staticOption.directory, staticOption.staticOptions)\n          });\n        });\n      });\n    }\n    if (this.options.historyApiFallback) {\n      const connectHistoryApiFallback = require(\"connect-history-api-fallback\");\n      const {\n        historyApiFallback\n      } = this.options;\n      if (typeof /** @type {ConnectHistoryApiFallbackOptions} */\n      historyApiFallback.logger === \"undefined\" && ! /** @type {ConnectHistoryApiFallbackOptions} */\n      historyApiFallback.verbose) {\n        // @ts-ignore\n        historyApiFallback.logger = this.logger.log.bind(this.logger, \"[connect-history-api-fallback]\");\n      }\n\n      // Fall back to /index.html if nothing else matches.\n      middlewares.push({\n        name: \"connect-history-api-fallback\",\n        middleware: connectHistoryApiFallback( /** @type {ConnectHistoryApiFallbackOptions} */\n        historyApiFallback)\n      });\n\n      // include our middleware to ensure\n      // it is able to handle '/index.html' request after redirect\n      middlewares.push({\n        name: \"webpack-dev-middleware\",\n        middleware: /** @type {import(\"webpack-dev-middleware\").Middleware<Request, Response>}*/\n        this.middleware\n      });\n      if ( /** @type {NormalizedStatic[]} */this.options.static.length > 0) {\n        /** @type {NormalizedStatic[]} */\n        this.options.static.forEach(staticOption => {\n          staticOption.publicPath.forEach(publicPath => {\n            middlewares.push({\n              name: \"express-static\",\n              path: publicPath,\n              middleware: express.static(staticOption.directory, staticOption.staticOptions)\n            });\n          });\n        });\n      }\n    }\n    if ( /** @type {NormalizedStatic[]} */this.options.static.length > 0) {\n      const serveIndex = require(\"serve-index\");\n\n      /** @type {NormalizedStatic[]} */\n      this.options.static.forEach(staticOption => {\n        staticOption.publicPath.forEach(publicPath => {\n          if (staticOption.serveIndex) {\n            middlewares.push({\n              name: \"serve-index\",\n              path: publicPath,\n              /**\n               * @param {Request} req\n               * @param {Response} res\n               * @param {NextFunction} next\n               * @returns {void}\n               */\n              middleware: (req, res, next) => {\n                // serve-index doesn't fallthrough non-get/head request to next middleware\n                if (req.method !== \"GET\" && req.method !== \"HEAD\") {\n                  return next();\n                }\n                serveIndex(staticOption.directory, /** @type {ServeIndexOptions} */\n                staticOption.serveIndex)(req, res, next);\n              }\n            });\n          }\n        });\n      });\n    }\n    if (this.options.magicHtml) {\n      middlewares.push({\n        name: \"serve-magic-html\",\n        middleware: this.serveMagicHtml.bind(this)\n      });\n    }\n\n    // Register this middleware always as the last one so that it's only used as a\n    // fallback when no other middleware responses.\n    middlewares.push({\n      name: \"options-middleware\",\n      path: \"*\",\n      /**\n       * @param {Request} req\n       * @param {Response} res\n       * @param {NextFunction} next\n       * @returns {void}\n       */\n      middleware: (req, res, next) => {\n        if (req.method === \"OPTIONS\") {\n          res.statusCode = 204;\n          res.setHeader(\"Content-Length\", \"0\");\n          res.end();\n          return;\n        }\n        next();\n      }\n    });\n    if (typeof this.options.setupMiddlewares === \"function\") {\n      middlewares = this.options.setupMiddlewares(middlewares, this);\n    }\n    middlewares.forEach(middleware => {\n      if (typeof middleware === \"function\") {\n        /** @type {import(\"express\").Application} */\n        this.app.use(middleware);\n      } else if (typeof middleware.path !== \"undefined\") {\n        /** @type {import(\"express\").Application} */\n        this.app.use(middleware.path, middleware.middleware);\n      } else {\n        /** @type {import(\"express\").Application} */\n        this.app.use(middleware.middleware);\n      }\n    });\n    if (typeof this.options.onAfterSetupMiddleware === \"function\") {\n      this.options.onAfterSetupMiddleware(this);\n    }\n  }\n\n  /**\n   * @private\n   * @returns {void}\n   */\n  createServer() {\n    const {\n      type,\n      options\n    } = /** @type {ServerConfiguration} */\n    this.options.server;\n\n    /** @type {import(\"http\").Server | undefined | null} */\n    // eslint-disable-next-line import/no-dynamic-require\n    this.server = require( /** @type {string} */type).createServer(options, this.app);\n\n    /** @type {import(\"http\").Server} */\n    this.server.on(\"connection\",\n    /**\n     * @param {Socket} socket\n     */\n    socket => {\n      // Add socket to list\n      this.sockets.push(socket);\n      socket.once(\"close\", () => {\n        // Remove socket from list\n        this.sockets.splice(this.sockets.indexOf(socket), 1);\n      });\n    });\n\n    /** @type {import(\"http\").Server} */\n    this.server.on(\"error\",\n    /**\n     * @param {Error} error\n     */\n    error => {\n      throw error;\n    });\n  }\n\n  /**\n   * @private\n   * @returns {void}\n   */\n  // TODO: remove `--web-socket-server` in favor of `--web-socket-server-type`\n  createWebSocketServer() {\n    /** @type {WebSocketServerImplementation | undefined | null} */\n    this.webSocketServer = new ( /** @type {any} */this.getServerTransport())(this);\n    /** @type {WebSocketServerImplementation} */\n    this.webSocketServer.implementation.on(\"connection\",\n    /**\n     * @param {ClientConnection} client\n     * @param {IncomingMessage} request\n     */\n    (client, request) => {\n      /** @type {{ [key: string]: string | undefined } | undefined} */\n      const headers =\n      // eslint-disable-next-line no-nested-ternary\n      typeof request !== \"undefined\" ? /** @type {{ [key: string]: string | undefined }} */\n      request.headers : typeof /** @type {import(\"sockjs\").Connection} */client.headers !== \"undefined\" ? /** @type {import(\"sockjs\").Connection} */client.headers :\n      // eslint-disable-next-line no-undefined\n      undefined;\n      if (!headers) {\n        this.logger.warn('webSocketServer implementation must pass headers for the \"connection\" event');\n      }\n      if (!headers || !this.checkHeader(headers, \"host\") || !this.checkHeader(headers, \"origin\")) {\n        this.sendMessage([client], \"error\", \"Invalid Host/Origin header\");\n\n        // With https enabled, the sendMessage above is encrypted asynchronously so not yet sent\n        // Terminate would prevent it sending, so use close to allow it to be sent\n        client.close();\n        return;\n      }\n      if (this.options.hot === true || this.options.hot === \"only\") {\n        this.sendMessage([client], \"hot\");\n      }\n      if (this.options.liveReload) {\n        this.sendMessage([client], \"liveReload\");\n      }\n      if (this.options.client && /** @type {ClientConfiguration} */\n      this.options.client.progress) {\n        this.sendMessage([client], \"progress\", /** @type {ClientConfiguration} */\n        this.options.client.progress);\n      }\n      if (this.options.client && /** @type {ClientConfiguration} */this.options.client.reconnect) {\n        this.sendMessage([client], \"reconnect\", /** @type {ClientConfiguration} */\n        this.options.client.reconnect);\n      }\n      if (this.options.client && /** @type {ClientConfiguration} */\n      this.options.client.overlay) {\n        this.sendMessage([client], \"overlay\", /** @type {ClientConfiguration} */\n        this.options.client.overlay);\n      }\n      if (!this.stats) {\n        return;\n      }\n      this.sendStats([client], this.getStats(this.stats), true);\n    });\n  }\n\n  /**\n   * @private\n   * @param {string} defaultOpenTarget\n   * @returns {void}\n   */\n  openBrowser(defaultOpenTarget) {\n    const open = require(\"open\");\n    Promise.all( /** @type {NormalizedOpen[]} */\n    this.options.open.map(item => {\n      /**\n       * @type {string}\n       */\n      let openTarget;\n      if (item.target === \"<url>\") {\n        openTarget = defaultOpenTarget;\n      } else {\n        openTarget = Server.isAbsoluteURL(item.target) ? item.target : new URL(item.target, defaultOpenTarget).toString();\n      }\n      return open(openTarget, item.options).catch(() => {\n        this.logger.warn(`Unable to open \"${openTarget}\" page${item.options.app ? ` in \"${\n        /** @type {import(\"open\").App} */item.options.app.name}\" app${\n        /** @type {import(\"open\").App} */item.options.app.arguments ? ` with \"${\n        /** @type {import(\"open\").App} */item.options.app.arguments.join(\" \")}\" arguments` : \"\"}` : \"\"}. If you are running in a headless environment, please do not use the \"open\" option or related flags like \"--open\", \"--open-target\", and \"--open-app\".`);\n      });\n    }));\n  }\n\n  /**\n   * @private\n   * @returns {void}\n   */\n  runBonjour() {\n    const {\n      Bonjour\n    } = require(\"bonjour-service\");\n    /**\n     * @private\n     * @type {Bonjour | undefined}\n     */\n    this.bonjour = new Bonjour();\n    this.bonjour.publish({\n      // @ts-expect-error\n      name: `Webpack Dev Server ${os.hostname()}:${this.options.port}`,\n      // @ts-expect-error\n      port: /** @type {number} */this.options.port,\n      // @ts-expect-error\n      type: /** @type {ServerConfiguration} */\n      this.options.server.type === \"http\" ? \"http\" : \"https\",\n      subtypes: [\"webpack\"],\n      ... /** @type {BonjourOptions} */this.options.bonjour\n    });\n  }\n\n  /**\n   * @private\n   * @returns {void}\n   */\n  stopBonjour(callback = () => {}) {\n    /** @type {Bonjour} */\n    this.bonjour.unpublishAll(() => {\n      /** @type {Bonjour} */\n      this.bonjour.destroy();\n      if (callback) {\n        callback();\n      }\n    });\n  }\n\n  /**\n   * @private\n   * @returns {void}\n   */\n  logStatus() {\n    const {\n      isColorSupported,\n      cyan,\n      red\n    } = require(\"colorette\");\n\n    /**\n     * @param {Compiler[\"options\"]} compilerOptions\n     * @returns {boolean}\n     */\n    const getColorsOption = compilerOptions => {\n      /**\n       * @type {boolean}\n       */\n      let colorsEnabled;\n      if (compilerOptions.stats && typeof /** @type {StatsOptions} */compilerOptions.stats.colors !== \"undefined\") {\n        colorsEnabled = /** @type {boolean} */\n        /** @type {StatsOptions} */compilerOptions.stats.colors;\n      } else {\n        colorsEnabled = isColorSupported;\n      }\n      return colorsEnabled;\n    };\n    const colors = {\n      /**\n       * @param {boolean} useColor\n       * @param {string} msg\n       * @returns {string}\n       */\n      info(useColor, msg) {\n        if (useColor) {\n          return cyan(msg);\n        }\n        return msg;\n      },\n      /**\n       * @param {boolean} useColor\n       * @param {string} msg\n       * @returns {string}\n       */\n      error(useColor, msg) {\n        if (useColor) {\n          return red(msg);\n        }\n        return msg;\n      }\n    };\n    const useColor = getColorsOption(this.getCompilerOptions());\n    if (this.options.ipc) {\n      this.logger.info(`Project is running at: \"${\n      /** @type {import(\"http\").Server} */this.server.address()}\"`);\n    } else {\n      const protocol = /** @type {ServerConfiguration} */\n      this.options.server.type === \"http\" ? \"http\" : \"https\";\n      const {\n        address,\n        port\n      } = /** @type {import(\"net\").AddressInfo} */\n\n      /** @type {import(\"http\").Server} */\n      this.server.address();\n      /**\n       * @param {string} newHostname\n       * @returns {string}\n       */\n      const prettyPrintURL = newHostname => url.format({\n        protocol,\n        hostname: newHostname,\n        port,\n        pathname: \"/\"\n      });\n      let server;\n      let localhost;\n      let loopbackIPv4;\n      let loopbackIPv6;\n      let networkUrlIPv4;\n      let networkUrlIPv6;\n      if (this.options.host) {\n        if (this.options.host === \"localhost\") {\n          localhost = prettyPrintURL(\"localhost\");\n        } else {\n          let isIP;\n          try {\n            isIP = ipaddr.parse(this.options.host);\n          } catch (error) {\n            // Ignore\n          }\n          if (!isIP) {\n            server = prettyPrintURL(this.options.host);\n          }\n        }\n      }\n      const parsedIP = ipaddr.parse(address);\n      if (parsedIP.range() === \"unspecified\") {\n        localhost = prettyPrintURL(\"localhost\");\n        const networkIPv4 = Server.internalIPSync(\"v4\");\n        if (networkIPv4) {\n          networkUrlIPv4 = prettyPrintURL(networkIPv4);\n        }\n        const networkIPv6 = Server.internalIPSync(\"v6\");\n        if (networkIPv6) {\n          networkUrlIPv6 = prettyPrintURL(networkIPv6);\n        }\n      } else if (parsedIP.range() === \"loopback\") {\n        if (parsedIP.kind() === \"ipv4\") {\n          loopbackIPv4 = prettyPrintURL(parsedIP.toString());\n        } else if (parsedIP.kind() === \"ipv6\") {\n          loopbackIPv6 = prettyPrintURL(parsedIP.toString());\n        }\n      } else {\n        networkUrlIPv4 = parsedIP.kind() === \"ipv6\" && /** @type {IPv6} */\n        parsedIP.isIPv4MappedAddress() ? prettyPrintURL( /** @type {IPv6} */\n        parsedIP.toIPv4Address().toString()) : prettyPrintURL(address);\n        if (parsedIP.kind() === \"ipv6\") {\n          networkUrlIPv6 = prettyPrintURL(address);\n        }\n      }\n      this.logger.info(\"Project is running at:\");\n      if (server) {\n        this.logger.info(`Server: ${colors.info(useColor, server)}`);\n      }\n      if (localhost || loopbackIPv4 || loopbackIPv6) {\n        const loopbacks = [];\n        if (localhost) {\n          loopbacks.push([colors.info(useColor, localhost)]);\n        }\n        if (loopbackIPv4) {\n          loopbacks.push([colors.info(useColor, loopbackIPv4)]);\n        }\n        if (loopbackIPv6) {\n          loopbacks.push([colors.info(useColor, loopbackIPv6)]);\n        }\n        this.logger.info(`Loopback: ${loopbacks.join(\", \")}`);\n      }\n      if (networkUrlIPv4) {\n        this.logger.info(`On Your Network (IPv4): ${colors.info(useColor, networkUrlIPv4)}`);\n      }\n      if (networkUrlIPv6) {\n        this.logger.info(`On Your Network (IPv6): ${colors.info(useColor, networkUrlIPv6)}`);\n      }\n      if ( /** @type {NormalizedOpen[]} */this.options.open.length > 0) {\n        const openTarget = prettyPrintURL(this.options.host || \"localhost\");\n        this.openBrowser(openTarget);\n      }\n    }\n    if ( /** @type {NormalizedStatic[]} */this.options.static.length > 0) {\n      this.logger.info(`Content not from webpack is served from '${colors.info(useColor, /** @type {NormalizedStatic[]} */\n      this.options.static.map(staticOption => staticOption.directory).join(\", \"))}' directory`);\n    }\n    if (this.options.historyApiFallback) {\n      this.logger.info(`404s will fallback to '${colors.info(useColor, /** @type {ConnectHistoryApiFallbackOptions} */this.options.historyApiFallback.index || \"/index.html\")}'`);\n    }\n    if (this.options.bonjour) {\n      const bonjourProtocol = /** @type {BonjourOptions} */\n      this.options.bonjour.type || /** @type {ServerConfiguration} */\n      this.options.server.type === \"http\" ? \"http\" : \"https\";\n      this.logger.info(`Broadcasting \"${bonjourProtocol}\" with subtype of \"webpack\" via ZeroConf DNS (Bonjour)`);\n    }\n  }\n\n  /**\n   * @private\n   * @param {Request} req\n   * @param {Response} res\n   * @param {NextFunction} next\n   */\n  setHeaders(req, res, next) {\n    let {\n      headers\n    } = this.options;\n    if (headers) {\n      if (typeof headers === \"function\") {\n        headers = headers(req, res, /** @type {import(\"webpack-dev-middleware\").API<Request, Response>}*/\n        this.middleware.context);\n      }\n\n      /**\n       * @type {{key: string, value: string}[]}\n       */\n      const allHeaders = [];\n      if (!Array.isArray(headers)) {\n        // eslint-disable-next-line guard-for-in\n        for (const name in headers) {\n          // @ts-ignore\n          allHeaders.push({\n            key: name,\n            value: headers[name]\n          });\n        }\n        headers = allHeaders;\n      }\n      headers.forEach(\n      /**\n       * @param {{key: string, value: any}} header\n       */\n      header => {\n        res.setHeader(header.key, header.value);\n      });\n    }\n    next();\n  }\n\n  /**\n   * @private\n   * @param {{ [key: string]: string | undefined }} headers\n   * @param {string} headerToCheck\n   * @returns {boolean}\n   */\n  checkHeader(headers, headerToCheck) {\n    // allow user to opt out of this security check, at their own risk\n    // by explicitly enabling allowedHosts\n    if (this.options.allowedHosts === \"all\") {\n      return true;\n    }\n\n    // get the Host header and extract hostname\n    // we don't care about port not matching\n    const hostHeader = headers[headerToCheck];\n    if (!hostHeader) {\n      return false;\n    }\n    if (/^(file|.+-extension):/i.test(hostHeader)) {\n      return true;\n    }\n\n    // use the node url-parser to retrieve the hostname from the host-header.\n    const hostname = url.parse(\n    // if hostHeader doesn't have scheme, add // for parsing.\n    /^(.+:)?\\/\\//.test(hostHeader) ? hostHeader : `//${hostHeader}`, false, true).hostname;\n\n    // always allow requests with explicit IPv4 or IPv6-address.\n    // A note on IPv6 addresses:\n    // hostHeader will always contain the brackets denoting\n    // an IPv6-address in URLs,\n    // these are removed from the hostname in url.parse(),\n    // so we have the pure IPv6-address in hostname.\n    // For convenience, always allow localhost (hostname === 'localhost')\n    // and its subdomains (hostname.endsWith(\".localhost\")).\n    // allow hostname of listening address  (hostname === this.options.host)\n    const isValidHostname = hostname !== null && ipaddr.IPv4.isValid(hostname) || hostname !== null && ipaddr.IPv6.isValid(hostname) || hostname === \"localhost\" || hostname !== null && hostname.endsWith(\".localhost\") || hostname === this.options.host;\n    if (isValidHostname) {\n      return true;\n    }\n    const {\n      allowedHosts\n    } = this.options;\n\n    // always allow localhost host, for convenience\n    // allow if hostname is in allowedHosts\n    if (Array.isArray(allowedHosts) && allowedHosts.length > 0) {\n      for (let hostIdx = 0; hostIdx < allowedHosts.length; hostIdx++) {\n        const allowedHost = allowedHosts[hostIdx];\n        if (allowedHost === hostname) {\n          return true;\n        }\n\n        // support \".\" as a subdomain wildcard\n        // e.g. \".example.com\" will allow \"example.com\", \"www.example.com\", \"subdomain.example.com\", etc\n        if (allowedHost[0] === \".\") {\n          // \"example.com\"  (hostname === allowedHost.substring(1))\n          // \"*.example.com\"  (hostname.endsWith(allowedHost))\n          if (hostname === allowedHost.substring(1) || /** @type {string} */hostname.endsWith(allowedHost)) {\n            return true;\n          }\n        }\n      }\n    }\n\n    // Also allow if `client.webSocketURL.hostname` provided\n    if (this.options.client && typeof /** @type {ClientConfiguration} */this.options.client.webSocketURL !== \"undefined\") {\n      return (/** @type {WebSocketURL} */\n        /** @type {ClientConfiguration} */this.options.client.webSocketURL.hostname === hostname\n      );\n    }\n\n    // disallow\n    return false;\n  }\n\n  /**\n   * @param {ClientConnection[]} clients\n   * @param {string} type\n   * @param {any} [data]\n   * @param {any} [params]\n   */\n  // eslint-disable-next-line class-methods-use-this\n  sendMessage(clients, type, data, params) {\n    for (const client of clients) {\n      // `sockjs` uses `1` to indicate client is ready to accept data\n      // `ws` uses `WebSocket.OPEN`, but it is mean `1` too\n      if (client.readyState === 1) {\n        client.send(JSON.stringify({\n          type,\n          data,\n          params\n        }));\n      }\n    }\n  }\n\n  /**\n   * @private\n   * @param {Request} req\n   * @param {Response} res\n   * @param {NextFunction} next\n   * @returns {void}\n   */\n  serveMagicHtml(req, res, next) {\n    if (req.method !== \"GET\" && req.method !== \"HEAD\") {\n      return next();\n    }\n\n    /** @type {import(\"webpack-dev-middleware\").API<Request, Response>}*/\n    this.middleware.waitUntilValid(() => {\n      const _path = req.path;\n      try {\n        const filename = /** @type {import(\"webpack-dev-middleware\").API<Request, Response>}*/\n        this.middleware.getFilenameFromUrl(`${_path}.js`);\n        const isFile = /** @type {Compiler[\"outputFileSystem\"] & { statSync: import(\"fs\").StatSyncFn }}*/\n        /** @type {import(\"webpack-dev-middleware\").API<Request, Response>}*/\n        this.middleware.context.outputFileSystem.statSync( /** @type {import(\"fs\").PathLike} */filename).isFile();\n        if (!isFile) {\n          return next();\n        }\n\n        // Serve a page that executes the javascript\n        // @ts-ignore\n        const queries = req._parsedUrl.search || \"\";\n        const responsePage = `<!DOCTYPE html><html><head><meta charset=\"utf-8\"/></head><body><script type=\"text/javascript\" charset=\"utf-8\" src=\"${_path}.js${queries}\"></script></body></html>`;\n        res.send(responsePage);\n      } catch (error) {\n        return next();\n      }\n    });\n  }\n\n  // Send stats to a socket or multiple sockets\n  /**\n   * @private\n   * @param {ClientConnection[]} clients\n   * @param {StatsCompilation} stats\n   * @param {boolean} [force]\n   */\n  sendStats(clients, stats, force) {\n    const shouldEmit = !force && stats && (!stats.errors || stats.errors.length === 0) && (!stats.warnings || stats.warnings.length === 0) && this.currentHash === stats.hash;\n    if (shouldEmit) {\n      this.sendMessage(clients, \"still-ok\");\n      return;\n    }\n    this.currentHash = stats.hash;\n    this.sendMessage(clients, \"hash\", stats.hash);\n    if ( /** @type {NonNullable<StatsCompilation[\"errors\"]>} */\n    stats.errors.length > 0 || /** @type {NonNullable<StatsCompilation[\"warnings\"]>} */\n    stats.warnings.length > 0) {\n      const hasErrors = /** @type {NonNullable<StatsCompilation[\"errors\"]>} */\n      stats.errors.length > 0;\n      if ( /** @type {NonNullable<StatsCompilation[\"warnings\"]>} */\n      stats.warnings.length > 0) {\n        let params;\n        if (hasErrors) {\n          params = {\n            preventReloading: true\n          };\n        }\n        this.sendMessage(clients, \"warnings\", stats.warnings, params);\n      }\n      if ( /** @type {NonNullable<StatsCompilation[\"errors\"]>} */stats.errors.length > 0) {\n        this.sendMessage(clients, \"errors\", stats.errors);\n      }\n    } else {\n      this.sendMessage(clients, \"ok\");\n    }\n  }\n\n  /**\n   * @param {string | string[]} watchPath\n   * @param {WatchOptions} [watchOptions]\n   */\n  watchFiles(watchPath, watchOptions) {\n    const chokidar = require(\"chokidar\");\n    const watcher = chokidar.watch(watchPath, watchOptions);\n\n    // disabling refreshing on changing the content\n    if (this.options.liveReload) {\n      watcher.on(\"change\", item => {\n        if (this.webSocketServer) {\n          this.sendMessage(this.webSocketServer.clients, \"static-changed\", item);\n        }\n      });\n    }\n    this.staticWatchers.push(watcher);\n  }\n\n  /**\n   * @param {import(\"webpack-dev-middleware\").Callback} [callback]\n   */\n  invalidate(callback = () => {}) {\n    if (this.middleware) {\n      this.middleware.invalidate(callback);\n    }\n  }\n\n  /**\n   * @returns {Promise<void>}\n   */\n  async start() {\n    await this.normalizeOptions();\n    if (this.options.ipc) {\n      await (/** @type {Promise<void>} */\n        new Promise((resolve, reject) => {\n          const net = require(\"net\");\n          const socket = new net.Socket();\n          socket.on(\"error\",\n          /**\n           * @param {Error & { code?: string }} error\n           */\n          error => {\n            if (error.code === \"ECONNREFUSED\") {\n              // No other server listening on this socket so it can be safely removed\n              fs.unlinkSync( /** @type {string} */this.options.ipc);\n              resolve();\n              return;\n            } else if (error.code === \"ENOENT\") {\n              resolve();\n              return;\n            }\n            reject(error);\n          });\n          socket.connect({\n            path: /** @type {string} */this.options.ipc\n          }, () => {\n            throw new Error(`IPC \"${this.options.ipc}\" is already used`);\n          });\n        })\n      );\n    } else {\n      this.options.host = await Server.getHostname( /** @type {Host} */this.options.host);\n      this.options.port = await Server.getFreePort( /** @type {Port} */this.options.port, this.options.host);\n    }\n    await this.initialize();\n    const listenOptions = this.options.ipc ? {\n      path: this.options.ipc\n    } : {\n      host: this.options.host,\n      port: this.options.port\n    };\n    await (/** @type {Promise<void>} */\n      new Promise(resolve => {\n        /** @type {import(\"http\").Server} */\n        this.server.listen(listenOptions, () => {\n          resolve();\n        });\n      })\n    );\n    if (this.options.ipc) {\n      // chmod 666 (rw rw rw)\n      const READ_WRITE = 438;\n      await fs.promises.chmod( /** @type {string} */this.options.ipc, READ_WRITE);\n    }\n    if (this.options.webSocketServer) {\n      this.createWebSocketServer();\n    }\n    if (this.options.bonjour) {\n      this.runBonjour();\n    }\n    this.logStatus();\n    if (typeof this.options.onListening === \"function\") {\n      this.options.onListening(this);\n    }\n  }\n\n  /**\n   * @param {(err?: Error) => void} [callback]\n   */\n  startCallback(callback = () => {}) {\n    this.start().then(() => callback(), callback).catch(callback);\n  }\n\n  /**\n   * @returns {Promise<void>}\n   */\n  async stop() {\n    if (this.bonjour) {\n      await (/** @type {Promise<void>} */\n        new Promise(resolve => {\n          this.stopBonjour(() => {\n            resolve();\n          });\n        })\n      );\n    }\n    this.webSocketProxies = [];\n    await Promise.all(this.staticWatchers.map(watcher => watcher.close()));\n    this.staticWatchers = [];\n    if (this.webSocketServer) {\n      await (/** @type {Promise<void>} */\n        new Promise(resolve => {\n          /** @type {WebSocketServerImplementation} */\n          this.webSocketServer.implementation.close(() => {\n            this.webSocketServer = null;\n            resolve();\n          });\n          for (const client of /** @type {WebSocketServerImplementation} */this.webSocketServer.clients) {\n            client.terminate();\n          }\n\n          /** @type {WebSocketServerImplementation} */\n          this.webSocketServer.clients = [];\n        })\n      );\n    }\n    if (this.server) {\n      await (/** @type {Promise<void>} */\n        new Promise(resolve => {\n          /** @type {import(\"http\").Server} */\n          this.server.close(() => {\n            this.server = null;\n            resolve();\n          });\n          for (const socket of this.sockets) {\n            socket.destroy();\n          }\n          this.sockets = [];\n        })\n      );\n      if (this.middleware) {\n        await (/** @type {Promise<void>} */\n          new Promise((resolve, reject) => {\n            /** @type {import(\"webpack-dev-middleware\").API<Request, Response>}*/\n            this.middleware.close(error => {\n              if (error) {\n                reject(error);\n                return;\n              }\n              resolve();\n            });\n          })\n        );\n        this.middleware = null;\n      }\n    }\n\n    // We add listeners to signals when creating a new Server instance\n    // So ensure they are removed to prevent EventEmitter memory leak warnings\n    for (const item of this.listeners) {\n      process.removeListener(item.name, item.listener);\n    }\n  }\n\n  /**\n   * @param {(err?: Error) => void} [callback]\n   */\n  stopCallback(callback = () => {}) {\n    this.stop().then(() => callback(), callback).catch(callback);\n  }\n\n  // TODO remove in the next major release\n  /**\n   * @param {Port} port\n   * @param {Host} hostname\n   * @param {(err?: Error) => void} fn\n   * @returns {void}\n   */\n  listen(port, hostname, fn) {\n    util.deprecate(() => {}, \"'listen' is deprecated. Please use the async 'start' or 'startCallback' method.\", \"DEP_WEBPACK_DEV_SERVER_LISTEN\")();\n    if (typeof port === \"function\") {\n      fn = port;\n    }\n    if (typeof port !== \"undefined\" && typeof this.options.port !== \"undefined\" && port !== this.options.port) {\n      this.options.port = port;\n      this.logger.warn('The \"port\" specified in options is different from the port passed as an argument. Will be used from arguments.');\n    }\n    if (!this.options.port) {\n      this.options.port = port;\n    }\n    if (typeof hostname !== \"undefined\" && typeof this.options.host !== \"undefined\" && hostname !== this.options.host) {\n      this.options.host = hostname;\n      this.logger.warn('The \"host\" specified in options is different from the host passed as an argument. Will be used from arguments.');\n    }\n    if (!this.options.host) {\n      this.options.host = hostname;\n    }\n    this.start().then(() => {\n      if (fn) {\n        fn.call(this.server);\n      }\n    }).catch(error => {\n      // Nothing\n      if (fn) {\n        fn.call(this.server, error);\n      }\n    });\n  }\n\n  /**\n   * @param {(err?: Error) => void} [callback]\n   * @returns {void}\n   */\n  // TODO remove in the next major release\n  close(callback) {\n    util.deprecate(() => {}, \"'close' is deprecated. Please use the async 'stop' or 'stopCallback' method.\", \"DEP_WEBPACK_DEV_SERVER_CLOSE\")();\n    this.stop().then(() => {\n      if (callback) {\n        callback();\n      }\n    }).catch(error => {\n      if (callback) {\n        callback(error);\n      }\n    });\n  }\n}\nmodule.exports = Server;","map":{"version":3,"names":["require","os","path","url","util","fs","ipaddr","defaultGateway","express","validate","schema","process","env","WEBPACK_SERVE","Server","constructor","options","compiler","hooks","deprecate","name","baseDataPath","logger","getInfrastructureLogger","staticWatchers","listeners","webSocketProxies","sockets","currentHash","undefined","cli","getArguments","processArguments","DEFAULT_STATS","all","hash","warnings","errors","errorDetails","isAbsoluteURL","URL","test","findIp","gateway","gatewayIp","parse","addresses","Object","values","networkInterfaces","cidr","net","parseCIDR","kind","match","toString","internalIP","family","internalIPSync","sync","getHostname","hostname","getFreePort","port","host","pRetry","getPort","basePort","WEBPACK_DEV_SERVER_BASE_PORT","parseInt","defaultPortRetry","WEBPACK_DEV_SERVER_PORT_RETRY","retries","findCacheDir","cwd","dir","statSync","join","isFile","e","parent","dirname","resolve","versions","pnp","isWebTarget","externalsPresets","web","conditionNames","includes","webTargets","Array","isArray","target","some","r","addAdditionalEntries","additionalEntries","client","webSocketURLStr","webSocketServer","webSocketURL","searchParams","URLSearchParams","protocol","server","type","set","username","password","isSockJSType","Number","String","pathname","prefix","logging","progress","overlay","JSON","stringify","reconnect","hot","liveReload","push","webpack","EntryPlugin","additionalEntry","context","apply","prependEntry","originalEntry","newAdditionalEntries","Promise","then","entry","clone","keys","forEach","key","entryDescription","entriesClone","slice","concat","newEntry","entryOption","call","getCompilerOptions","compilers","length","compilerWithDevServer","find","config","devServer","compilerWithWebPreset","normalizeOptions","compilerOptions","compilerWatchOptions","watchOptions","getWatchOptions","getPolling","usePolling","poll","Boolean","getInterval","interval","rest","ignoreInitial","persistent","followSymlinks","atomic","alwaysStat","ignorePermissionErrors","ignored","getStaticItem","optionsForStatic","getDefaultStaticOptions","directory","staticOptions","publicPath","serveIndex","icons","watch","item","def","Error","allowedHosts","bonjour","parsedURL","Infinity","infrastructureLogging","level","compress","devMiddleware","historyApiFallback","isHTTPs","https","isSPDY","http2","spdy","protocols","requestCert","httpsProperties","property","value","readFile","Buffer","isBuffer","stats","lstatSync","realpathSync","error","readFileSync","map","fakeCert","cert","certificateDir","certificatePath","certificateExists","certificate","promises","stat","certificateTtl","certificateStat","now","Date","ctime","promisify","rimraf","del","info","selfsigned","attributes","pems","generate","algorithm","days","keySize","extensions","cA","keyCertSign","digitalSignature","nonRepudiation","keyEncipherment","dataEncipherment","serverAuth","clientAuth","codeSigning","timeStamping","altNames","ip","mkdir","recursive","writeFile","private","encoding","cacert","ca","warn","ipc","isWindows","platform","pipePrefix","tmpdir","pipeName","magicHtml","defaultOpenOptions","wait","getOpenItemsFromObject","normalizedOptions","app","normalizedTarget","singleTarget","open","result","onAfterSetupMiddleware","onBeforeSetupMiddleware","proxy","prototype","hasOwnProperty","proxyOptions","correctedContext","replace","getLogLevelForProxy","logLevel","logProvider","setupExitSignals","static","watchFiles","paths","defaultWebSocketServerType","defaultWebSocketServerOptions","getClientTransport","clientImplementation","clientImplementationFound","isKnownWebSocketServerImplementation","clientTransport","webSocketTransport","getServerTransport","implementation","implementationFound","setupProgressPlugin","ProgressPlugin","percent","msg","addInfo","pluginName","Math","floor","sendMessage","clients","emit","initialize","ProvidePlugin","__webpack_dev_server_client__","plugins","HMRPluginExists","p","HotModuleReplacementPlugin","plugin","setupHooks","setupApp","setupHostHeaderCheck","setupDevMiddleware","setupBuiltInRoutes","setupWatchFiles","setupWatchStaticFiles","setupMiddlewares","createServer","signals","needForceShutdown","signal","listener","exit","stopCallback","close","on","webSocketProxy","upgrade","getStats","statsObj","warningsFilter","toJson","invalid","tap","done","sendStats","req","res","next","checkHeader","headers","send","webpackDevMiddleware","middleware","get","setHeader","clientPath","__dirname","sendFile","_req","invalidate","end","fileName","query","launchEditor","waitUntilValid","write","statsForPrint","children","index","asset","assets","assetName","assetURL","staticOption","middlewares","compression","setHeaders","bind","createProxyMiddleware","getProxyMiddleware","proxyConfig","router","proxyConfigOrCallback","proxyMiddleware","ws","handler","newProxyConfig","isByPassFuncDefined","bypass","bypassUrl","connectHistoryApiFallback","verbose","log","method","serveMagicHtml","statusCode","use","socket","once","splice","indexOf","createWebSocketServer","request","openBrowser","defaultOpenTarget","openTarget","catch","arguments","runBonjour","Bonjour","publish","subtypes","stopBonjour","callback","unpublishAll","destroy","logStatus","isColorSupported","cyan","red","getColorsOption","colorsEnabled","colors","useColor","address","prettyPrintURL","newHostname","format","localhost","loopbackIPv4","loopbackIPv6","networkUrlIPv4","networkUrlIPv6","isIP","parsedIP","range","networkIPv4","networkIPv6","isIPv4MappedAddress","toIPv4Address","loopbacks","bonjourProtocol","allHeaders","header","headerToCheck","hostHeader","isValidHostname","IPv4","isValid","IPv6","endsWith","hostIdx","allowedHost","substring","data","params","readyState","_path","filename","getFilenameFromUrl","outputFileSystem","queries","_parsedUrl","search","responsePage","force","shouldEmit","hasErrors","preventReloading","watchPath","chokidar","watcher","start","reject","Socket","code","unlinkSync","connect","listenOptions","listen","READ_WRITE","chmod","onListening","startCallback","stop","terminate","removeListener","fn","module","exports"],"sources":["/home/teresol/Documents/FrontEnd/ResturantApp/node_modules/webpack-dev-server/lib/Server.js"],"sourcesContent":["\"use strict\";\n\nconst os = require(\"os\");\nconst path = require(\"path\");\nconst url = require(\"url\");\nconst util = require(\"util\");\nconst fs = require(\"graceful-fs\");\nconst ipaddr = require(\"ipaddr.js\");\nconst defaultGateway = require(\"default-gateway\");\nconst express = require(\"express\");\nconst { validate } = require(\"schema-utils\");\nconst schema = require(\"./options.json\");\n\n/** @typedef {import(\"schema-utils/declarations/validate\").Schema} Schema */\n/** @typedef {import(\"webpack\").Compiler} Compiler */\n/** @typedef {import(\"webpack\").MultiCompiler} MultiCompiler */\n/** @typedef {import(\"webpack\").Configuration} WebpackConfiguration */\n/** @typedef {import(\"webpack\").StatsOptions} StatsOptions */\n/** @typedef {import(\"webpack\").StatsCompilation} StatsCompilation */\n/** @typedef {import(\"webpack\").Stats} Stats */\n/** @typedef {import(\"webpack\").MultiStats} MultiStats */\n/** @typedef {import(\"os\").NetworkInterfaceInfo} NetworkInterfaceInfo */\n/** @typedef {import(\"express\").Request} Request */\n/** @typedef {import(\"express\").Response} Response */\n/** @typedef {import(\"express\").NextFunction} NextFunction */\n/** @typedef {import(\"express\").RequestHandler} ExpressRequestHandler */\n/** @typedef {import(\"express\").ErrorRequestHandler} ExpressErrorRequestHandler */\n/** @typedef {import(\"chokidar\").WatchOptions} WatchOptions */\n/** @typedef {import(\"chokidar\").FSWatcher} FSWatcher */\n/** @typedef {import(\"connect-history-api-fallback\").Options} ConnectHistoryApiFallbackOptions */\n/** @typedef {import(\"bonjour-service\").Bonjour} Bonjour */\n/** @typedef {import(\"bonjour-service\").Service} BonjourOptions */\n/** @typedef {import(\"http-proxy-middleware\").RequestHandler} RequestHandler */\n/** @typedef {import(\"http-proxy-middleware\").Options} HttpProxyMiddlewareOptions */\n/** @typedef {import(\"http-proxy-middleware\").Filter} HttpProxyMiddlewareOptionsFilter */\n/** @typedef {import(\"serve-index\").Options} ServeIndexOptions */\n/** @typedef {import(\"serve-static\").ServeStaticOptions} ServeStaticOptions */\n/** @typedef {import(\"ipaddr.js\").IPv4} IPv4 */\n/** @typedef {import(\"ipaddr.js\").IPv6} IPv6 */\n/** @typedef {import(\"net\").Socket} Socket */\n/** @typedef {import(\"http\").IncomingMessage} IncomingMessage */\n/** @typedef {import(\"open\").Options} OpenOptions */\n\n/** @typedef {import(\"https\").ServerOptions & { spdy?: { plain?: boolean | undefined, ssl?: boolean | undefined, 'x-forwarded-for'?: string | undefined, protocol?: string | undefined, protocols?: string[] | undefined }}} ServerOptions */\n\n/**\n * @template Request, Response\n * @typedef {import(\"webpack-dev-middleware\").Options<Request, Response>} DevMiddlewareOptions\n */\n\n/**\n * @template Request, Response\n * @typedef {import(\"webpack-dev-middleware\").Context<Request, Response>} DevMiddlewareContext\n */\n\n/**\n * @typedef {\"local-ip\" | \"local-ipv4\" | \"local-ipv6\" | string} Host\n */\n\n/**\n * @typedef {number | string | \"auto\"} Port\n */\n\n/**\n * @typedef {Object} WatchFiles\n * @property {string | string[]} paths\n * @property {WatchOptions & { aggregateTimeout?: number, ignored?: WatchOptions[\"ignored\"], poll?: number | boolean }} [options]\n */\n\n/**\n * @typedef {Object} Static\n * @property {string} [directory]\n * @property {string | string[]} [publicPath]\n * @property {boolean | ServeIndexOptions} [serveIndex]\n * @property {ServeStaticOptions} [staticOptions]\n * @property {boolean | WatchOptions & { aggregateTimeout?: number, ignored?: WatchOptions[\"ignored\"], poll?: number | boolean }} [watch]\n */\n\n/**\n * @typedef {Object} NormalizedStatic\n * @property {string} directory\n * @property {string[]} publicPath\n * @property {false | ServeIndexOptions} serveIndex\n * @property {ServeStaticOptions} staticOptions\n * @property {false | WatchOptions} watch\n */\n\n/**\n * @typedef {Object} ServerConfiguration\n * @property {\"http\" | \"https\" | \"spdy\" | string} [type]\n * @property {ServerOptions} [options]\n */\n\n/**\n * @typedef {Object} WebSocketServerConfiguration\n * @property {\"sockjs\" | \"ws\" | string | Function} [type]\n * @property {Record<string, any>} [options]\n */\n\n/**\n * @typedef {(import(\"ws\").WebSocket | import(\"sockjs\").Connection & { send: import(\"ws\").WebSocket[\"send\"], terminate: import(\"ws\").WebSocket[\"terminate\"], ping: import(\"ws\").WebSocket[\"ping\"] }) & { isAlive?: boolean }} ClientConnection\n */\n\n/**\n * @typedef {import(\"ws\").WebSocketServer | import(\"sockjs\").Server & { close: import(\"ws\").WebSocketServer[\"close\"] }} WebSocketServer\n */\n\n/**\n * @typedef {{ implementation: WebSocketServer, clients: ClientConnection[] }} WebSocketServerImplementation\n */\n\n/**\n * @callback ByPass\n * @param {Request} req\n * @param {Response} res\n * @param {ProxyConfigArrayItem} proxyConfig\n */\n\n/**\n * @typedef {{ path?: HttpProxyMiddlewareOptionsFilter | undefined, context?: HttpProxyMiddlewareOptionsFilter | undefined } & { bypass?: ByPass } & HttpProxyMiddlewareOptions } ProxyConfigArrayItem\n */\n\n/**\n * @typedef {(ProxyConfigArrayItem | ((req?: Request | undefined, res?: Response | undefined, next?: NextFunction | undefined) => ProxyConfigArrayItem))[]} ProxyConfigArray\n */\n\n/**\n * @typedef {{ [url: string]: string | ProxyConfigArrayItem }} ProxyConfigMap\n */\n\n/**\n * @typedef {Object} OpenApp\n * @property {string} [name]\n * @property {string[]} [arguments]\n */\n\n/**\n * @typedef {Object} Open\n * @property {string | string[] | OpenApp} [app]\n * @property {string | string[]} [target]\n */\n\n/**\n * @typedef {Object} NormalizedOpen\n * @property {string} target\n * @property {import(\"open\").Options} options\n */\n\n/**\n * @typedef {Object} WebSocketURL\n * @property {string} [hostname]\n * @property {string} [password]\n * @property {string} [pathname]\n * @property {number | string} [port]\n * @property {string} [protocol]\n * @property {string} [username]\n */\n\n/**\n * @typedef {Object} ClientConfiguration\n * @property {\"log\" | \"info\" | \"warn\" | \"error\" | \"none\" | \"verbose\"} [logging]\n * @property {boolean  | { warnings?: boolean, errors?: boolean }} [overlay]\n * @property {boolean} [progress]\n * @property {boolean | number} [reconnect]\n * @property {\"ws\" | \"sockjs\" | string} [webSocketTransport]\n * @property {string | WebSocketURL} [webSocketURL]\n */\n\n/**\n * @typedef {Array<{ key: string; value: string }> | Record<string, string | string[]>} Headers\n */\n\n/**\n * @typedef {{ name?: string, path?: string, middleware: ExpressRequestHandler | ExpressErrorRequestHandler } | ExpressRequestHandler | ExpressErrorRequestHandler} Middleware\n */\n\n/**\n * @typedef {Object} Configuration\n * @property {boolean | string} [ipc]\n * @property {Host} [host]\n * @property {Port} [port]\n * @property {boolean | \"only\"} [hot]\n * @property {boolean} [liveReload]\n * @property {DevMiddlewareOptions<Request, Response>} [devMiddleware]\n * @property {boolean} [compress]\n * @property {boolean} [magicHtml]\n * @property {\"auto\" | \"all\" | string | string[]} [allowedHosts]\n * @property {boolean | ConnectHistoryApiFallbackOptions} [historyApiFallback]\n * @property {boolean} [setupExitSignals]\n * @property {boolean | Record<string, never> | BonjourOptions} [bonjour]\n * @property {string | string[] | WatchFiles | Array<string | WatchFiles>} [watchFiles]\n * @property {boolean | string | Static | Array<string | Static>} [static]\n * @property {boolean | ServerOptions} [https]\n * @property {boolean} [http2]\n * @property {\"http\" | \"https\" | \"spdy\" | string | ServerConfiguration} [server]\n * @property {boolean | \"sockjs\" | \"ws\" | string | WebSocketServerConfiguration} [webSocketServer]\n * @property {ProxyConfigMap | ProxyConfigArrayItem | ProxyConfigArray} [proxy]\n * @property {boolean | string | Open | Array<string | Open>} [open]\n * @property {boolean} [setupExitSignals]\n * @property {boolean | ClientConfiguration} [client]\n * @property {Headers | ((req: Request, res: Response, context: DevMiddlewareContext<Request, Response>) => Headers)} [headers]\n * @property {(devServer: Server) => void} [onAfterSetupMiddleware]\n * @property {(devServer: Server) => void} [onBeforeSetupMiddleware]\n * @property {(devServer: Server) => void} [onListening]\n * @property {(middlewares: Middleware[], devServer: Server) => Middleware[]} [setupMiddlewares]\n */\n\nif (!process.env.WEBPACK_SERVE) {\n  // TODO fix me in the next major release\n  // @ts-ignore\n  process.env.WEBPACK_SERVE = true;\n}\n\nclass Server {\n  /**\n   * @param {Configuration | Compiler | MultiCompiler} options\n   * @param {Compiler | MultiCompiler | Configuration} compiler\n   */\n  constructor(options = {}, compiler) {\n    // TODO: remove this after plugin support is published\n    if (/** @type {Compiler | MultiCompiler} */ (options).hooks) {\n      util.deprecate(\n        () => {},\n        \"Using 'compiler' as the first argument is deprecated. Please use 'options' as the first argument and 'compiler' as the second argument.\",\n        \"DEP_WEBPACK_DEV_SERVER_CONSTRUCTOR\"\n      )();\n\n      [options = {}, compiler] = [compiler, options];\n    }\n\n    validate(/** @type {Schema} */ (schema), options, {\n      name: \"Dev Server\",\n      baseDataPath: \"options\",\n    });\n\n    this.compiler = /** @type {Compiler | MultiCompiler} */ (compiler);\n    /**\n     * @type {ReturnType<Compiler[\"getInfrastructureLogger\"]>}\n     * */\n    this.logger = this.compiler.getInfrastructureLogger(\"webpack-dev-server\");\n    this.options = /** @type {Configuration} */ (options);\n    /**\n     * @type {FSWatcher[]}\n     */\n    this.staticWatchers = [];\n    /**\n     * @private\n     * @type {{ name: string | symbol, listener: (...args: any[]) => void}[] }}\n     */\n    this.listeners = [];\n    // Keep track of websocket proxies for external websocket upgrade.\n    /**\n     * @private\n     * @type {RequestHandler[]}\n     */\n    this.webSocketProxies = [];\n    /**\n     * @type {Socket[]}\n     */\n    this.sockets = [];\n    /**\n     * @private\n     * @type {string | undefined}\n     */\n    // eslint-disable-next-line no-undefined\n    this.currentHash = undefined;\n  }\n\n  // TODO compatibility with webpack v4, remove it after drop\n  static get cli() {\n    return {\n      get getArguments() {\n        return () => require(\"../bin/cli-flags\");\n      },\n      get processArguments() {\n        return require(\"../bin/process-arguments\");\n      },\n    };\n  }\n\n  static get schema() {\n    return schema;\n  }\n\n  /**\n   * @private\n   * @returns {StatsOptions}\n   * @constructor\n   */\n  static get DEFAULT_STATS() {\n    return {\n      all: false,\n      hash: true,\n      warnings: true,\n      errors: true,\n      errorDetails: false,\n    };\n  }\n\n  /**\n   * @param {string} URL\n   * @returns {boolean}\n   */\n  static isAbsoluteURL(URL) {\n    // Don't match Windows paths `c:\\`\n    if (/^[a-zA-Z]:\\\\/.test(URL)) {\n      return false;\n    }\n\n    // Scheme: https://tools.ietf.org/html/rfc3986#section-3.1\n    // Absolute URL: https://tools.ietf.org/html/rfc3986#section-4.3\n    return /^[a-zA-Z][a-zA-Z\\d+\\-.]*:/.test(URL);\n  }\n\n  /**\n   * @param {string} gateway\n   * @returns {string | undefined}\n   */\n  static findIp(gateway) {\n    const gatewayIp = ipaddr.parse(gateway);\n\n    // Look for the matching interface in all local interfaces.\n    for (const addresses of Object.values(os.networkInterfaces())) {\n      for (const { cidr } of /** @type {NetworkInterfaceInfo[]} */ (\n        addresses\n      )) {\n        const net = ipaddr.parseCIDR(/** @type {string} */ (cidr));\n\n        if (\n          net[0] &&\n          net[0].kind() === gatewayIp.kind() &&\n          gatewayIp.match(net)\n        ) {\n          return net[0].toString();\n        }\n      }\n    }\n  }\n\n  /**\n   * @param {\"v4\" | \"v6\"} family\n   * @returns {Promise<string | undefined>}\n   */\n  static async internalIP(family) {\n    try {\n      const { gateway } = await defaultGateway[family]();\n      return Server.findIp(gateway);\n    } catch {\n      // ignore\n    }\n  }\n\n  /**\n   * @param {\"v4\" | \"v6\"} family\n   * @returns {string | undefined}\n   */\n  static internalIPSync(family) {\n    try {\n      const { gateway } = defaultGateway[family].sync();\n      return Server.findIp(gateway);\n    } catch {\n      // ignore\n    }\n  }\n\n  /**\n   * @param {Host} hostname\n   * @returns {Promise<string>}\n   */\n  static async getHostname(hostname) {\n    if (hostname === \"local-ip\") {\n      return (\n        (await Server.internalIP(\"v4\")) ||\n        (await Server.internalIP(\"v6\")) ||\n        \"0.0.0.0\"\n      );\n    } else if (hostname === \"local-ipv4\") {\n      return (await Server.internalIP(\"v4\")) || \"0.0.0.0\";\n    } else if (hostname === \"local-ipv6\") {\n      return (await Server.internalIP(\"v6\")) || \"::\";\n    }\n\n    return hostname;\n  }\n\n  /**\n   * @param {Port} port\n   * @param {string} host\n   * @returns {Promise<number | string>}\n   */\n  static async getFreePort(port, host) {\n    if (typeof port !== \"undefined\" && port !== null && port !== \"auto\") {\n      return port;\n    }\n\n    const pRetry = require(\"p-retry\");\n    const getPort = require(\"./getPort\");\n    const basePort =\n      typeof process.env.WEBPACK_DEV_SERVER_BASE_PORT !== \"undefined\"\n        ? parseInt(process.env.WEBPACK_DEV_SERVER_BASE_PORT, 10)\n        : 8080;\n\n    // Try to find unused port and listen on it for 3 times,\n    // if port is not specified in options.\n    const defaultPortRetry =\n      typeof process.env.WEBPACK_DEV_SERVER_PORT_RETRY !== \"undefined\"\n        ? parseInt(process.env.WEBPACK_DEV_SERVER_PORT_RETRY, 10)\n        : 3;\n\n    return pRetry(() => getPort(basePort, host), {\n      retries: defaultPortRetry,\n    });\n  }\n\n  /**\n   * @returns {string}\n   */\n  static findCacheDir() {\n    const cwd = process.cwd();\n\n    /**\n     * @type {string | undefined}\n     */\n    let dir = cwd;\n\n    for (;;) {\n      try {\n        if (fs.statSync(path.join(dir, \"package.json\")).isFile()) break;\n        // eslint-disable-next-line no-empty\n      } catch (e) {}\n\n      const parent = path.dirname(dir);\n\n      if (dir === parent) {\n        // eslint-disable-next-line no-undefined\n        dir = undefined;\n        break;\n      }\n\n      dir = parent;\n    }\n\n    if (!dir) {\n      return path.resolve(cwd, \".cache/webpack-dev-server\");\n    } else if (process.versions.pnp === \"1\") {\n      return path.resolve(dir, \".pnp/.cache/webpack-dev-server\");\n    } else if (process.versions.pnp === \"3\") {\n      return path.resolve(dir, \".yarn/.cache/webpack-dev-server\");\n    }\n\n    return path.resolve(dir, \"node_modules/.cache/webpack-dev-server\");\n  }\n\n  /**\n   * @private\n   * @param {Compiler} compiler\n   * @returns bool\n   */\n  static isWebTarget(compiler) {\n    // TODO improve for the next major version - we should store `web` and other targets in `compiler.options.environment`\n    if (\n      compiler.options.externalsPresets &&\n      compiler.options.externalsPresets.web\n    ) {\n      return true;\n    }\n\n    if (\n      compiler.options.resolve.conditionNames &&\n      compiler.options.resolve.conditionNames.includes(\"browser\")\n    ) {\n      return true;\n    }\n\n    const webTargets = [\n      \"web\",\n      \"webworker\",\n      \"electron-preload\",\n      \"electron-renderer\",\n      \"node-webkit\",\n      // eslint-disable-next-line no-undefined\n      undefined,\n      null,\n    ];\n\n    if (Array.isArray(compiler.options.target)) {\n      return compiler.options.target.some((r) => webTargets.includes(r));\n    }\n\n    return webTargets.includes(/** @type {string} */ (compiler.options.target));\n  }\n\n  /**\n   * @private\n   * @param {Compiler} compiler\n   */\n  addAdditionalEntries(compiler) {\n    /**\n     * @type {string[]}\n     */\n    const additionalEntries = [];\n    const isWebTarget = Server.isWebTarget(compiler);\n\n    // TODO maybe empty client\n    if (this.options.client && isWebTarget) {\n      let webSocketURLStr = \"\";\n\n      if (this.options.webSocketServer) {\n        const webSocketURL =\n          /** @type {WebSocketURL} */\n          (\n            /** @type {ClientConfiguration} */\n            (this.options.client).webSocketURL\n          );\n        const webSocketServer =\n          /** @type {{ type: WebSocketServerConfiguration[\"type\"], options: NonNullable<WebSocketServerConfiguration[\"options\"]> }} */\n          (this.options.webSocketServer);\n        const searchParams = new URLSearchParams();\n\n        /** @type {string} */\n        let protocol;\n\n        // We are proxying dev server and need to specify custom `hostname`\n        if (typeof webSocketURL.protocol !== \"undefined\") {\n          protocol = webSocketURL.protocol;\n        } else {\n          protocol =\n            /** @type {ServerConfiguration} */\n            (this.options.server).type === \"http\" ? \"ws:\" : \"wss:\";\n        }\n\n        searchParams.set(\"protocol\", protocol);\n\n        if (typeof webSocketURL.username !== \"undefined\") {\n          searchParams.set(\"username\", webSocketURL.username);\n        }\n\n        if (typeof webSocketURL.password !== \"undefined\") {\n          searchParams.set(\"password\", webSocketURL.password);\n        }\n\n        /** @type {string} */\n        let hostname;\n\n        // SockJS is not supported server mode, so `hostname` and `port` can't specified, let's ignore them\n        // TODO show warning about this\n        const isSockJSType = webSocketServer.type === \"sockjs\";\n\n        // We are proxying dev server and need to specify custom `hostname`\n        if (typeof webSocketURL.hostname !== \"undefined\") {\n          hostname = webSocketURL.hostname;\n        }\n        // Web socket server works on custom `hostname`, only for `ws` because `sock-js` is not support custom `hostname`\n        else if (\n          typeof webSocketServer.options.host !== \"undefined\" &&\n          !isSockJSType\n        ) {\n          hostname = webSocketServer.options.host;\n        }\n        // The `host` option is specified\n        else if (typeof this.options.host !== \"undefined\") {\n          hostname = this.options.host;\n        }\n        // The `port` option is not specified\n        else {\n          hostname = \"0.0.0.0\";\n        }\n\n        searchParams.set(\"hostname\", hostname);\n\n        /** @type {number | string} */\n        let port;\n\n        // We are proxying dev server and need to specify custom `port`\n        if (typeof webSocketURL.port !== \"undefined\") {\n          port = webSocketURL.port;\n        }\n        // Web socket server works on custom `port`, only for `ws` because `sock-js` is not support custom `port`\n        else if (\n          typeof webSocketServer.options.port !== \"undefined\" &&\n          !isSockJSType\n        ) {\n          port = webSocketServer.options.port;\n        }\n        // The `port` option is specified\n        else if (typeof this.options.port === \"number\") {\n          port = this.options.port;\n        }\n        // The `port` option is specified using `string`\n        else if (\n          typeof this.options.port === \"string\" &&\n          this.options.port !== \"auto\"\n        ) {\n          port = Number(this.options.port);\n        }\n        // The `port` option is not specified or set to `auto`\n        else {\n          port = \"0\";\n        }\n\n        searchParams.set(\"port\", String(port));\n\n        /** @type {string} */\n        let pathname = \"\";\n\n        // We are proxying dev server and need to specify custom `pathname`\n        if (typeof webSocketURL.pathname !== \"undefined\") {\n          pathname = webSocketURL.pathname;\n        }\n        // Web socket server works on custom `path`\n        else if (\n          typeof webSocketServer.options.prefix !== \"undefined\" ||\n          typeof webSocketServer.options.path !== \"undefined\"\n        ) {\n          pathname =\n            webSocketServer.options.prefix || webSocketServer.options.path;\n        }\n\n        searchParams.set(\"pathname\", pathname);\n\n        const client = /** @type {ClientConfiguration} */ (this.options.client);\n\n        if (typeof client.logging !== \"undefined\") {\n          searchParams.set(\"logging\", client.logging);\n        }\n\n        if (typeof client.progress !== \"undefined\") {\n          searchParams.set(\"progress\", String(client.progress));\n        }\n\n        if (typeof client.overlay !== \"undefined\") {\n          searchParams.set(\n            \"overlay\",\n            typeof client.overlay === \"boolean\"\n              ? String(client.overlay)\n              : JSON.stringify(client.overlay)\n          );\n        }\n\n        if (typeof client.reconnect !== \"undefined\") {\n          searchParams.set(\n            \"reconnect\",\n            typeof client.reconnect === \"number\"\n              ? String(client.reconnect)\n              : \"10\"\n          );\n        }\n\n        if (typeof this.options.hot !== \"undefined\") {\n          searchParams.set(\"hot\", String(this.options.hot));\n        }\n\n        if (typeof this.options.liveReload !== \"undefined\") {\n          searchParams.set(\"live-reload\", String(this.options.liveReload));\n        }\n\n        webSocketURLStr = searchParams.toString();\n      }\n\n      additionalEntries.push(\n        `${require.resolve(\"../client/index.js\")}?${webSocketURLStr}`\n      );\n    }\n\n    if (this.options.hot === \"only\") {\n      additionalEntries.push(require.resolve(\"webpack/hot/only-dev-server\"));\n    } else if (this.options.hot) {\n      additionalEntries.push(require.resolve(\"webpack/hot/dev-server\"));\n    }\n\n    const webpack = compiler.webpack || require(\"webpack\");\n\n    // use a hook to add entries if available\n    if (typeof webpack.EntryPlugin !== \"undefined\") {\n      for (const additionalEntry of additionalEntries) {\n        new webpack.EntryPlugin(compiler.context, additionalEntry, {\n          // eslint-disable-next-line no-undefined\n          name: undefined,\n        }).apply(compiler);\n      }\n    }\n    // TODO remove after drop webpack v4 support\n    else {\n      /**\n       * prependEntry Method for webpack 4\n       * @param {any} originalEntry\n       * @param {any} newAdditionalEntries\n       * @returns {any}\n       */\n      const prependEntry = (originalEntry, newAdditionalEntries) => {\n        if (typeof originalEntry === \"function\") {\n          return () =>\n            Promise.resolve(originalEntry()).then((entry) =>\n              prependEntry(entry, newAdditionalEntries)\n            );\n        }\n\n        if (\n          typeof originalEntry === \"object\" &&\n          !Array.isArray(originalEntry)\n        ) {\n          /** @type {Object<string,string>} */\n          const clone = {};\n\n          Object.keys(originalEntry).forEach((key) => {\n            // entry[key] should be a string here\n            const entryDescription = originalEntry[key];\n\n            clone[key] = prependEntry(entryDescription, newAdditionalEntries);\n          });\n\n          return clone;\n        }\n\n        // in this case, entry is a string or an array.\n        // make sure that we do not add duplicates.\n        /** @type {any} */\n        const entriesClone = additionalEntries.slice(0);\n\n        [].concat(originalEntry).forEach((newEntry) => {\n          if (!entriesClone.includes(newEntry)) {\n            entriesClone.push(newEntry);\n          }\n        });\n\n        return entriesClone;\n      };\n\n      compiler.options.entry = prependEntry(\n        compiler.options.entry || \"./src\",\n        additionalEntries\n      );\n      compiler.hooks.entryOption.call(\n        /** @type {string} */ (compiler.options.context),\n        compiler.options.entry\n      );\n    }\n  }\n\n  /**\n   * @private\n   * @returns {Compiler[\"options\"]}\n   */\n  getCompilerOptions() {\n    if (\n      typeof (/** @type {MultiCompiler} */ (this.compiler).compilers) !==\n      \"undefined\"\n    ) {\n      if (/** @type {MultiCompiler} */ (this.compiler).compilers.length === 1) {\n        return (\n          /** @type {MultiCompiler} */\n          (this.compiler).compilers[0].options\n        );\n      }\n\n      // Configuration with the `devServer` options\n      const compilerWithDevServer =\n        /** @type {MultiCompiler} */\n        (this.compiler).compilers.find((config) => config.options.devServer);\n\n      if (compilerWithDevServer) {\n        return compilerWithDevServer.options;\n      }\n\n      // Configuration with `web` preset\n      const compilerWithWebPreset =\n        /** @type {MultiCompiler} */\n        (this.compiler).compilers.find(\n          (config) =>\n            (config.options.externalsPresets &&\n              config.options.externalsPresets.web) ||\n            [\n              \"web\",\n              \"webworker\",\n              \"electron-preload\",\n              \"electron-renderer\",\n              \"node-webkit\",\n              // eslint-disable-next-line no-undefined\n              undefined,\n              null,\n            ].includes(/** @type {string} */ (config.options.target))\n        );\n\n      if (compilerWithWebPreset) {\n        return compilerWithWebPreset.options;\n      }\n\n      // Fallback\n      return /** @type {MultiCompiler} */ (this.compiler).compilers[0].options;\n    }\n\n    return /** @type {Compiler} */ (this.compiler).options;\n  }\n\n  /**\n   * @private\n   * @returns {Promise<void>}\n   */\n  async normalizeOptions() {\n    const { options } = this;\n    const compilerOptions = this.getCompilerOptions();\n    // TODO remove `{}` after drop webpack v4 support\n    const compilerWatchOptions = compilerOptions.watchOptions || {};\n    /**\n     * @param {WatchOptions & { aggregateTimeout?: number, ignored?: WatchOptions[\"ignored\"], poll?: number | boolean }} watchOptions\n     * @returns {WatchOptions}\n     */\n    const getWatchOptions = (watchOptions = {}) => {\n      const getPolling = () => {\n        if (typeof watchOptions.usePolling !== \"undefined\") {\n          return watchOptions.usePolling;\n        }\n\n        if (typeof watchOptions.poll !== \"undefined\") {\n          return Boolean(watchOptions.poll);\n        }\n\n        if (typeof compilerWatchOptions.poll !== \"undefined\") {\n          return Boolean(compilerWatchOptions.poll);\n        }\n\n        return false;\n      };\n      const getInterval = () => {\n        if (typeof watchOptions.interval !== \"undefined\") {\n          return watchOptions.interval;\n        }\n\n        if (typeof watchOptions.poll === \"number\") {\n          return watchOptions.poll;\n        }\n\n        if (typeof compilerWatchOptions.poll === \"number\") {\n          return compilerWatchOptions.poll;\n        }\n      };\n\n      const usePolling = getPolling();\n      const interval = getInterval();\n      const { poll, ...rest } = watchOptions;\n\n      return {\n        ignoreInitial: true,\n        persistent: true,\n        followSymlinks: false,\n        atomic: false,\n        alwaysStat: true,\n        ignorePermissionErrors: true,\n        // Respect options from compiler watchOptions\n        usePolling,\n        interval,\n        ignored: watchOptions.ignored,\n        // TODO: we respect these options for all watch options and allow developers to pass them to chokidar, but chokidar doesn't have these options maybe we need revisit that in future\n        ...rest,\n      };\n    };\n    /**\n     * @param {string | Static | undefined} [optionsForStatic]\n     * @returns {NormalizedStatic}\n     */\n    const getStaticItem = (optionsForStatic) => {\n      const getDefaultStaticOptions = () => {\n        return {\n          directory: path.join(process.cwd(), \"public\"),\n          staticOptions: {},\n          publicPath: [\"/\"],\n          serveIndex: { icons: true },\n          watch: getWatchOptions(),\n        };\n      };\n\n      /** @type {NormalizedStatic} */\n      let item;\n\n      if (typeof optionsForStatic === \"undefined\") {\n        item = getDefaultStaticOptions();\n      } else if (typeof optionsForStatic === \"string\") {\n        item = {\n          ...getDefaultStaticOptions(),\n          directory: optionsForStatic,\n        };\n      } else {\n        const def = getDefaultStaticOptions();\n\n        item = {\n          directory:\n            typeof optionsForStatic.directory !== \"undefined\"\n              ? optionsForStatic.directory\n              : def.directory,\n          // TODO: do merge in the next major release\n          staticOptions:\n            typeof optionsForStatic.staticOptions !== \"undefined\"\n              ? optionsForStatic.staticOptions\n              : def.staticOptions,\n          publicPath:\n            // eslint-disable-next-line no-nested-ternary\n            typeof optionsForStatic.publicPath !== \"undefined\"\n              ? Array.isArray(optionsForStatic.publicPath)\n                ? optionsForStatic.publicPath\n                : [optionsForStatic.publicPath]\n              : def.publicPath,\n          // TODO: do merge in the next major release\n          serveIndex:\n            // eslint-disable-next-line no-nested-ternary\n            typeof optionsForStatic.serveIndex !== \"undefined\"\n              ? typeof optionsForStatic.serveIndex === \"boolean\" &&\n                optionsForStatic.serveIndex\n                ? def.serveIndex\n                : optionsForStatic.serveIndex\n              : def.serveIndex,\n          watch:\n            // eslint-disable-next-line no-nested-ternary\n            typeof optionsForStatic.watch !== \"undefined\"\n              ? // eslint-disable-next-line no-nested-ternary\n                typeof optionsForStatic.watch === \"boolean\"\n                ? optionsForStatic.watch\n                  ? def.watch\n                  : false\n                : getWatchOptions(optionsForStatic.watch)\n              : def.watch,\n        };\n      }\n\n      if (Server.isAbsoluteURL(item.directory)) {\n        throw new Error(\"Using a URL as static.directory is not supported\");\n      }\n\n      return item;\n    };\n\n    if (typeof options.allowedHosts === \"undefined\") {\n      // AllowedHosts allows some default hosts picked from `options.host` or `webSocketURL.hostname` and `localhost`\n      options.allowedHosts = \"auto\";\n    }\n    // We store allowedHosts as array when supplied as string\n    else if (\n      typeof options.allowedHosts === \"string\" &&\n      options.allowedHosts !== \"auto\" &&\n      options.allowedHosts !== \"all\"\n    ) {\n      options.allowedHosts = [options.allowedHosts];\n    }\n    // CLI pass options as array, we should normalize them\n    else if (\n      Array.isArray(options.allowedHosts) &&\n      options.allowedHosts.includes(\"all\")\n    ) {\n      options.allowedHosts = \"all\";\n    }\n\n    if (typeof options.bonjour === \"undefined\") {\n      options.bonjour = false;\n    } else if (typeof options.bonjour === \"boolean\") {\n      options.bonjour = options.bonjour ? {} : false;\n    }\n\n    if (\n      typeof options.client === \"undefined\" ||\n      (typeof options.client === \"object\" && options.client !== null)\n    ) {\n      if (!options.client) {\n        options.client = {};\n      }\n\n      if (typeof options.client.webSocketURL === \"undefined\") {\n        options.client.webSocketURL = {};\n      } else if (typeof options.client.webSocketURL === \"string\") {\n        const parsedURL = new URL(options.client.webSocketURL);\n\n        options.client.webSocketURL = {\n          protocol: parsedURL.protocol,\n          hostname: parsedURL.hostname,\n          port: parsedURL.port.length > 0 ? Number(parsedURL.port) : \"\",\n          pathname: parsedURL.pathname,\n          username: parsedURL.username,\n          password: parsedURL.password,\n        };\n      } else if (typeof options.client.webSocketURL.port === \"string\") {\n        options.client.webSocketURL.port = Number(\n          options.client.webSocketURL.port\n        );\n      }\n\n      // Enable client overlay by default\n      if (typeof options.client.overlay === \"undefined\") {\n        options.client.overlay = true;\n      } else if (typeof options.client.overlay !== \"boolean\") {\n        options.client.overlay = {\n          errors: true,\n          warnings: true,\n          ...options.client.overlay,\n        };\n      }\n\n      if (typeof options.client.reconnect === \"undefined\") {\n        options.client.reconnect = 10;\n      } else if (options.client.reconnect === true) {\n        options.client.reconnect = Infinity;\n      } else if (options.client.reconnect === false) {\n        options.client.reconnect = 0;\n      }\n\n      // Respect infrastructureLogging.level\n      if (typeof options.client.logging === \"undefined\") {\n        options.client.logging = compilerOptions.infrastructureLogging\n          ? compilerOptions.infrastructureLogging.level\n          : \"info\";\n      }\n    }\n\n    if (typeof options.compress === \"undefined\") {\n      options.compress = true;\n    }\n\n    if (typeof options.devMiddleware === \"undefined\") {\n      options.devMiddleware = {};\n    }\n\n    // No need to normalize `headers`\n\n    if (typeof options.historyApiFallback === \"undefined\") {\n      options.historyApiFallback = false;\n    } else if (\n      typeof options.historyApiFallback === \"boolean\" &&\n      options.historyApiFallback\n    ) {\n      options.historyApiFallback = {};\n    }\n\n    // No need to normalize `host`\n\n    options.hot =\n      typeof options.hot === \"boolean\" || options.hot === \"only\"\n        ? options.hot\n        : true;\n\n    const isHTTPs = Boolean(options.https);\n    const isSPDY = Boolean(options.http2);\n\n    if (isHTTPs) {\n      // TODO: remove in the next major release\n      util.deprecate(\n        () => {},\n        \"'https' option is deprecated. Please use the 'server' option.\",\n        \"DEP_WEBPACK_DEV_SERVER_HTTPS\"\n      )();\n    }\n\n    if (isSPDY) {\n      // TODO: remove in the next major release\n      util.deprecate(\n        () => {},\n        \"'http2' option is deprecated. Please use the 'server' option.\",\n        \"DEP_WEBPACK_DEV_SERVER_HTTP2\"\n      )();\n    }\n\n    options.server = {\n      type:\n        // eslint-disable-next-line no-nested-ternary\n        typeof options.server === \"string\"\n          ? options.server\n          : // eslint-disable-next-line no-nested-ternary\n          typeof (options.server || {}).type === \"string\"\n          ? /** @type {ServerConfiguration} */ (options.server).type || \"http\"\n          : // eslint-disable-next-line no-nested-ternary\n          isSPDY\n          ? \"spdy\"\n          : isHTTPs\n          ? \"https\"\n          : \"http\",\n      options: {\n        .../** @type {ServerOptions} */ (options.https),\n        .../** @type {ServerConfiguration} */ (options.server || {}).options,\n      },\n    };\n\n    if (\n      options.server.type === \"spdy\" &&\n      typeof (/** @type {ServerOptions} */ (options.server.options).spdy) ===\n        \"undefined\"\n    ) {\n      /** @type {ServerOptions} */\n      (options.server.options).spdy = {\n        protocols: [\"h2\", \"http/1.1\"],\n      };\n    }\n\n    if (options.server.type === \"https\" || options.server.type === \"spdy\") {\n      if (\n        typeof (\n          /** @type {ServerOptions} */ (options.server.options).requestCert\n        ) === \"undefined\"\n      ) {\n        /** @type {ServerOptions} */\n        (options.server.options).requestCert = false;\n      }\n\n      const httpsProperties =\n        /** @type {Array<keyof ServerOptions>} */\n        ([\"cacert\", \"ca\", \"cert\", \"crl\", \"key\", \"pfx\"]);\n\n      for (const property of httpsProperties) {\n        if (\n          typeof (\n            /** @type {ServerOptions} */ (options.server.options)[property]\n          ) === \"undefined\"\n        ) {\n          // eslint-disable-next-line no-continue\n          continue;\n        }\n\n        // @ts-ignore\n        if (property === \"cacert\") {\n          // TODO remove the `cacert` option in favor `ca` in the next major release\n          util.deprecate(\n            () => {},\n            \"The 'cacert' option is deprecated. Please use the 'ca' option.\",\n            \"DEP_WEBPACK_DEV_SERVER_CACERT\"\n          )();\n        }\n\n        /** @type {any} */\n        const value =\n          /** @type {ServerOptions} */\n          (options.server.options)[property];\n        /**\n         * @param {string | Buffer | undefined} item\n         * @returns {string | Buffer | undefined}\n         */\n        const readFile = (item) => {\n          if (\n            Buffer.isBuffer(item) ||\n            (typeof item === \"object\" && item !== null && !Array.isArray(item))\n          ) {\n            return item;\n          }\n\n          if (item) {\n            let stats = null;\n\n            try {\n              stats = fs.lstatSync(fs.realpathSync(item)).isFile();\n            } catch (error) {\n              // Ignore error\n            }\n\n            // It is file\n            return stats ? fs.readFileSync(item) : item;\n          }\n        };\n\n        /** @type {any} */\n        (options.server.options)[property] = Array.isArray(value)\n          ? value.map((item) => readFile(item))\n          : readFile(value);\n      }\n\n      let fakeCert;\n\n      if (\n        !(/** @type {ServerOptions} */ (options.server.options).key) ||\n        !(/** @type {ServerOptions} */ (options.server.options).cert)\n      ) {\n        const certificateDir = Server.findCacheDir();\n        const certificatePath = path.join(certificateDir, \"server.pem\");\n        let certificateExists;\n\n        try {\n          const certificate = await fs.promises.stat(certificatePath);\n          certificateExists = certificate.isFile();\n        } catch {\n          certificateExists = false;\n        }\n\n        if (certificateExists) {\n          const certificateTtl = 1000 * 60 * 60 * 24;\n          const certificateStat = await fs.promises.stat(certificatePath);\n          const now = Number(new Date());\n\n          // cert is more than 30 days old, kill it with fire\n          if ((now - Number(certificateStat.ctime)) / certificateTtl > 30) {\n            const { promisify } = require(\"util\");\n            const rimraf = require(\"rimraf\");\n            const del = promisify(rimraf);\n\n            this.logger.info(\n              \"SSL certificate is more than 30 days old. Removing...\"\n            );\n\n            await del(certificatePath);\n\n            certificateExists = false;\n          }\n        }\n\n        if (!certificateExists) {\n          this.logger.info(\"Generating SSL certificate...\");\n\n          // @ts-ignore\n          const selfsigned = require(\"selfsigned\");\n          const attributes = [{ name: \"commonName\", value: \"localhost\" }];\n          const pems = selfsigned.generate(attributes, {\n            algorithm: \"sha256\",\n            days: 30,\n            keySize: 2048,\n            extensions: [\n              {\n                name: \"basicConstraints\",\n                cA: true,\n              },\n              {\n                name: \"keyUsage\",\n                keyCertSign: true,\n                digitalSignature: true,\n                nonRepudiation: true,\n                keyEncipherment: true,\n                dataEncipherment: true,\n              },\n              {\n                name: \"extKeyUsage\",\n                serverAuth: true,\n                clientAuth: true,\n                codeSigning: true,\n                timeStamping: true,\n              },\n              {\n                name: \"subjectAltName\",\n                altNames: [\n                  {\n                    // type 2 is DNS\n                    type: 2,\n                    value: \"localhost\",\n                  },\n                  {\n                    type: 2,\n                    value: \"localhost.localdomain\",\n                  },\n                  {\n                    type: 2,\n                    value: \"lvh.me\",\n                  },\n                  {\n                    type: 2,\n                    value: \"*.lvh.me\",\n                  },\n                  {\n                    type: 2,\n                    value: \"[::1]\",\n                  },\n                  {\n                    // type 7 is IP\n                    type: 7,\n                    ip: \"127.0.0.1\",\n                  },\n                  {\n                    type: 7,\n                    ip: \"fe80::1\",\n                  },\n                ],\n              },\n            ],\n          });\n\n          await fs.promises.mkdir(certificateDir, { recursive: true });\n\n          await fs.promises.writeFile(\n            certificatePath,\n            pems.private + pems.cert,\n            {\n              encoding: \"utf8\",\n            }\n          );\n        }\n\n        fakeCert = await fs.promises.readFile(certificatePath);\n\n        this.logger.info(`SSL certificate: ${certificatePath}`);\n      }\n\n      if (\n        /** @type {ServerOptions & { cacert?: ServerOptions[\"ca\"] }} */ (\n          options.server.options\n        ).cacert\n      ) {\n        if (/** @type {ServerOptions} */ (options.server.options).ca) {\n          this.logger.warn(\n            \"Do not specify 'ca' and 'cacert' options together, the 'ca' option will be used.\"\n          );\n        } else {\n          /** @type {ServerOptions} */\n          (options.server.options).ca =\n            /** @type {ServerOptions & { cacert?: ServerOptions[\"ca\"] }} */\n            (options.server.options).cacert;\n        }\n\n        delete (\n          /** @type {ServerOptions & { cacert?: ServerOptions[\"ca\"] }} */ (\n            options.server.options\n          ).cacert\n        );\n      }\n\n      /** @type {ServerOptions} */\n      (options.server.options).key =\n        /** @type {ServerOptions} */\n        (options.server.options).key || fakeCert;\n      /** @type {ServerOptions} */\n      (options.server.options).cert =\n        /** @type {ServerOptions} */\n        (options.server.options).cert || fakeCert;\n    }\n\n    if (typeof options.ipc === \"boolean\") {\n      const isWindows = process.platform === \"win32\";\n      const pipePrefix = isWindows ? \"\\\\\\\\.\\\\pipe\\\\\" : os.tmpdir();\n      const pipeName = \"webpack-dev-server.sock\";\n\n      options.ipc = path.join(pipePrefix, pipeName);\n    }\n\n    options.liveReload =\n      typeof options.liveReload !== \"undefined\" ? options.liveReload : true;\n\n    options.magicHtml =\n      typeof options.magicHtml !== \"undefined\" ? options.magicHtml : true;\n\n    // https://github.com/webpack/webpack-dev-server/issues/1990\n    const defaultOpenOptions = { wait: false };\n    /**\n     * @param {any} target\n     * @returns {NormalizedOpen[]}\n     */\n    // TODO: remove --open-app in favor of --open-app-name\n    const getOpenItemsFromObject = ({ target, ...rest }) => {\n      const normalizedOptions = { ...defaultOpenOptions, ...rest };\n\n      if (typeof normalizedOptions.app === \"string\") {\n        normalizedOptions.app = {\n          name: normalizedOptions.app,\n        };\n      }\n\n      const normalizedTarget = typeof target === \"undefined\" ? \"<url>\" : target;\n\n      if (Array.isArray(normalizedTarget)) {\n        return normalizedTarget.map((singleTarget) => {\n          return { target: singleTarget, options: normalizedOptions };\n        });\n      }\n\n      return [{ target: normalizedTarget, options: normalizedOptions }];\n    };\n\n    if (typeof options.open === \"undefined\") {\n      /** @type {NormalizedOpen[]} */\n      (options.open) = [];\n    } else if (typeof options.open === \"boolean\") {\n      /** @type {NormalizedOpen[]} */\n      (options.open) = options.open\n        ? [\n            {\n              target: \"<url>\",\n              options: /** @type {OpenOptions} */ (defaultOpenOptions),\n            },\n          ]\n        : [];\n    } else if (typeof options.open === \"string\") {\n      /** @type {NormalizedOpen[]} */\n      (options.open) = [{ target: options.open, options: defaultOpenOptions }];\n    } else if (Array.isArray(options.open)) {\n      /**\n       * @type {NormalizedOpen[]}\n       */\n      const result = [];\n\n      options.open.forEach((item) => {\n        if (typeof item === \"string\") {\n          result.push({ target: item, options: defaultOpenOptions });\n\n          return;\n        }\n\n        result.push(...getOpenItemsFromObject(item));\n      });\n\n      /** @type {NormalizedOpen[]} */\n      (options.open) = result;\n    } else {\n      /** @type {NormalizedOpen[]} */\n      (options.open) = [...getOpenItemsFromObject(options.open)];\n    }\n\n    if (options.onAfterSetupMiddleware) {\n      // TODO: remove in the next major release\n      util.deprecate(\n        () => {},\n        \"'onAfterSetupMiddleware' option is deprecated. Please use the 'setupMiddlewares' option.\",\n        `DEP_WEBPACK_DEV_SERVER_ON_AFTER_SETUP_MIDDLEWARE`\n      )();\n    }\n\n    if (options.onBeforeSetupMiddleware) {\n      // TODO: remove in the next major release\n      util.deprecate(\n        () => {},\n        \"'onBeforeSetupMiddleware' option is deprecated. Please use the 'setupMiddlewares' option.\",\n        `DEP_WEBPACK_DEV_SERVER_ON_BEFORE_SETUP_MIDDLEWARE`\n      )();\n    }\n\n    if (typeof options.port === \"string\" && options.port !== \"auto\") {\n      options.port = Number(options.port);\n    }\n\n    /**\n     * Assume a proxy configuration specified as:\n     * proxy: {\n     *   'context': { options }\n     * }\n     * OR\n     * proxy: {\n     *   'context': 'target'\n     * }\n     */\n    if (typeof options.proxy !== \"undefined\") {\n      // TODO remove in the next major release, only accept `Array`\n      if (!Array.isArray(options.proxy)) {\n        if (\n          Object.prototype.hasOwnProperty.call(options.proxy, \"target\") ||\n          Object.prototype.hasOwnProperty.call(options.proxy, \"router\")\n        ) {\n          /** @type {ProxyConfigArray} */\n          (options.proxy) = [/** @type {ProxyConfigMap} */ (options.proxy)];\n        } else {\n          /** @type {ProxyConfigArray} */\n          (options.proxy) = Object.keys(options.proxy).map(\n            /**\n             * @param {string} context\n             * @returns {HttpProxyMiddlewareOptions}\n             */\n            (context) => {\n              let proxyOptions;\n              // For backwards compatibility reasons.\n              const correctedContext = context\n                .replace(/^\\*$/, \"**\")\n                .replace(/\\/\\*$/, \"\");\n\n              if (\n                typeof (\n                  /** @type {ProxyConfigMap} */ (options.proxy)[context]\n                ) === \"string\"\n              ) {\n                proxyOptions = {\n                  context: correctedContext,\n                  target:\n                    /** @type {ProxyConfigMap} */\n                    (options.proxy)[context],\n                };\n              } else {\n                proxyOptions = {\n                  // @ts-ignore\n                  .../** @type {ProxyConfigMap} */ (options.proxy)[context],\n                };\n                proxyOptions.context = correctedContext;\n              }\n\n              return proxyOptions;\n            }\n          );\n        }\n      }\n\n      /** @type {ProxyConfigArray} */\n      (options.proxy) =\n        /** @type {ProxyConfigArray} */\n        (options.proxy).map((item) => {\n          if (typeof item === \"function\") {\n            return item;\n          }\n\n          /**\n           * @param {\"info\" | \"warn\" | \"error\" | \"debug\" | \"silent\" | undefined | \"none\" | \"log\" | \"verbose\"} level\n           * @returns {\"info\" | \"warn\" | \"error\" | \"debug\" | \"silent\" | undefined}\n           */\n          const getLogLevelForProxy = (level) => {\n            if (level === \"none\") {\n              return \"silent\";\n            }\n\n            if (level === \"log\") {\n              return \"info\";\n            }\n\n            if (level === \"verbose\") {\n              return \"debug\";\n            }\n\n            return level;\n          };\n\n          if (typeof item.logLevel === \"undefined\") {\n            item.logLevel = getLogLevelForProxy(\n              compilerOptions.infrastructureLogging\n                ? compilerOptions.infrastructureLogging.level\n                : \"info\"\n            );\n          }\n\n          if (typeof item.logProvider === \"undefined\") {\n            item.logProvider = () => this.logger;\n          }\n\n          return item;\n        });\n    }\n\n    if (typeof options.setupExitSignals === \"undefined\") {\n      options.setupExitSignals = true;\n    }\n\n    if (typeof options.static === \"undefined\") {\n      options.static = [getStaticItem()];\n    } else if (typeof options.static === \"boolean\") {\n      options.static = options.static ? [getStaticItem()] : false;\n    } else if (typeof options.static === \"string\") {\n      options.static = [getStaticItem(options.static)];\n    } else if (Array.isArray(options.static)) {\n      options.static = options.static.map((item) => getStaticItem(item));\n    } else {\n      options.static = [getStaticItem(options.static)];\n    }\n\n    if (typeof options.watchFiles === \"string\") {\n      options.watchFiles = [\n        { paths: options.watchFiles, options: getWatchOptions() },\n      ];\n    } else if (\n      typeof options.watchFiles === \"object\" &&\n      options.watchFiles !== null &&\n      !Array.isArray(options.watchFiles)\n    ) {\n      options.watchFiles = [\n        {\n          paths: options.watchFiles.paths,\n          options: getWatchOptions(options.watchFiles.options || {}),\n        },\n      ];\n    } else if (Array.isArray(options.watchFiles)) {\n      options.watchFiles = options.watchFiles.map((item) => {\n        if (typeof item === \"string\") {\n          return { paths: item, options: getWatchOptions() };\n        }\n\n        return {\n          paths: item.paths,\n          options: getWatchOptions(item.options || {}),\n        };\n      });\n    } else {\n      options.watchFiles = [];\n    }\n\n    const defaultWebSocketServerType = \"ws\";\n    const defaultWebSocketServerOptions = { path: \"/ws\" };\n\n    if (typeof options.webSocketServer === \"undefined\") {\n      options.webSocketServer = {\n        type: defaultWebSocketServerType,\n        options: defaultWebSocketServerOptions,\n      };\n    } else if (\n      typeof options.webSocketServer === \"boolean\" &&\n      !options.webSocketServer\n    ) {\n      options.webSocketServer = false;\n    } else if (\n      typeof options.webSocketServer === \"string\" ||\n      typeof options.webSocketServer === \"function\"\n    ) {\n      options.webSocketServer = {\n        type: options.webSocketServer,\n        options: defaultWebSocketServerOptions,\n      };\n    } else {\n      options.webSocketServer = {\n        type:\n          /** @type {WebSocketServerConfiguration} */\n          (options.webSocketServer).type || defaultWebSocketServerType,\n        options: {\n          ...defaultWebSocketServerOptions,\n          .../** @type {WebSocketServerConfiguration} */\n          (options.webSocketServer).options,\n        },\n      };\n\n      const webSocketServer =\n        /** @type {{ type: WebSocketServerConfiguration[\"type\"], options: NonNullable<WebSocketServerConfiguration[\"options\"]> }} */\n        (options.webSocketServer);\n\n      if (typeof webSocketServer.options.port === \"string\") {\n        webSocketServer.options.port = Number(webSocketServer.options.port);\n      }\n    }\n  }\n\n  /**\n   * @private\n   * @returns {string}\n   */\n  getClientTransport() {\n    let clientImplementation;\n    let clientImplementationFound = true;\n\n    const isKnownWebSocketServerImplementation =\n      this.options.webSocketServer &&\n      typeof (\n        /** @type {WebSocketServerConfiguration} */\n        (this.options.webSocketServer).type\n      ) === \"string\" &&\n      // @ts-ignore\n      (this.options.webSocketServer.type === \"ws\" ||\n        /** @type {WebSocketServerConfiguration} */\n        (this.options.webSocketServer).type === \"sockjs\");\n\n    let clientTransport;\n\n    if (this.options.client) {\n      if (\n        typeof (\n          /** @type {ClientConfiguration} */\n          (this.options.client).webSocketTransport\n        ) !== \"undefined\"\n      ) {\n        clientTransport =\n          /** @type {ClientConfiguration} */\n          (this.options.client).webSocketTransport;\n      } else if (isKnownWebSocketServerImplementation) {\n        clientTransport =\n          /** @type {WebSocketServerConfiguration} */\n          (this.options.webSocketServer).type;\n      } else {\n        clientTransport = \"ws\";\n      }\n    } else {\n      clientTransport = \"ws\";\n    }\n\n    switch (typeof clientTransport) {\n      case \"string\":\n        // could be 'sockjs', 'ws', or a path that should be required\n        if (clientTransport === \"sockjs\") {\n          clientImplementation = require.resolve(\n            \"../client/clients/SockJSClient\"\n          );\n        } else if (clientTransport === \"ws\") {\n          clientImplementation = require.resolve(\n            \"../client/clients/WebSocketClient\"\n          );\n        } else {\n          try {\n            clientImplementation = require.resolve(clientTransport);\n          } catch (e) {\n            clientImplementationFound = false;\n          }\n        }\n        break;\n      default:\n        clientImplementationFound = false;\n    }\n\n    if (!clientImplementationFound) {\n      throw new Error(\n        `${\n          !isKnownWebSocketServerImplementation\n            ? \"When you use custom web socket implementation you must explicitly specify client.webSocketTransport. \"\n            : \"\"\n        }client.webSocketTransport must be a string denoting a default implementation (e.g. 'sockjs', 'ws') or a full path to a JS file via require.resolve(...) which exports a class `\n      );\n    }\n\n    return /** @type {string} */ (clientImplementation);\n  }\n\n  /**\n   * @private\n   * @returns {string}\n   */\n  getServerTransport() {\n    let implementation;\n    let implementationFound = true;\n\n    switch (\n      typeof (\n        /** @type {WebSocketServerConfiguration} */\n        (this.options.webSocketServer).type\n      )\n    ) {\n      case \"string\":\n        // Could be 'sockjs', in the future 'ws', or a path that should be required\n        if (\n          /** @type {WebSocketServerConfiguration} */ (\n            this.options.webSocketServer\n          ).type === \"sockjs\"\n        ) {\n          implementation = require(\"./servers/SockJSServer\");\n        } else if (\n          /** @type {WebSocketServerConfiguration} */ (\n            this.options.webSocketServer\n          ).type === \"ws\"\n        ) {\n          implementation = require(\"./servers/WebsocketServer\");\n        } else {\n          try {\n            // eslint-disable-next-line import/no-dynamic-require\n            implementation = require(/** @type {WebSocketServerConfiguration} */ (\n              this.options.webSocketServer\n            ).type);\n          } catch (error) {\n            implementationFound = false;\n          }\n        }\n        break;\n      case \"function\":\n        implementation = /** @type {WebSocketServerConfiguration} */ (\n          this.options.webSocketServer\n        ).type;\n        break;\n      default:\n        implementationFound = false;\n    }\n\n    if (!implementationFound) {\n      throw new Error(\n        \"webSocketServer (webSocketServer.type) must be a string denoting a default implementation (e.g. 'ws', 'sockjs'), a full path to \" +\n          \"a JS file which exports a class extending BaseServer (webpack-dev-server/lib/servers/BaseServer.js) \" +\n          \"via require.resolve(...), or the class itself which extends BaseServer\"\n      );\n    }\n\n    return implementation;\n  }\n\n  /**\n   * @private\n   * @returns {void}\n   */\n  setupProgressPlugin() {\n    const { ProgressPlugin } =\n      /** @type {MultiCompiler}*/\n      (this.compiler).compilers\n        ? /** @type {MultiCompiler}*/ (this.compiler).compilers[0].webpack\n        : /** @type {Compiler}*/ (this.compiler).webpack ||\n          // TODO remove me after drop webpack v4\n          require(\"webpack\");\n\n    new ProgressPlugin(\n      /**\n       * @param {number} percent\n       * @param {string} msg\n       * @param {string} addInfo\n       * @param {string} pluginName\n       */\n      (percent, msg, addInfo, pluginName) => {\n        percent = Math.floor(percent * 100);\n\n        if (percent === 100) {\n          msg = \"Compilation completed\";\n        }\n\n        if (addInfo) {\n          msg = `${msg} (${addInfo})`;\n        }\n\n        if (this.webSocketServer) {\n          this.sendMessage(this.webSocketServer.clients, \"progress-update\", {\n            percent,\n            msg,\n            pluginName,\n          });\n        }\n\n        if (this.server) {\n          this.server.emit(\"progress-update\", { percent, msg, pluginName });\n        }\n      }\n    ).apply(this.compiler);\n  }\n\n  /**\n   * @private\n   * @returns {Promise<void>}\n   */\n  async initialize() {\n    if (this.options.webSocketServer) {\n      const compilers =\n        /** @type {MultiCompiler} */\n        (this.compiler).compilers || [this.compiler];\n\n      compilers.forEach((compiler) => {\n        this.addAdditionalEntries(compiler);\n\n        const webpack = compiler.webpack || require(\"webpack\");\n\n        new webpack.ProvidePlugin({\n          __webpack_dev_server_client__: this.getClientTransport(),\n        }).apply(compiler);\n\n        // TODO remove after drop webpack v4 support\n        compiler.options.plugins = compiler.options.plugins || [];\n\n        if (this.options.hot) {\n          const HMRPluginExists = compiler.options.plugins.find(\n            (p) => p.constructor === webpack.HotModuleReplacementPlugin\n          );\n\n          if (HMRPluginExists) {\n            this.logger.warn(\n              `\"hot: true\" automatically applies HMR plugin, you don't have to add it manually to your webpack configuration.`\n            );\n          } else {\n            // Apply the HMR plugin\n            const plugin = new webpack.HotModuleReplacementPlugin();\n\n            plugin.apply(compiler);\n          }\n        }\n      });\n\n      if (\n        this.options.client &&\n        /** @type {ClientConfiguration} */ (this.options.client).progress\n      ) {\n        this.setupProgressPlugin();\n      }\n    }\n\n    this.setupHooks();\n    this.setupApp();\n    this.setupHostHeaderCheck();\n    this.setupDevMiddleware();\n    // Should be after `webpack-dev-middleware`, otherwise other middlewares might rewrite response\n    this.setupBuiltInRoutes();\n    this.setupWatchFiles();\n    this.setupWatchStaticFiles();\n    this.setupMiddlewares();\n    this.createServer();\n\n    if (this.options.setupExitSignals) {\n      const signals = [\"SIGINT\", \"SIGTERM\"];\n\n      let needForceShutdown = false;\n\n      signals.forEach((signal) => {\n        const listener = () => {\n          if (needForceShutdown) {\n            process.exit();\n          }\n\n          this.logger.info(\n            \"Gracefully shutting down. To force exit, press ^C again. Please wait...\"\n          );\n\n          needForceShutdown = true;\n\n          this.stopCallback(() => {\n            if (typeof this.compiler.close === \"function\") {\n              this.compiler.close(() => {\n                process.exit();\n              });\n            } else {\n              process.exit();\n            }\n          });\n        };\n\n        this.listeners.push({ name: signal, listener });\n\n        process.on(signal, listener);\n      });\n    }\n\n    // Proxy WebSocket without the initial http request\n    // https://github.com/chimurai/http-proxy-middleware#external-websocket-upgrade\n    /** @type {RequestHandler[]} */\n    (this.webSocketProxies).forEach((webSocketProxy) => {\n      /** @type {import(\"http\").Server} */\n      (this.server).on(\n        \"upgrade\",\n        /** @type {RequestHandler & { upgrade: NonNullable<RequestHandler[\"upgrade\"]> }} */\n        (webSocketProxy).upgrade\n      );\n    }, this);\n  }\n\n  /**\n   * @private\n   * @returns {void}\n   */\n  setupApp() {\n    /** @type {import(\"express\").Application | undefined}*/\n    // eslint-disable-next-line new-cap\n    this.app = new /** @type {any} */ (express)();\n  }\n\n  /**\n   * @private\n   * @param {Stats | MultiStats} statsObj\n   * @returns {StatsCompilation}\n   */\n  getStats(statsObj) {\n    const stats = Server.DEFAULT_STATS;\n    const compilerOptions = this.getCompilerOptions();\n\n    // @ts-ignore\n    if (compilerOptions.stats && compilerOptions.stats.warningsFilter) {\n      // @ts-ignore\n      stats.warningsFilter = compilerOptions.stats.warningsFilter;\n    }\n\n    return statsObj.toJson(stats);\n  }\n\n  /**\n   * @private\n   * @returns {void}\n   */\n  setupHooks() {\n    this.compiler.hooks.invalid.tap(\"webpack-dev-server\", () => {\n      if (this.webSocketServer) {\n        this.sendMessage(this.webSocketServer.clients, \"invalid\");\n      }\n    });\n    this.compiler.hooks.done.tap(\n      \"webpack-dev-server\",\n      /**\n       * @param {Stats | MultiStats} stats\n       */\n      (stats) => {\n        if (this.webSocketServer) {\n          this.sendStats(this.webSocketServer.clients, this.getStats(stats));\n        }\n\n        /**\n         * @private\n         * @type {Stats | MultiStats}\n         */\n        this.stats = stats;\n      }\n    );\n  }\n\n  /**\n   * @private\n   * @returns {void}\n   */\n  setupHostHeaderCheck() {\n    /** @type {import(\"express\").Application} */\n    (this.app).all(\n      \"*\",\n      /**\n       * @param {Request} req\n       * @param {Response} res\n       * @param {NextFunction} next\n       * @returns {void}\n       */\n      (req, res, next) => {\n        if (\n          this.checkHeader(\n            /** @type {{ [key: string]: string | undefined }} */\n            (req.headers),\n            \"host\"\n          )\n        ) {\n          return next();\n        }\n\n        res.send(\"Invalid Host header\");\n      }\n    );\n  }\n\n  /**\n   * @private\n   * @returns {void}\n   */\n  setupDevMiddleware() {\n    const webpackDevMiddleware = require(\"webpack-dev-middleware\");\n\n    // middleware for serving webpack bundle\n    this.middleware = webpackDevMiddleware(\n      this.compiler,\n      this.options.devMiddleware\n    );\n  }\n\n  /**\n   * @private\n   * @returns {void}\n   */\n  setupBuiltInRoutes() {\n    const { app, middleware } = this;\n\n    /** @type {import(\"express\").Application} */\n    (app).get(\n      \"/__webpack_dev_server__/sockjs.bundle.js\",\n      /**\n       * @param {Request} req\n       * @param {Response} res\n       * @returns {void}\n       */\n      (req, res) => {\n        res.setHeader(\"Content-Type\", \"application/javascript\");\n\n        const clientPath = path.join(__dirname, \"..\", \"client\");\n\n        res.sendFile(path.join(clientPath, \"modules/sockjs-client/index.js\"));\n      }\n    );\n\n    /** @type {import(\"express\").Application} */\n    (app).get(\n      \"/webpack-dev-server/invalidate\",\n      /**\n       * @param {Request} _req\n       * @param {Response} res\n       * @returns {void}\n       */\n      (_req, res) => {\n        this.invalidate();\n\n        res.end();\n      }\n    );\n\n    /** @type {import(\"express\").Application} */\n    (app).get(\"/webpack-dev-server/open-editor\", (req, res) => {\n      const fileName = req.query.fileName;\n\n      if (typeof fileName === \"string\") {\n        // @ts-ignore\n        const launchEditor = require(\"launch-editor\");\n        launchEditor(fileName);\n      }\n\n      res.end();\n    });\n\n    /** @type {import(\"express\").Application} */\n    (app).get(\n      \"/webpack-dev-server\",\n      /**\n       * @param {Request} req\n       * @param {Response} res\n       * @returns {void}\n       */\n      (req, res) => {\n        /** @type {import(\"webpack-dev-middleware\").API<Request, Response>}*/\n        (middleware).waitUntilValid((stats) => {\n          res.setHeader(\"Content-Type\", \"text/html\");\n          res.write(\n            '<!DOCTYPE html><html><head><meta charset=\"utf-8\"/></head><body>'\n          );\n\n          const statsForPrint =\n            typeof (/** @type {MultiStats} */ (stats).stats) !== \"undefined\"\n              ? /** @type {MultiStats} */ (stats).toJson().children\n              : [/** @type {Stats} */ (stats).toJson()];\n\n          res.write(`<h1>Assets Report:</h1>`);\n\n          /**\n           * @type {StatsCompilation[]}\n           */\n          (statsForPrint).forEach((item, index) => {\n            res.write(\"<div>\");\n\n            const name =\n              // eslint-disable-next-line no-nested-ternary\n              typeof item.name !== \"undefined\"\n                ? item.name\n                : /** @type {MultiStats} */ (stats).stats\n                ? `unnamed[${index}]`\n                : \"unnamed\";\n\n            res.write(`<h2>Compilation: ${name}</h2>`);\n            res.write(\"<ul>\");\n\n            const publicPath =\n              item.publicPath === \"auto\" ? \"\" : item.publicPath;\n\n            for (const asset of /** @type {NonNullable<StatsCompilation[\"assets\"]>} */ (\n              item.assets\n            )) {\n              const assetName = asset.name;\n              const assetURL = `${publicPath}${assetName}`;\n\n              res.write(\n                `<li>\n              <strong><a href=\"${assetURL}\" target=\"_blank\">${assetName}</a></strong>\n            </li>`\n              );\n            }\n\n            res.write(\"</ul>\");\n            res.write(\"</div>\");\n          });\n\n          res.end(\"</body></html>\");\n        });\n      }\n    );\n  }\n\n  /**\n   * @private\n   * @returns {void}\n   */\n  setupWatchStaticFiles() {\n    if (/** @type {NormalizedStatic[]} */ (this.options.static).length > 0) {\n      /** @type {NormalizedStatic[]} */\n      (this.options.static).forEach((staticOption) => {\n        if (staticOption.watch) {\n          this.watchFiles(staticOption.directory, staticOption.watch);\n        }\n      });\n    }\n  }\n\n  /**\n   * @private\n   * @returns {void}\n   */\n  setupWatchFiles() {\n    const { watchFiles } = this.options;\n\n    if (/** @type {WatchFiles[]} */ (watchFiles).length > 0) {\n      /** @type {WatchFiles[]} */\n      (watchFiles).forEach((item) => {\n        this.watchFiles(item.paths, item.options);\n      });\n    }\n  }\n\n  /**\n   * @private\n   * @returns {void}\n   */\n  setupMiddlewares() {\n    /**\n     * @type {Array<Middleware>}\n     */\n    let middlewares = [];\n\n    // compress is placed last and uses unshift so that it will be the first middleware used\n    if (this.options.compress) {\n      const compression = require(\"compression\");\n\n      middlewares.push({ name: \"compression\", middleware: compression() });\n    }\n\n    if (typeof this.options.onBeforeSetupMiddleware === \"function\") {\n      this.options.onBeforeSetupMiddleware(this);\n    }\n\n    if (typeof this.options.headers !== \"undefined\") {\n      middlewares.push({\n        name: \"set-headers\",\n        path: \"*\",\n        middleware: this.setHeaders.bind(this),\n      });\n    }\n\n    middlewares.push({\n      name: \"webpack-dev-middleware\",\n      middleware:\n        /** @type {import(\"webpack-dev-middleware\").Middleware<Request, Response>}*/\n        (this.middleware),\n    });\n\n    if (this.options.proxy) {\n      const { createProxyMiddleware } = require(\"http-proxy-middleware\");\n\n      /**\n       * @param {ProxyConfigArrayItem} proxyConfig\n       * @returns {RequestHandler | undefined}\n       */\n      const getProxyMiddleware = (proxyConfig) => {\n        // It is possible to use the `bypass` method without a `target` or `router`.\n        // However, the proxy middleware has no use in this case, and will fail to instantiate.\n        if (proxyConfig.target) {\n          const context = proxyConfig.context || proxyConfig.path;\n\n          return createProxyMiddleware(\n            /** @type {string} */ (context),\n            proxyConfig\n          );\n        }\n\n        if (proxyConfig.router) {\n          return createProxyMiddleware(proxyConfig);\n        }\n      };\n\n      /**\n       * Assume a proxy configuration specified as:\n       * proxy: [\n       *   {\n       *     context: \"value\",\n       *     ...options,\n       *   },\n       *   // or:\n       *   function() {\n       *     return {\n       *       context: \"context\",\n       *       ...options,\n       *     };\n       *   }\n       * ]\n       */\n      /** @type {ProxyConfigArray} */\n      (this.options.proxy).forEach((proxyConfigOrCallback) => {\n        /**\n         * @type {RequestHandler}\n         */\n        let proxyMiddleware;\n\n        let proxyConfig =\n          typeof proxyConfigOrCallback === \"function\"\n            ? proxyConfigOrCallback()\n            : proxyConfigOrCallback;\n\n        proxyMiddleware =\n          /** @type {RequestHandler} */\n          (getProxyMiddleware(proxyConfig));\n\n        if (proxyConfig.ws) {\n          this.webSocketProxies.push(proxyMiddleware);\n        }\n\n        /**\n         * @param {Request} req\n         * @param {Response} res\n         * @param {NextFunction} next\n         * @returns {Promise<void>}\n         */\n        const handler = async (req, res, next) => {\n          if (typeof proxyConfigOrCallback === \"function\") {\n            const newProxyConfig = proxyConfigOrCallback(req, res, next);\n\n            if (newProxyConfig !== proxyConfig) {\n              proxyConfig = newProxyConfig;\n              proxyMiddleware =\n                /** @type {RequestHandler} */\n                (getProxyMiddleware(proxyConfig));\n            }\n          }\n\n          // - Check if we have a bypass function defined\n          // - In case the bypass function is defined we'll retrieve the\n          // bypassUrl from it otherwise bypassUrl would be null\n          // TODO remove in the next major in favor `context` and `router` options\n          const isByPassFuncDefined = typeof proxyConfig.bypass === \"function\";\n          const bypassUrl = isByPassFuncDefined\n            ? await /** @type {ByPass} */ (proxyConfig.bypass)(\n                req,\n                res,\n                proxyConfig\n              )\n            : null;\n\n          if (typeof bypassUrl === \"boolean\") {\n            // skip the proxy\n            // @ts-ignore\n            req.url = null;\n            next();\n          } else if (typeof bypassUrl === \"string\") {\n            // byPass to that url\n            req.url = bypassUrl;\n            next();\n          } else if (proxyMiddleware) {\n            return proxyMiddleware(req, res, next);\n          } else {\n            next();\n          }\n        };\n\n        middlewares.push({\n          name: \"http-proxy-middleware\",\n          middleware: handler,\n        });\n        // Also forward error requests to the proxy so it can handle them.\n        middlewares.push({\n          name: \"http-proxy-middleware-error-handler\",\n          middleware:\n            /**\n             * @param {Error} error\n             * @param {Request} req\n             * @param {Response} res\n             * @param {NextFunction} next\n             * @returns {any}\n             */\n            (error, req, res, next) => handler(req, res, next),\n        });\n      });\n\n      middlewares.push({\n        name: \"webpack-dev-middleware\",\n        middleware:\n          /** @type {import(\"webpack-dev-middleware\").Middleware<Request, Response>}*/\n          (this.middleware),\n      });\n    }\n\n    if (/** @type {NormalizedStatic[]} */ (this.options.static).length > 0) {\n      /** @type {NormalizedStatic[]} */\n      (this.options.static).forEach((staticOption) => {\n        staticOption.publicPath.forEach((publicPath) => {\n          middlewares.push({\n            name: \"express-static\",\n            path: publicPath,\n            middleware: express.static(\n              staticOption.directory,\n              staticOption.staticOptions\n            ),\n          });\n        });\n      });\n    }\n\n    if (this.options.historyApiFallback) {\n      const connectHistoryApiFallback = require(\"connect-history-api-fallback\");\n      const { historyApiFallback } = this.options;\n\n      if (\n        typeof (\n          /** @type {ConnectHistoryApiFallbackOptions} */\n          (historyApiFallback).logger\n        ) === \"undefined\" &&\n        !(\n          /** @type {ConnectHistoryApiFallbackOptions} */\n          (historyApiFallback).verbose\n        )\n      ) {\n        // @ts-ignore\n        historyApiFallback.logger = this.logger.log.bind(\n          this.logger,\n          \"[connect-history-api-fallback]\"\n        );\n      }\n\n      // Fall back to /index.html if nothing else matches.\n      middlewares.push({\n        name: \"connect-history-api-fallback\",\n        middleware: connectHistoryApiFallback(\n          /** @type {ConnectHistoryApiFallbackOptions} */\n          (historyApiFallback)\n        ),\n      });\n\n      // include our middleware to ensure\n      // it is able to handle '/index.html' request after redirect\n      middlewares.push({\n        name: \"webpack-dev-middleware\",\n        middleware:\n          /** @type {import(\"webpack-dev-middleware\").Middleware<Request, Response>}*/\n          (this.middleware),\n      });\n\n      if (/** @type {NormalizedStatic[]} */ (this.options.static).length > 0) {\n        /** @type {NormalizedStatic[]} */\n        (this.options.static).forEach((staticOption) => {\n          staticOption.publicPath.forEach((publicPath) => {\n            middlewares.push({\n              name: \"express-static\",\n              path: publicPath,\n              middleware: express.static(\n                staticOption.directory,\n                staticOption.staticOptions\n              ),\n            });\n          });\n        });\n      }\n    }\n\n    if (/** @type {NormalizedStatic[]} */ (this.options.static).length > 0) {\n      const serveIndex = require(\"serve-index\");\n\n      /** @type {NormalizedStatic[]} */\n      (this.options.static).forEach((staticOption) => {\n        staticOption.publicPath.forEach((publicPath) => {\n          if (staticOption.serveIndex) {\n            middlewares.push({\n              name: \"serve-index\",\n              path: publicPath,\n              /**\n               * @param {Request} req\n               * @param {Response} res\n               * @param {NextFunction} next\n               * @returns {void}\n               */\n              middleware: (req, res, next) => {\n                // serve-index doesn't fallthrough non-get/head request to next middleware\n                if (req.method !== \"GET\" && req.method !== \"HEAD\") {\n                  return next();\n                }\n\n                serveIndex(\n                  staticOption.directory,\n                  /** @type {ServeIndexOptions} */\n                  (staticOption.serveIndex)\n                )(req, res, next);\n              },\n            });\n          }\n        });\n      });\n    }\n\n    if (this.options.magicHtml) {\n      middlewares.push({\n        name: \"serve-magic-html\",\n        middleware: this.serveMagicHtml.bind(this),\n      });\n    }\n\n    // Register this middleware always as the last one so that it's only used as a\n    // fallback when no other middleware responses.\n    middlewares.push({\n      name: \"options-middleware\",\n      path: \"*\",\n      /**\n       * @param {Request} req\n       * @param {Response} res\n       * @param {NextFunction} next\n       * @returns {void}\n       */\n      middleware: (req, res, next) => {\n        if (req.method === \"OPTIONS\") {\n          res.statusCode = 204;\n          res.setHeader(\"Content-Length\", \"0\");\n          res.end();\n          return;\n        }\n        next();\n      },\n    });\n\n    if (typeof this.options.setupMiddlewares === \"function\") {\n      middlewares = this.options.setupMiddlewares(middlewares, this);\n    }\n\n    middlewares.forEach((middleware) => {\n      if (typeof middleware === \"function\") {\n        /** @type {import(\"express\").Application} */\n        (this.app).use(middleware);\n      } else if (typeof middleware.path !== \"undefined\") {\n        /** @type {import(\"express\").Application} */\n        (this.app).use(middleware.path, middleware.middleware);\n      } else {\n        /** @type {import(\"express\").Application} */\n        (this.app).use(middleware.middleware);\n      }\n    });\n\n    if (typeof this.options.onAfterSetupMiddleware === \"function\") {\n      this.options.onAfterSetupMiddleware(this);\n    }\n  }\n\n  /**\n   * @private\n   * @returns {void}\n   */\n  createServer() {\n    const { type, options } = /** @type {ServerConfiguration} */ (\n      this.options.server\n    );\n\n    /** @type {import(\"http\").Server | undefined | null} */\n    // eslint-disable-next-line import/no-dynamic-require\n    this.server = require(/** @type {string} */ (type)).createServer(\n      options,\n      this.app\n    );\n\n    /** @type {import(\"http\").Server} */\n    (this.server).on(\n      \"connection\",\n      /**\n       * @param {Socket} socket\n       */\n      (socket) => {\n        // Add socket to list\n        this.sockets.push(socket);\n\n        socket.once(\"close\", () => {\n          // Remove socket from list\n          this.sockets.splice(this.sockets.indexOf(socket), 1);\n        });\n      }\n    );\n\n    /** @type {import(\"http\").Server} */\n    (this.server).on(\n      \"error\",\n      /**\n       * @param {Error} error\n       */\n      (error) => {\n        throw error;\n      }\n    );\n  }\n\n  /**\n   * @private\n   * @returns {void}\n   */\n  // TODO: remove `--web-socket-server` in favor of `--web-socket-server-type`\n  createWebSocketServer() {\n    /** @type {WebSocketServerImplementation | undefined | null} */\n    this.webSocketServer = new /** @type {any} */ (this.getServerTransport())(\n      this\n    );\n    /** @type {WebSocketServerImplementation} */\n    (this.webSocketServer).implementation.on(\n      \"connection\",\n      /**\n       * @param {ClientConnection} client\n       * @param {IncomingMessage} request\n       */\n      (client, request) => {\n        /** @type {{ [key: string]: string | undefined } | undefined} */\n        const headers =\n          // eslint-disable-next-line no-nested-ternary\n          typeof request !== \"undefined\"\n            ? /** @type {{ [key: string]: string | undefined }} */\n              (request.headers)\n            : typeof (\n                /** @type {import(\"sockjs\").Connection} */ (client).headers\n              ) !== \"undefined\"\n            ? /** @type {import(\"sockjs\").Connection} */ (client).headers\n            : // eslint-disable-next-line no-undefined\n              undefined;\n\n        if (!headers) {\n          this.logger.warn(\n            'webSocketServer implementation must pass headers for the \"connection\" event'\n          );\n        }\n\n        if (\n          !headers ||\n          !this.checkHeader(headers, \"host\") ||\n          !this.checkHeader(headers, \"origin\")\n        ) {\n          this.sendMessage([client], \"error\", \"Invalid Host/Origin header\");\n\n          // With https enabled, the sendMessage above is encrypted asynchronously so not yet sent\n          // Terminate would prevent it sending, so use close to allow it to be sent\n          client.close();\n\n          return;\n        }\n\n        if (this.options.hot === true || this.options.hot === \"only\") {\n          this.sendMessage([client], \"hot\");\n        }\n\n        if (this.options.liveReload) {\n          this.sendMessage([client], \"liveReload\");\n        }\n\n        if (\n          this.options.client &&\n          /** @type {ClientConfiguration} */\n          (this.options.client).progress\n        ) {\n          this.sendMessage(\n            [client],\n            \"progress\",\n            /** @type {ClientConfiguration} */\n            (this.options.client).progress\n          );\n        }\n\n        if (\n          this.options.client &&\n          /** @type {ClientConfiguration} */ (this.options.client).reconnect\n        ) {\n          this.sendMessage(\n            [client],\n            \"reconnect\",\n            /** @type {ClientConfiguration} */\n            (this.options.client).reconnect\n          );\n        }\n\n        if (\n          this.options.client &&\n          /** @type {ClientConfiguration} */\n          (this.options.client).overlay\n        ) {\n          this.sendMessage(\n            [client],\n            \"overlay\",\n            /** @type {ClientConfiguration} */\n            (this.options.client).overlay\n          );\n        }\n\n        if (!this.stats) {\n          return;\n        }\n\n        this.sendStats([client], this.getStats(this.stats), true);\n      }\n    );\n  }\n\n  /**\n   * @private\n   * @param {string} defaultOpenTarget\n   * @returns {void}\n   */\n  openBrowser(defaultOpenTarget) {\n    const open = require(\"open\");\n\n    Promise.all(\n      /** @type {NormalizedOpen[]} */\n      (this.options.open).map((item) => {\n        /**\n         * @type {string}\n         */\n        let openTarget;\n\n        if (item.target === \"<url>\") {\n          openTarget = defaultOpenTarget;\n        } else {\n          openTarget = Server.isAbsoluteURL(item.target)\n            ? item.target\n            : new URL(item.target, defaultOpenTarget).toString();\n        }\n\n        return open(openTarget, item.options).catch(() => {\n          this.logger.warn(\n            `Unable to open \"${openTarget}\" page${\n              item.options.app\n                ? ` in \"${\n                    /** @type {import(\"open\").App} */\n                    (item.options.app).name\n                  }\" app${\n                    /** @type {import(\"open\").App} */\n                    (item.options.app).arguments\n                      ? ` with \"${\n                          /** @type {import(\"open\").App} */\n                          (item.options.app).arguments.join(\" \")\n                        }\" arguments`\n                      : \"\"\n                  }`\n                : \"\"\n            }. If you are running in a headless environment, please do not use the \"open\" option or related flags like \"--open\", \"--open-target\", and \"--open-app\".`\n          );\n        });\n      })\n    );\n  }\n\n  /**\n   * @private\n   * @returns {void}\n   */\n  runBonjour() {\n    const { Bonjour } = require(\"bonjour-service\");\n    /**\n     * @private\n     * @type {Bonjour | undefined}\n     */\n    this.bonjour = new Bonjour();\n    this.bonjour.publish({\n      // @ts-expect-error\n      name: `Webpack Dev Server ${os.hostname()}:${this.options.port}`,\n      // @ts-expect-error\n      port: /** @type {number} */ (this.options.port),\n      // @ts-expect-error\n      type:\n        /** @type {ServerConfiguration} */\n        (this.options.server).type === \"http\" ? \"http\" : \"https\",\n      subtypes: [\"webpack\"],\n      .../** @type {BonjourOptions} */ (this.options.bonjour),\n    });\n  }\n\n  /**\n   * @private\n   * @returns {void}\n   */\n  stopBonjour(callback = () => {}) {\n    /** @type {Bonjour} */\n    (this.bonjour).unpublishAll(() => {\n      /** @type {Bonjour} */\n      (this.bonjour).destroy();\n\n      if (callback) {\n        callback();\n      }\n    });\n  }\n\n  /**\n   * @private\n   * @returns {void}\n   */\n  logStatus() {\n    const { isColorSupported, cyan, red } = require(\"colorette\");\n\n    /**\n     * @param {Compiler[\"options\"]} compilerOptions\n     * @returns {boolean}\n     */\n    const getColorsOption = (compilerOptions) => {\n      /**\n       * @type {boolean}\n       */\n      let colorsEnabled;\n\n      if (\n        compilerOptions.stats &&\n        typeof (/** @type {StatsOptions} */ (compilerOptions.stats).colors) !==\n          \"undefined\"\n      ) {\n        colorsEnabled =\n          /** @type {boolean} */\n          (/** @type {StatsOptions} */ (compilerOptions.stats).colors);\n      } else {\n        colorsEnabled = isColorSupported;\n      }\n\n      return colorsEnabled;\n    };\n\n    const colors = {\n      /**\n       * @param {boolean} useColor\n       * @param {string} msg\n       * @returns {string}\n       */\n      info(useColor, msg) {\n        if (useColor) {\n          return cyan(msg);\n        }\n\n        return msg;\n      },\n      /**\n       * @param {boolean} useColor\n       * @param {string} msg\n       * @returns {string}\n       */\n      error(useColor, msg) {\n        if (useColor) {\n          return red(msg);\n        }\n\n        return msg;\n      },\n    };\n    const useColor = getColorsOption(this.getCompilerOptions());\n\n    if (this.options.ipc) {\n      this.logger.info(\n        `Project is running at: \"${\n          /** @type {import(\"http\").Server} */\n          (this.server).address()\n        }\"`\n      );\n    } else {\n      const protocol =\n        /** @type {ServerConfiguration} */\n        (this.options.server).type === \"http\" ? \"http\" : \"https\";\n      const { address, port } =\n        /** @type {import(\"net\").AddressInfo} */\n        (\n          /** @type {import(\"http\").Server} */\n          (this.server).address()\n        );\n      /**\n       * @param {string} newHostname\n       * @returns {string}\n       */\n      const prettyPrintURL = (newHostname) =>\n        url.format({ protocol, hostname: newHostname, port, pathname: \"/\" });\n\n      let server;\n      let localhost;\n      let loopbackIPv4;\n      let loopbackIPv6;\n      let networkUrlIPv4;\n      let networkUrlIPv6;\n\n      if (this.options.host) {\n        if (this.options.host === \"localhost\") {\n          localhost = prettyPrintURL(\"localhost\");\n        } else {\n          let isIP;\n\n          try {\n            isIP = ipaddr.parse(this.options.host);\n          } catch (error) {\n            // Ignore\n          }\n\n          if (!isIP) {\n            server = prettyPrintURL(this.options.host);\n          }\n        }\n      }\n\n      const parsedIP = ipaddr.parse(address);\n\n      if (parsedIP.range() === \"unspecified\") {\n        localhost = prettyPrintURL(\"localhost\");\n\n        const networkIPv4 = Server.internalIPSync(\"v4\");\n\n        if (networkIPv4) {\n          networkUrlIPv4 = prettyPrintURL(networkIPv4);\n        }\n\n        const networkIPv6 = Server.internalIPSync(\"v6\");\n\n        if (networkIPv6) {\n          networkUrlIPv6 = prettyPrintURL(networkIPv6);\n        }\n      } else if (parsedIP.range() === \"loopback\") {\n        if (parsedIP.kind() === \"ipv4\") {\n          loopbackIPv4 = prettyPrintURL(parsedIP.toString());\n        } else if (parsedIP.kind() === \"ipv6\") {\n          loopbackIPv6 = prettyPrintURL(parsedIP.toString());\n        }\n      } else {\n        networkUrlIPv4 =\n          parsedIP.kind() === \"ipv6\" &&\n          /** @type {IPv6} */\n          (parsedIP).isIPv4MappedAddress()\n            ? prettyPrintURL(\n                /** @type {IPv6} */\n                (parsedIP).toIPv4Address().toString()\n              )\n            : prettyPrintURL(address);\n\n        if (parsedIP.kind() === \"ipv6\") {\n          networkUrlIPv6 = prettyPrintURL(address);\n        }\n      }\n\n      this.logger.info(\"Project is running at:\");\n\n      if (server) {\n        this.logger.info(`Server: ${colors.info(useColor, server)}`);\n      }\n\n      if (localhost || loopbackIPv4 || loopbackIPv6) {\n        const loopbacks = [];\n\n        if (localhost) {\n          loopbacks.push([colors.info(useColor, localhost)]);\n        }\n\n        if (loopbackIPv4) {\n          loopbacks.push([colors.info(useColor, loopbackIPv4)]);\n        }\n\n        if (loopbackIPv6) {\n          loopbacks.push([colors.info(useColor, loopbackIPv6)]);\n        }\n\n        this.logger.info(`Loopback: ${loopbacks.join(\", \")}`);\n      }\n\n      if (networkUrlIPv4) {\n        this.logger.info(\n          `On Your Network (IPv4): ${colors.info(useColor, networkUrlIPv4)}`\n        );\n      }\n\n      if (networkUrlIPv6) {\n        this.logger.info(\n          `On Your Network (IPv6): ${colors.info(useColor, networkUrlIPv6)}`\n        );\n      }\n\n      if (/** @type {NormalizedOpen[]} */ (this.options.open).length > 0) {\n        const openTarget = prettyPrintURL(this.options.host || \"localhost\");\n\n        this.openBrowser(openTarget);\n      }\n    }\n\n    if (/** @type {NormalizedStatic[]} */ (this.options.static).length > 0) {\n      this.logger.info(\n        `Content not from webpack is served from '${colors.info(\n          useColor,\n          /** @type {NormalizedStatic[]} */\n          (this.options.static)\n            .map((staticOption) => staticOption.directory)\n            .join(\", \")\n        )}' directory`\n      );\n    }\n\n    if (this.options.historyApiFallback) {\n      this.logger.info(\n        `404s will fallback to '${colors.info(\n          useColor,\n          /** @type {ConnectHistoryApiFallbackOptions} */ (\n            this.options.historyApiFallback\n          ).index || \"/index.html\"\n        )}'`\n      );\n    }\n\n    if (this.options.bonjour) {\n      const bonjourProtocol =\n        /** @type {BonjourOptions} */\n        (this.options.bonjour).type ||\n        /** @type {ServerConfiguration} */\n        (this.options.server).type === \"http\"\n          ? \"http\"\n          : \"https\";\n\n      this.logger.info(\n        `Broadcasting \"${bonjourProtocol}\" with subtype of \"webpack\" via ZeroConf DNS (Bonjour)`\n      );\n    }\n  }\n\n  /**\n   * @private\n   * @param {Request} req\n   * @param {Response} res\n   * @param {NextFunction} next\n   */\n  setHeaders(req, res, next) {\n    let { headers } = this.options;\n\n    if (headers) {\n      if (typeof headers === \"function\") {\n        headers = headers(\n          req,\n          res,\n          /** @type {import(\"webpack-dev-middleware\").API<Request, Response>}*/\n          (this.middleware).context\n        );\n      }\n\n      /**\n       * @type {{key: string, value: string}[]}\n       */\n      const allHeaders = [];\n\n      if (!Array.isArray(headers)) {\n        // eslint-disable-next-line guard-for-in\n        for (const name in headers) {\n          // @ts-ignore\n          allHeaders.push({ key: name, value: headers[name] });\n        }\n\n        headers = allHeaders;\n      }\n\n      headers.forEach(\n        /**\n         * @param {{key: string, value: any}} header\n         */\n        (header) => {\n          res.setHeader(header.key, header.value);\n        }\n      );\n    }\n\n    next();\n  }\n\n  /**\n   * @private\n   * @param {{ [key: string]: string | undefined }} headers\n   * @param {string} headerToCheck\n   * @returns {boolean}\n   */\n  checkHeader(headers, headerToCheck) {\n    // allow user to opt out of this security check, at their own risk\n    // by explicitly enabling allowedHosts\n    if (this.options.allowedHosts === \"all\") {\n      return true;\n    }\n\n    // get the Host header and extract hostname\n    // we don't care about port not matching\n    const hostHeader = headers[headerToCheck];\n\n    if (!hostHeader) {\n      return false;\n    }\n\n    if (/^(file|.+-extension):/i.test(hostHeader)) {\n      return true;\n    }\n\n    // use the node url-parser to retrieve the hostname from the host-header.\n    const hostname = url.parse(\n      // if hostHeader doesn't have scheme, add // for parsing.\n      /^(.+:)?\\/\\//.test(hostHeader) ? hostHeader : `//${hostHeader}`,\n      false,\n      true\n    ).hostname;\n\n    // always allow requests with explicit IPv4 or IPv6-address.\n    // A note on IPv6 addresses:\n    // hostHeader will always contain the brackets denoting\n    // an IPv6-address in URLs,\n    // these are removed from the hostname in url.parse(),\n    // so we have the pure IPv6-address in hostname.\n    // For convenience, always allow localhost (hostname === 'localhost')\n    // and its subdomains (hostname.endsWith(\".localhost\")).\n    // allow hostname of listening address  (hostname === this.options.host)\n    const isValidHostname =\n      (hostname !== null && ipaddr.IPv4.isValid(hostname)) ||\n      (hostname !== null && ipaddr.IPv6.isValid(hostname)) ||\n      hostname === \"localhost\" ||\n      (hostname !== null && hostname.endsWith(\".localhost\")) ||\n      hostname === this.options.host;\n\n    if (isValidHostname) {\n      return true;\n    }\n\n    const { allowedHosts } = this.options;\n\n    // always allow localhost host, for convenience\n    // allow if hostname is in allowedHosts\n    if (Array.isArray(allowedHosts) && allowedHosts.length > 0) {\n      for (let hostIdx = 0; hostIdx < allowedHosts.length; hostIdx++) {\n        const allowedHost = allowedHosts[hostIdx];\n\n        if (allowedHost === hostname) {\n          return true;\n        }\n\n        // support \".\" as a subdomain wildcard\n        // e.g. \".example.com\" will allow \"example.com\", \"www.example.com\", \"subdomain.example.com\", etc\n        if (allowedHost[0] === \".\") {\n          // \"example.com\"  (hostname === allowedHost.substring(1))\n          // \"*.example.com\"  (hostname.endsWith(allowedHost))\n          if (\n            hostname === allowedHost.substring(1) ||\n            /** @type {string} */ (hostname).endsWith(allowedHost)\n          ) {\n            return true;\n          }\n        }\n      }\n    }\n\n    // Also allow if `client.webSocketURL.hostname` provided\n    if (\n      this.options.client &&\n      typeof (\n        /** @type {ClientConfiguration} */ (this.options.client).webSocketURL\n      ) !== \"undefined\"\n    ) {\n      return (\n        /** @type {WebSocketURL} */\n        (/** @type {ClientConfiguration} */ (this.options.client).webSocketURL)\n          .hostname === hostname\n      );\n    }\n\n    // disallow\n    return false;\n  }\n\n  /**\n   * @param {ClientConnection[]} clients\n   * @param {string} type\n   * @param {any} [data]\n   * @param {any} [params]\n   */\n  // eslint-disable-next-line class-methods-use-this\n  sendMessage(clients, type, data, params) {\n    for (const client of clients) {\n      // `sockjs` uses `1` to indicate client is ready to accept data\n      // `ws` uses `WebSocket.OPEN`, but it is mean `1` too\n      if (client.readyState === 1) {\n        client.send(JSON.stringify({ type, data, params }));\n      }\n    }\n  }\n\n  /**\n   * @private\n   * @param {Request} req\n   * @param {Response} res\n   * @param {NextFunction} next\n   * @returns {void}\n   */\n  serveMagicHtml(req, res, next) {\n    if (req.method !== \"GET\" && req.method !== \"HEAD\") {\n      return next();\n    }\n\n    /** @type {import(\"webpack-dev-middleware\").API<Request, Response>}*/\n    (this.middleware).waitUntilValid(() => {\n      const _path = req.path;\n\n      try {\n        const filename =\n          /** @type {import(\"webpack-dev-middleware\").API<Request, Response>}*/\n          (this.middleware).getFilenameFromUrl(`${_path}.js`);\n        const isFile =\n          /** @type {Compiler[\"outputFileSystem\"] & { statSync: import(\"fs\").StatSyncFn }}*/\n          (\n            /** @type {import(\"webpack-dev-middleware\").API<Request, Response>}*/\n            (this.middleware).context.outputFileSystem\n          )\n            .statSync(/** @type {import(\"fs\").PathLike} */ (filename))\n            .isFile();\n\n        if (!isFile) {\n          return next();\n        }\n\n        // Serve a page that executes the javascript\n        // @ts-ignore\n        const queries = req._parsedUrl.search || \"\";\n        const responsePage = `<!DOCTYPE html><html><head><meta charset=\"utf-8\"/></head><body><script type=\"text/javascript\" charset=\"utf-8\" src=\"${_path}.js${queries}\"></script></body></html>`;\n\n        res.send(responsePage);\n      } catch (error) {\n        return next();\n      }\n    });\n  }\n\n  // Send stats to a socket or multiple sockets\n  /**\n   * @private\n   * @param {ClientConnection[]} clients\n   * @param {StatsCompilation} stats\n   * @param {boolean} [force]\n   */\n  sendStats(clients, stats, force) {\n    const shouldEmit =\n      !force &&\n      stats &&\n      (!stats.errors || stats.errors.length === 0) &&\n      (!stats.warnings || stats.warnings.length === 0) &&\n      this.currentHash === stats.hash;\n\n    if (shouldEmit) {\n      this.sendMessage(clients, \"still-ok\");\n\n      return;\n    }\n\n    this.currentHash = stats.hash;\n    this.sendMessage(clients, \"hash\", stats.hash);\n\n    if (\n      /** @type {NonNullable<StatsCompilation[\"errors\"]>} */\n      (stats.errors).length > 0 ||\n      /** @type {NonNullable<StatsCompilation[\"warnings\"]>} */\n      (stats.warnings).length > 0\n    ) {\n      const hasErrors =\n        /** @type {NonNullable<StatsCompilation[\"errors\"]>} */\n        (stats.errors).length > 0;\n\n      if (\n        /** @type {NonNullable<StatsCompilation[\"warnings\"]>} */\n        (stats.warnings).length > 0\n      ) {\n        let params;\n\n        if (hasErrors) {\n          params = { preventReloading: true };\n        }\n\n        this.sendMessage(clients, \"warnings\", stats.warnings, params);\n      }\n\n      if (\n        /** @type {NonNullable<StatsCompilation[\"errors\"]>} */ (stats.errors)\n          .length > 0\n      ) {\n        this.sendMessage(clients, \"errors\", stats.errors);\n      }\n    } else {\n      this.sendMessage(clients, \"ok\");\n    }\n  }\n\n  /**\n   * @param {string | string[]} watchPath\n   * @param {WatchOptions} [watchOptions]\n   */\n  watchFiles(watchPath, watchOptions) {\n    const chokidar = require(\"chokidar\");\n    const watcher = chokidar.watch(watchPath, watchOptions);\n\n    // disabling refreshing on changing the content\n    if (this.options.liveReload) {\n      watcher.on(\"change\", (item) => {\n        if (this.webSocketServer) {\n          this.sendMessage(\n            this.webSocketServer.clients,\n            \"static-changed\",\n            item\n          );\n        }\n      });\n    }\n\n    this.staticWatchers.push(watcher);\n  }\n\n  /**\n   * @param {import(\"webpack-dev-middleware\").Callback} [callback]\n   */\n  invalidate(callback = () => {}) {\n    if (this.middleware) {\n      this.middleware.invalidate(callback);\n    }\n  }\n\n  /**\n   * @returns {Promise<void>}\n   */\n  async start() {\n    await this.normalizeOptions();\n\n    if (this.options.ipc) {\n      await /** @type {Promise<void>} */ (\n        new Promise((resolve, reject) => {\n          const net = require(\"net\");\n          const socket = new net.Socket();\n\n          socket.on(\n            \"error\",\n            /**\n             * @param {Error & { code?: string }} error\n             */\n            (error) => {\n              if (error.code === \"ECONNREFUSED\") {\n                // No other server listening on this socket so it can be safely removed\n                fs.unlinkSync(/** @type {string} */ (this.options.ipc));\n\n                resolve();\n\n                return;\n              } else if (error.code === \"ENOENT\") {\n                resolve();\n\n                return;\n              }\n\n              reject(error);\n            }\n          );\n\n          socket.connect(\n            { path: /** @type {string} */ (this.options.ipc) },\n            () => {\n              throw new Error(`IPC \"${this.options.ipc}\" is already used`);\n            }\n          );\n        })\n      );\n    } else {\n      this.options.host = await Server.getHostname(\n        /** @type {Host} */ (this.options.host)\n      );\n      this.options.port = await Server.getFreePort(\n        /** @type {Port} */ (this.options.port),\n        this.options.host\n      );\n    }\n\n    await this.initialize();\n\n    const listenOptions = this.options.ipc\n      ? { path: this.options.ipc }\n      : { host: this.options.host, port: this.options.port };\n\n    await /** @type {Promise<void>} */ (\n      new Promise((resolve) => {\n        /** @type {import(\"http\").Server} */\n        (this.server).listen(listenOptions, () => {\n          resolve();\n        });\n      })\n    );\n\n    if (this.options.ipc) {\n      // chmod 666 (rw rw rw)\n      const READ_WRITE = 438;\n\n      await fs.promises.chmod(\n        /** @type {string} */ (this.options.ipc),\n        READ_WRITE\n      );\n    }\n\n    if (this.options.webSocketServer) {\n      this.createWebSocketServer();\n    }\n\n    if (this.options.bonjour) {\n      this.runBonjour();\n    }\n\n    this.logStatus();\n\n    if (typeof this.options.onListening === \"function\") {\n      this.options.onListening(this);\n    }\n  }\n\n  /**\n   * @param {(err?: Error) => void} [callback]\n   */\n  startCallback(callback = () => {}) {\n    this.start()\n      .then(() => callback(), callback)\n      .catch(callback);\n  }\n\n  /**\n   * @returns {Promise<void>}\n   */\n  async stop() {\n    if (this.bonjour) {\n      await /** @type {Promise<void>} */ (\n        new Promise((resolve) => {\n          this.stopBonjour(() => {\n            resolve();\n          });\n        })\n      );\n    }\n\n    this.webSocketProxies = [];\n\n    await Promise.all(this.staticWatchers.map((watcher) => watcher.close()));\n\n    this.staticWatchers = [];\n\n    if (this.webSocketServer) {\n      await /** @type {Promise<void>} */ (\n        new Promise((resolve) => {\n          /** @type {WebSocketServerImplementation} */\n          (this.webSocketServer).implementation.close(() => {\n            this.webSocketServer = null;\n\n            resolve();\n          });\n\n          for (const client of /** @type {WebSocketServerImplementation} */ (\n            this.webSocketServer\n          ).clients) {\n            client.terminate();\n          }\n\n          /** @type {WebSocketServerImplementation} */\n          (this.webSocketServer).clients = [];\n        })\n      );\n    }\n\n    if (this.server) {\n      await /** @type {Promise<void>} */ (\n        new Promise((resolve) => {\n          /** @type {import(\"http\").Server} */\n          (this.server).close(() => {\n            this.server = null;\n\n            resolve();\n          });\n\n          for (const socket of this.sockets) {\n            socket.destroy();\n          }\n\n          this.sockets = [];\n        })\n      );\n\n      if (this.middleware) {\n        await /** @type {Promise<void>} */ (\n          new Promise((resolve, reject) => {\n            /** @type {import(\"webpack-dev-middleware\").API<Request, Response>}*/\n            (this.middleware).close((error) => {\n              if (error) {\n                reject(error);\n\n                return;\n              }\n\n              resolve();\n            });\n          })\n        );\n\n        this.middleware = null;\n      }\n    }\n\n    // We add listeners to signals when creating a new Server instance\n    // So ensure they are removed to prevent EventEmitter memory leak warnings\n    for (const item of this.listeners) {\n      process.removeListener(item.name, item.listener);\n    }\n  }\n\n  /**\n   * @param {(err?: Error) => void} [callback]\n   */\n  stopCallback(callback = () => {}) {\n    this.stop()\n      .then(() => callback(), callback)\n      .catch(callback);\n  }\n\n  // TODO remove in the next major release\n  /**\n   * @param {Port} port\n   * @param {Host} hostname\n   * @param {(err?: Error) => void} fn\n   * @returns {void}\n   */\n  listen(port, hostname, fn) {\n    util.deprecate(\n      () => {},\n      \"'listen' is deprecated. Please use the async 'start' or 'startCallback' method.\",\n      \"DEP_WEBPACK_DEV_SERVER_LISTEN\"\n    )();\n\n    if (typeof port === \"function\") {\n      fn = port;\n    }\n\n    if (\n      typeof port !== \"undefined\" &&\n      typeof this.options.port !== \"undefined\" &&\n      port !== this.options.port\n    ) {\n      this.options.port = port;\n\n      this.logger.warn(\n        'The \"port\" specified in options is different from the port passed as an argument. Will be used from arguments.'\n      );\n    }\n\n    if (!this.options.port) {\n      this.options.port = port;\n    }\n\n    if (\n      typeof hostname !== \"undefined\" &&\n      typeof this.options.host !== \"undefined\" &&\n      hostname !== this.options.host\n    ) {\n      this.options.host = hostname;\n\n      this.logger.warn(\n        'The \"host\" specified in options is different from the host passed as an argument. Will be used from arguments.'\n      );\n    }\n\n    if (!this.options.host) {\n      this.options.host = hostname;\n    }\n\n    this.start()\n      .then(() => {\n        if (fn) {\n          fn.call(this.server);\n        }\n      })\n      .catch((error) => {\n        // Nothing\n        if (fn) {\n          fn.call(this.server, error);\n        }\n      });\n  }\n\n  /**\n   * @param {(err?: Error) => void} [callback]\n   * @returns {void}\n   */\n  // TODO remove in the next major release\n  close(callback) {\n    util.deprecate(\n      () => {},\n      \"'close' is deprecated. Please use the async 'stop' or 'stopCallback' method.\",\n      \"DEP_WEBPACK_DEV_SERVER_CLOSE\"\n    )();\n\n    this.stop()\n      .then(() => {\n        if (callback) {\n          callback();\n        }\n      })\n      .catch((error) => {\n        if (callback) {\n          callback(error);\n        }\n      });\n  }\n}\n\nmodule.exports = Server;\n"],"mappings":"AAAA,YAAY;;AAACA,OAAA;AAEb,MAAMC,EAAE,GAAGD,OAAO,CAAC,IAAI,CAAC;AACxB,MAAME,IAAI,GAAGF,OAAO,CAAC,MAAM,CAAC;AAC5B,MAAMG,GAAG,GAAGH,OAAO,CAAC,KAAK,CAAC;AAC1B,MAAMI,IAAI,GAAGJ,OAAO,CAAC,MAAM,CAAC;AAC5B,MAAMK,EAAE,GAAGL,OAAO,CAAC,aAAa,CAAC;AACjC,MAAMM,MAAM,GAAGN,OAAO,CAAC,WAAW,CAAC;AACnC,MAAMO,cAAc,GAAGP,OAAO,CAAC,iBAAiB,CAAC;AACjD,MAAMQ,OAAO,GAAGR,OAAO,CAAC,SAAS,CAAC;AAClC,MAAM;EAAES;AAAS,CAAC,GAAGT,OAAO,CAAC,cAAc,CAAC;AAC5C,MAAMU,MAAM,GAAGV,OAAO,CAAC,gBAAgB,CAAC;;AAExC;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AAC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"},"metadata":{},"sourceType":"script","externalDependencies":[]}